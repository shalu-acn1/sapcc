import{b as f}from"./chunk-EZR7BLCD.js";import{a as s}from"./chunk-FHULHBP4.js";import{D as h,Ge as M,I as l,Kd as c,Ld as y,Lf as F,Te as I,Uc as g,Za as E,Ze as A,_d as k,da as a,he as O,ma as n,mf as S,na as C,oa as m,q as p,qa as r,r as d,rf as D,xa as v}from"./chunk-PRP3ZKGZ.js";var R={backend:{occ:{endpoints:{cartUserEmail:"users/${userId}/carts/${cartId}?fields=sapCustomerEmail"}}}},U=[{id:"deliveryAddress",name:"opfCheckout.tabs.shipping",routeName:"checkoutDeliveryAddress",type:[s.DELIVERY_ADDRESS],nameMultiLine:!0},{id:"deliveryMode",name:"opfCheckout.tabs.deliveryMethod",routeName:"checkoutDeliveryMode",type:[s.DELIVERY_MODE],nameMultiLine:!0},{id:"opfPaymentAndReview",name:"opfCheckout.tabs.paymentAndReview",routeName:"opfCheckoutPaymentAndReview",type:[s.PAYMENT_DETAILS],nameMultiLine:!0}],N={checkout:{flows:{OPF:{steps:U,guest:!1},"OPF-guest":{steps:U,guest:!0}}}},w="opfCheckout",Z="opfCheckoutPaymentAndReview",q="OpfExplicitTermsAndConditionsComponent";var _=new m("OpfGetCartUserEmailNormalizer"),b=(()=>{class e{constructor(){this.http=r(g),this.converter=r(I),this.occEndpointsService=r(M),this.logger=r(O)}getCartUserEmail(o,t){return this.http.get(this.occEndpointsService.buildUrl("cartUserEmail",{urlParams:{userId:o,cartId:t}})).pipe(l(i=>{throw D(i,this.logger)}),S({shouldRetry:A,maxTries:2}),this.converter.pipeable(_))}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275prov=n({token:e,factory:e.\u0275fac})}}return e})(),u=class{},P=(()=>{class e{constructor(){this.adapter=r(u)}getCartUserEmail(o,t){return this.adapter.getCartUserEmail(o,t)}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275prov=n({token:e,factory:e.\u0275fac})}}return e})(),T=(()=>{class e{constructor(){this.opfCheckoutConnector=r(P)}isCartUserHasEmail(o,t){return this.opfCheckoutConnector.getCartUserEmail(o,t).pipe(p(i=>!!i.sapCustomerEmail))}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275prov=n({token:e,factory:e.\u0275fac})}}return e})(),L=(()=>{class e extends f{constructor(){super(...arguments),this.userIdService=r(k),this.opfCartUserEmailChecker=r(T),this.featureConfigService=r(F)}canActivate(){return this.featureConfigService?.isEnabled("opfEnablePreventingFromCheckoutWithoutEmail")?this.activeCartFacade.isStable().pipe(h(o=>o),a(()=>this.activeCartFacade.isGuestCart()),a(o=>o?d([this.userIdService.getUserId(),this.activeCartFacade.getActiveCartId()]).pipe(a(([t,i])=>this.opfCartUserEmailChecker.isCartUserHasEmail(t,i)),p(t=>t||this.handleGuestUserWithoutEmail())):super.canActivate())):super.canActivate()}handleGuestUserWithoutEmail(){return this.router.createUrlTree([this.semanticPathService.get("opfCheckoutEmail")])}static{this.\u0275fac=(()=>{let o;return function(i){return(o||(o=v(e)))(i||e)}})()}static{this.\u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),j={routing:{routes:{opfCheckoutPaymentType:{paths:["checkout/opf-payment-type"]},opfCheckoutDeliveryAddress:{paths:["checkout/opf-delivery-address"]},opfCheckoutPaymentAndReview:{paths:["checkout/opf-payment-and-review"]},opfCheckoutReview:{paths:["checkout/opf-review"]},opfCheckoutEmail:{paths:["opf-checkout-email"]}}}},H=["OpfCheckoutPaymentAndReview","OpfCheckoutEmailUpdateComponent"];function G(){return{featureModules:{[w]:{cmsComponents:H}}}}var J=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=E({type:e})}static{this.\u0275inj=C({providers:[{provide:f,useClass:L},{provide:u,useClass:b},P,T,c(j),c(R),c(N),y(G)]})}}return e})();export{w as a,Z as b,q as c,J as d};
