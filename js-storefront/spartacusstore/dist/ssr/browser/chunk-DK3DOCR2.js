import{Gd as u,Ge as m,Kd as E,Ld as N,Sc as l,Vc as h,Za as g,ee as f,fc as d,ga as r,he as p,ma as a,na as I,pa as o,qa as c}from"./chunk-PRP3ZKGZ.js";var R=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275prov=a({token:e,factory:function(t){let n=null;return t?n=new(t||e):n=o(u),n},providedIn:"root"})}}return e})(),S="personalization",v={personalization:{enabled:!1,httpHeaderName:{id:"Occ-Personalization-Id",timestamp:"Occ-Personalization-Time"},context:{slotPosition:"PlaceholderContentSlot",componentId:"PersonalizationScriptComponent"}}},w=(()=>{class e{constructor(i,t,n){this.config=i,this.occEndpoints=t,this.winRef=n,this.enabled=!1,this.PERSONALIZATION_ID_KEY="personalization-id",this.logger=c(p),this.winRef.isBrowser()&&(this.enabled=this.winRef.localStorage&&this.config.personalization?.enabled||!1,this.enabled?(!this.config.personalization?.httpHeaderName&&d()&&this.logger.warn("There is no httpHeaderName configured in Personalization"),this.requestHeader=this.config.personalization?.httpHeaderName?.id.toLowerCase(),this.personalizationId=this.winRef.localStorage?.getItem(this.PERSONALIZATION_ID_KEY)):this.winRef.localStorage?.getItem(this.PERSONALIZATION_ID_KEY)&&this.winRef.localStorage.removeItem(this.PERSONALIZATION_ID_KEY))}intercept(i,t){return this.enabled?(this.requestHeader&&this.personalizationId&&i.url.includes(this.occEndpoints.getBaseUrl())&&(i=i.clone({setHeaders:{[this.requestHeader]:this.personalizationId}})),t.handle(i).pipe(r(n=>{if(n instanceof l&&this.requestHeader&&n.headers.keys().includes(this.requestHeader)){let s=n.headers.get(this.requestHeader);this.personalizationId!==s&&(this.personalizationId=s,this.personalizationId&&this.winRef.localStorage?.setItem(this.PERSONALIZATION_ID_KEY,this.personalizationId))}}))):t.handle(i)}static{this.\u0275fac=function(t){return new(t||e)(o(R),o(m),o(f))}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),z=(()=>{class e{constructor(i,t,n){this.config=i,this.occEndpoints=t,this.winRef=n,this.enabled=!1,this.PERSONALIZATION_TIME_KEY="personalization-time",this.logger=c(p),this.winRef.isBrowser()&&(this.enabled=this.winRef.localStorage&&this.config.personalization?.enabled||!1,this.enabled?(!this.config.personalization?.httpHeaderName&&d()&&this.logger.warn("There is no httpHeaderName configured in Personalization"),this.requestHeader=this.config.personalization?.httpHeaderName?.timestamp.toLowerCase(),this.timestamp=this.winRef.localStorage?.getItem(this.PERSONALIZATION_TIME_KEY)):this.winRef.localStorage?.getItem(this.PERSONALIZATION_TIME_KEY)&&this.winRef.localStorage.removeItem(this.PERSONALIZATION_TIME_KEY))}intercept(i,t){return this.enabled?(this.requestHeader&&this.timestamp&&i.url.includes(this.occEndpoints.getBaseUrl())&&(i=i.clone({setHeaders:{[this.requestHeader]:this.timestamp}})),t.handle(i).pipe(r(n=>{if(n instanceof l&&this.requestHeader&&n.headers.keys().includes(this.requestHeader)){let s=n.headers.get(this.requestHeader);this.timestamp!==s&&(this.timestamp=s,this.timestamp&&this.winRef.localStorage?.setItem(this.PERSONALIZATION_TIME_KEY,this.timestamp))}}))):t.handle(i)}static{this.\u0275fac=function(t){return new(t||e)(o(R),o(m),o(f))}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),O=[{provide:h,useExisting:w,multi:!0},{provide:h,useExisting:z,multi:!0}];function P(){return{featureModules:{[S]:{cmsComponents:["PersonalizationScriptComponent"]}}}}var C=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=g({type:e})}static{this.\u0275inj=I({providers:[...O,E(v),N(P)]})}}return e})();export{S as a,C as b};
