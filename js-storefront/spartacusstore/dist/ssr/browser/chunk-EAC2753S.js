import{b as P}from"./chunk-EEQK2RQH.js";import{b as w}from"./chunk-TTSQTH3J.js";import{b as L,c as d}from"./chunk-RFSWRLY7.js";import{h as O,j as E}from"./chunk-QKV5QP3B.js";import"./chunk-WPN2OLOU.js";import"./chunk-EU5ZHKTW.js";import{M as l,P as R}from"./chunk-H2QHHFZD.js";import{Da as F,M as b,U as m,X as S,Za as c,c as g,ee as y,ma as C,na as p,p as h,qa as s}from"./chunk-PRP3ZKGZ.js";import"./chunk-25N2FLV6.js";var v=(()=>{class r{constructor(){this.winRef=s(y),this.ngZone=s(F),this.opfPaymentFacade=s(w),this.launchDialogService=s(R),this.opfCtaFacade=s(P),this._readyForScriptEvent=new g,this.readyForScriptEvent$=this._readyForScriptEvent.asObservable()}registerGlobalFunctions({domain:e,paymentSessionId:t,vcr:i,paramsMap:n}){if(this.winRef.isBrowser())switch(e){case d.CHECKOUT:this.registerSubmit(e,t,i),this.registerSubmitComplete(e,t,i),this.registerThrowPaymentError(e,i),this.registerStartLoadIndicator(e,i),this.registerStopLoadIndicator(e);break;case d.REDIRECT:this.registerSubmitCompleteRedirect(e,t,i),this.registerGetRedirectParams(e,n??[]);break;case d.GLOBAL:this.registerCtaScriptReady(e);break;default:break}}unregisterGlobalFunctions(e){if(!this.winRef.isBrowser())return;let t=this.winRef.nativeWindow;t?.Opf?.payments[e]&&(t.Opf.payments[e]=void 0)}getGlobalFunctionContainer(e){let t=this.winRef.nativeWindow;return t.Opf?.payments[e]||(t.Opf=t?.Opf??{},t.Opf.payments={},t.Opf.payments[e]={}),t.Opf.payments[e]}registerStartLoadIndicator(e,t){this.getGlobalFunctionContainer(e).startLoadIndicator=()=>{t&&this.ngZone.run(()=>{this.loaderSpinnerCpntRef&&this.stopLoaderSpinner(this.loaderSpinnerCpntRef),this.loaderSpinnerCpntRef=this.startLoaderSpinner(t)})}}registerStopLoadIndicator(e){this.getGlobalFunctionContainer(e).stopLoadIndicator=()=>{this.ngZone.run(()=>{this.stopLoaderSpinner(this.loaderSpinnerCpntRef)})}}startLoaderSpinner(e){return this.launchDialogService.launch(l.PLACE_ORDER_SPINNER,e)}stopLoaderSpinner(e){e&&e.subscribe(t=>{this.launchDialogService.clear(l.PLACE_ORDER_SPINNER),t&&t.destroy()}).unsubscribe()}registerGetRedirectParams(e,t=[]){this.getGlobalFunctionContainer(e).getRedirectParams=()=>t.map(i=>({key:i.key,value:i.value}))}registerThrowPaymentError(e,t){this.getGlobalFunctionContainer(e).throwPaymentError=(i=E)=>{t&&this.ngZone.run(()=>{let n=this.launchDialogService.openDialog(l.OPF_ERROR,void 0,t,i);n&&n.pipe(b(1)).subscribe()})}}registerSubmit(e,t,i){this.getGlobalFunctionContainer(e).submit=({additionalData:n,submitSuccess:a=()=>{},submitPending:o=()=>{},submitFailure:u=()=>{},paymentMethod:D})=>this.ngZone.run(()=>{let f;i&&(f=this.startLoaderSpinner(i));let M={onSuccess:a,onPending:o,onFailure:u};return h(this.opfPaymentFacade.submitPayment({additionalData:n,paymentSessionId:t,callbacks:M,paymentMethod:D,returnPath:void 0}).pipe(S(()=>!0,!0),m(()=>{f&&this.stopLoaderSpinner(f)})))})}runSubmitComplete(e,t,i,n,a){return this.ngZone.run(()=>{let o;return a&&(o=this.startLoaderSpinner(a)),h(this.opfPaymentFacade.submitCompletePayment({additionalData:e,paymentSessionId:i,callbacks:t,returnPath:n}).pipe(m(()=>{o&&this.stopLoaderSpinner(o)})))})}registerSubmitComplete(e,t,i){this.getGlobalFunctionContainer(e).submitComplete=({additionalData:n,submitSuccess:a=()=>{},submitPending:o=()=>{},submitFailure:u=()=>{}})=>this.runSubmitComplete(n,{onSuccess:a,onPending:o,onFailure:u},t,void 0,i)}registerSubmitCompleteRedirect(e,t,i){this.getGlobalFunctionContainer(e).submitCompleteRedirect=({additionalData:n,submitSuccess:a=()=>{},submitPending:o=()=>{},submitFailure:u=()=>{}})=>this.runSubmitComplete(n,{onSuccess:a,onPending:o,onFailure:u},t,O.CHECKOUT_REVIEW_PAGE,i)}registerCtaScriptReady(e){this.getGlobalFunctionContainer(e).scriptReady=t=>{this.ngZone.run(()=>{this.opfCtaFacade.emitScriptReadyEvent(t)})}}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=C({token:r,factory:r.\u0275fac})}}return r})(),N=[v,{provide:L,useExisting:v}],G=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=c({type:r})}static{this.\u0275inj=p({providers:[...N]})}}return r})();var z=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=c({type:r})}static{this.\u0275inj=p({imports:[G]})}}return r})();export{z as OpfGlobalFunctionsModule};
