import{c as fe}from"./chunk-MOKI6WPS.js";import{M as c,P as Se,X as k,ka as y}from"./chunk-H2QHHFZD.js";import{$f as le,Af as x,Be as F,Bf as z,De as $,Gd as L,Ge as O,Ic as ie,J,Kd as M,M as D,Ng as ge,Og as g,Uf as ue,Vc as C,Vd as re,Vf as de,Wd as se,Za as p,Zd as h,_d as U,_f as he,be as oe,d as B,da as Q,db as ee,ee as N,fe as b,gd as w,ge as m,m as X,ma as a,me as _,n as R,na as v,nc as te,ne as P,p as Z,pa as s,q as E,qe as H,r as j,re as ne,se as ae,xa as q,xe as ce,ye as l,zf as W}from"./chunk-PRP3ZKGZ.js";import{a as Y,e as K,f as A}from"./chunk-25N2FLV6.js";var Be=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:function(i){let r=null;return i?r=new(i||e):r=s(L),r},providedIn:"root"})}}return e})(),ve="asm_enabled",pe=(()=>{class e{constructor(t,i,r,n){this.location=t,this.winRef=i,this.launchDialogService=r,this.featureModules=n}load(){this.isEnabled()&&this.addUi()}isEnabled(){return this.isLaunched()&&!this.isUsedBefore()&&this.winRef.localStorage&&this.winRef.localStorage.setItem(ve,"true"),this.isLaunched()||this.isUsedBefore()||this.isEmulateInURL()}isLaunched(){let t=this.location.path().split("?")[1];return!!t&&t.split("&").includes("asm=true")}isEmulateInURL(){return this.location.path().indexOf("assisted-service/emulate?")>0}isUsedBefore(){return this.winRef.localStorage?this.winRef.localStorage.getItem(ve)==="true":!1}addUi(){this.featureModules.resolveFeature("asm").subscribe(()=>this.launchDialogService.launch(c.ASM))}static{this.\u0275fac=function(i){return new(i||e)(s(te),s(N),s(Se),s(ge))}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Ie=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=p({type:e})}static{this.\u0275inj=v({providers:[{provide:ee,useFactory:Ae,deps:[pe],multi:!0}],imports:[ie,y]})}}return e})();function Ae(e){return()=>{e.load()}}var T=function(e){return e.START_SESSION="START_SESSION",e.ORDER_HISTORY="ORDER_HISTORY",e.ACTIVE_CART="ACTIVE_CART",e.CUSTOMER_360="CUSTOMER_360",e}(T||{}),Re={asm:{agentSessionTimer:{startingDelayInSeconds:600},customerSearch:{maxResults:20},customerList:{pageSize:5,showAvatar:!0,columns:[{headerLocalizationKey:"asm.customerList.tableHeader.customer",renderer:e=>e?.name??"",actionType:T.START_SESSION},{headerLocalizationKey:"asm.customerList.tableHeader.email",renderer:e=>e?.uid??""},{headerLocalizationKey:"asm.customerList.tableHeader.phone",renderer:e=>e?.defaultAddress?.phone??""},{headerLocalizationKey:"asm.customerList.tableHeader.account",renderer:e=>e?.orgUnit?.name??""},{headerLocalizationKey:"asm.customerList.tableHeader.activeCart",icon:{symbol:k.CART,captionLocalizationKey:"asm.customerList.tableHeader.viewActiveCart"},actionType:T.ACTIVE_CART},{headerLocalizationKey:"asm.customerList.tableHeader.orders",icon:{symbol:k.C360_INVOICE,captionLocalizationKey:"asm.customerList.tableHeader.viewOrders"},actionType:T.ORDER_HISTORY},{headerLocalizationKey:"asm.customerList.tableHeader.customer360",icon:{symbol:k.C360_CIRCLE_USER,captionLocalizationKey:"asm.customerList.tableHeader.viewCustomer360"},actionType:T.CUSTOMER_360}]},userIdHttpHeader:{enable:!0}}},Ee=(()=>{class e{constructor(t,i,r){this.config=t,this.userIdService=i,this.userIdConstants=r,this.userIdHeader="sap-commerce-cloud-user-id",this.uniqueUserIdConstants=new Set(Object.values(r))}intercept(t,i){if(!this.config.asm?.userIdHttpHeader?.enable)return i.handle(t);let r=t.context.get(ue),n;if(typeof r.sendUserIdAsHeader=="string")n=R(r.sendUserIdAsHeader);else if(r.sendUserIdAsHeader)n=this.userIdService.takeUserId().pipe(E(o=>this.uniqueUserIdConstants.has(o)?void 0:o));else return i.handle(t);return n.pipe(J(o=>{if(o){let d=t.clone({headers:t.headers.set(this.userIdHeader,o)});return i.handle(d)}else return i.handle(t)}))}static{this.\u0275fac=function(i){return new(i||e)(s(L),s(U),s(de))}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),u=function(e){return e.CSAgent="CSAgent",e.User="User",e}(u||{}),V=(()=>{class e extends m{constructor(){super(...arguments),this._tokenTarget$=new B(u.User)}getTokenTarget(){return this._tokenTarget$}setTokenTarget(t){this._tokenTarget$.next(t)}getEmulatedUserToken(){return this.emulatedUserToken}setEmulatedUserToken(t){this.emulatedUserToken=t}switchTokenTargetToCSAgent(){this._tokenTarget$.next(u.CSAgent)}switchTokenTargetToUser(){this._tokenTarget$.next(u.User)}clearEmulatedUserToken(){this.emulatedUserToken=void 0}static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=q(e)))(r||e)}})()}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Ce=(()=>{class e{constructor(t,i,r,n,o,d){this.authService=t,this.authStorageService=i,this.userIdService=r,this.oAuthLibWrapperService=n,this.store=o,this.userAccountFacade=d}authorizeCustomerSupportAgent(t,i){return A(this,null,function*(){let r,n;this.userAccountFacade.get().subscribe(o=>n=o?.customerId).unsubscribe(),this.authStorageService.getToken().subscribe(o=>r=o).unsubscribe(),this.authStorageService.switchTokenTargetToCSAgent();try{yield this.oAuthLibWrapperService.authorizeWithPasswordFlow(t,i),this.store.dispatch(new h.Logout),n!==void 0&&r!==void 0?(this.userIdService.setUserId(n),this.authStorageService.setEmulatedUserToken(r),this.store.dispatch(new h.Login)):(this.userIdService.setUserId(se),this.authStorageService.clearEmulatedUserToken())}catch{this.authStorageService.switchTokenTargetToUser()}})}startCustomerEmulationSession(t){this.authStorageService.clearEmulatedUserToken(),this.store.dispatch(new h.Logout),this.userIdService.setUserId(t),this.store.dispatch(new h.Login)}isCustomerSupportAgentLoggedIn(){return j([this.authStorageService.getToken(),this.authStorageService.getTokenTarget()]).pipe(E(([t,i])=>!!(t?.access_token&&i===u.CSAgent)))}isCustomerEmulated(){return this.userIdService.isEmulated()}getCustomerSupportAgentTokenLoading(){return R(!1)}logoutCustomerSupportAgent(){return A(this,null,function*(){let t=this.authStorageService.getEmulatedUserToken(),i;this.userIdService.isEmulated().subscribe(r=>i=r).unsubscribe(),yield this.oAuthLibWrapperService.revokeAndLogout(),this.store.dispatch({type:"[Auth] Logout Customer Support Agent"}),this.authStorageService.setTokenTarget(u.User),i&&t?(this.store.dispatch(new h.Logout),this.authStorageService.setToken(t),this.userIdService.setUserId(re),this.authStorageService.clearEmulatedUserToken(),this.store.dispatch(new h.Login)):this.authService.logout()})}static{this.\u0275fac=function(i){return new(i||e)(s(l),s(V),s(U),s(b),s(w),s(fe))}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Le=(()=>{class e extends z{constructor(t,i,r,n,o,d,S,f){super(t,i,n,o,S,d,f),this.authService=t,this.authStorageService=i,this.csAgentAuthService=r,this.oAuthLibWrapperService=n,this.routingService=o,this.globalMessageService=d,this.occEndpointsService=S,this.authRedirectService=f}shouldAddAuthorizationHeader(t){return super.shouldAddAuthorizationHeader(t)||this.isCSAgentTokenRequest(t)}shouldCatchError(t){return super.shouldCatchError(t)||this.isCSAgentTokenRequest(t)}alterRequest(t,i){let r=!!this.getAuthorizationHeader(t),n=this.isCSAgentTokenRequest(t),o=super.alterRequest(t,i);return!r&&n?(o=t.clone({setHeaders:Y({},this.createAuthorizationHeader(i))}),$.removeHeader(F,o)):o}isCSAgentTokenRequest(t){return!!$.getInterceptorParam(F,t.headers)}handleExpiredRefreshToken(){this.csAgentAuthService.isCustomerSupportAgentLoggedIn().pipe(D(1)).subscribe(t=>{t?(this.authService.setLogoutProgress(!0),this.csAgentAuthService.logoutCustomerSupportAgent(),this.globalMessageService.add({key:"asm.csagentTokenExpired"},W.MSG_TYPE_ERROR)):super.handleExpiredRefreshToken()})}static{this.\u0275fac=function(i){return new(i||e)(s(l),s(m),s(Ce),s(b),s(_),s(x),s(O),s(P))}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Me=(()=>{class e extends l{constructor(t,i,r,n,o,d,S,f){super(t,i,r,n,o,S,f),this.store=t,this.userIdService=i,this.oAuthLibWrapperService=r,this.authStorageService=n,this.authRedirectService=o,this.globalMessageService=d,this.routingService=S,this.authMultisiteIsolationService=f}canUserLogin(){let t,i;return this.authStorageService.getToken().subscribe(r=>i=r).unsubscribe(),this.authStorageService.getTokenTarget().subscribe(r=>t=r).unsubscribe(),!(i?.access_token&&t===u.CSAgent)}warnAboutLoggedCSAgent(){this.globalMessageService.add({key:"asm.auth.agentLoggedInError"},W.MSG_TYPE_ERROR)}loginWithCredentials(t,i){return A(this,null,function*(){this.canUserLogin()?yield K(e.prototype,this,"loginWithCredentials").call(this,t,i):this.warnAboutLoggedCSAgent()})}loginWithRedirect(){return this.canUserLogin()?(super.loginWithRedirect(),!0):(this.warnAboutLoggedCSAgent(),!1)}coreLogout(){return Z(this.userIdService.isEmulated().pipe(D(1),Q(t=>t?(this.authStorageService.clearEmulatedUserToken(),this.userIdService.clearUserId(),this.store.dispatch(new h.Logout),R(!0)):X(super.coreLogout()))))}isUserLoggedIn(){return j([this.authStorageService.getToken(),this.userIdService.isEmulated(),this.authStorageService.getTokenTarget()]).pipe(E(([t,i,r])=>!!t?.access_token&&(r===u.User||r===u.CSAgent&&i)))}static{this.\u0275fac=function(i){return new(i||e)(s(w),s(U),s(b),s(V),s(P),s(x),s(_),s(ce))}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Xe=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=p({type:e})}static{this.\u0275inj=v({providers:[M(Re),{provide:m,useExisting:V},{provide:l,useExisting:Me},{provide:z,useExisting:Le},{provide:C,useExisting:Ee,multi:!0}],imports:[Ie]})}}return e})(),I="asm",Ze=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:()=>g({facade:e,feature:I,methods:["bindCart"]}),providedIn:"root"})}}return e})(),Je=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:()=>g({facade:e,feature:I,methods:["createCustomer"]}),providedIn:"root"})}}return e})(),Qe=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:()=>g({facade:e,feature:I,methods:["getCustomerLists","getCustomerListsState","customerListCustomersSearch","getCustomerListCustomersSearchResults","getCustomerListCustomersSearchResultsLoading","customerListCustomersSearchReset","getCustomerListCustomersSearchResultsError"]}),providedIn:"root"})}}return e})();c.ASM_CUSTOMER_LIST="ASM_CUSTOMER_LIST";c.ASM_BIND_CART="ASM_BIND_CART";c.ASM_SAVE_CART="ASM_SAVE_CART";c.ASM_SWITCH_CUSTOMER="ASM_SWITCH_CUSTOMER";c.ASM_CREATE_CUSTOMER_FORM="ASM_CREATE_CUSTOMER_FORM";var qe=(()=>{class e{constructor(t,i,r){this.routingService=t,this.winRef=i,this.asmEnablerService=r,this.searchParams=new URLSearchParams(this.winRef?.location?.search)}isEmulateInURL(){return this.asmEnablerService?.isEmulateInURL()||!1}getSearchParameter(t){return this.searchParams.get(t)??void 0}handleNavigation(t=this.getParamsInUrl()){t.cartType==="active"?this.routingService.go({cxRoute:"cart"}):t.cartType==="saved"&&t.cartId?this.routingService.go("my-account/saved-cart/"+t.cartId):t.orderId?this.routingService.go({cxRoute:"orderDetails",params:{code:t.orderId}}):t.ticketId&&this.routingService.go({cxRoute:"supportTicketDetails",params:{ticketCode:t.ticketId}})}getParamsInUrl(){let t={customerId:this.getSearchParameter("customerId"),orderId:this.getSearchParameter("orderId"),ticketId:this.getSearchParameter("ticketId"),cartId:this.getSearchParameter("cartId"),cartType:this.getSearchParameter("cartType")};return Object.fromEntries(Object.entries(t).filter(([i,r])=>!!r))}static{this.\u0275fac=function(i){return new(i||e)(s(_),s(N),s(pe))}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var G="asmCustomer360",Ue="asmCustomer360Core",be=(()=>{class e{constructor(t,i,r,n){this.languageService=t,this.currencyService=i,this.occEndpoints=r,this.config=n,this.activeLang=H(this.config,ne),this.activeCurr=H(this.config,ae),this.languageService.getActive().subscribe(o=>this.activeLang=o),this.currencyService.getActive().subscribe(o=>{this.activeCurr=o})}intercept(t,i){return t.url.includes(this.occEndpoints.getBaseUrl({prefix:!1,baseSite:!1}))&&t.url.includes("/assistedservicewebservices/")&&(t=t.clone({setParams:{lang:this.activeLang??"",curr:this.activeCurr??""}})),i.handle(t)}static{this.\u0275fac=function(i){return new(i||e)(s(he),s(le),s(O),s(oe))}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),nt=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=p({type:e})}static{this.\u0275inj=v({providers:[M({featureModules:{[G]:{dependencies:[I]},[Ue]:G}}),{provide:C,useExisting:be,multi:!0}],imports:[y]})}}return e})(),at=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:()=>g({facade:e,feature:G,methods:["get360Data"]}),providedIn:"root"})}}return e})();var _e=function(e){return e.REVIEW_LIST="c360ReviewList",e.STORE_LOCATION="c360StoreLocation",e.PRODUCT_INTEREST_LIST="c360CustomerProductInterestList",e.SUPPORT_TICKET_LIST="c360TicketList",e.CUSTOMER_PROFILE="c360CustomerProfile",e.ACTIVE_CART="c360Cart",e.SAVED_CART="c360SavedCart",e.OVERVIEW="c360Overview",e.ACTIVITY_LIST="c360ActivityList",e.COUPON_LIST="c360CouponList",e.PROMOTION_LIST="c360PromotionList",e.CUSTOMER_COUPON_LIST="c360CustomerCouponList",e}(_e||{}),Oe=function(e){return e.VISA="visa",e.MASTER="master",e.MASTERCARD_EUROCARD="mastercard_eurocard",e.DINERS="diners",e.AMEX="amex",e}(Oe||{}),ke=function(e){return e.ARROW_LEFT="ArrowLeft",e.ARROW_RIGHT="ArrowRight",e.ARROW_DOWN="ArrowDown",e.ARROW_UP="ArrowUp",e.HOME="Home",e.END="End",e.PAGE_DOWN="PageDown",e.PAGE_UP="PageUp",e}(ke||{}),ye=function(e){return e.NAVIGATE="NAVIGATE",e}(ye||{});c.ASM_CUSTOMER_360="ASM_CUSTOMER_360";export{Be as a,ve as b,pe as c,T as d,V as e,Ce as f,Xe as g,I as h,Ze as i,Je as j,Qe as k,qe as l,G as m,nt as n,at as o,_e as p,Oe as q,ke as r,ye as s};
