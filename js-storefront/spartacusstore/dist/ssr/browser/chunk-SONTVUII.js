import{d as qt}from"./chunk-NGEUBE3K.js";import{b as Ge,c as Yt}from"./chunk-CTU7BVXW.js";import{b as Qt,g as ge}from"./chunk-TTSQTH3J.js";import{b as Kt,c as he}from"./chunk-RFSWRLY7.js";import{d as Ht,f as X,k as zt,m as je}from"./chunk-QKV5QP3B.js";import{a as jt,b as Gt,c as Wt}from"./chunk-EZR7BLCD.js";import{a as U,c as Bt,t as Lt,u as Nt,v as $t,x as Vt,z as Ut}from"./chunk-FHULHBP4.js";import{g as Rt}from"./chunk-WPN2OLOU.js";import{a as Et,b as Ue}from"./chunk-E4GOOKTU.js";import"./chunk-3OH6C4VK.js";import"./chunk-MOKI6WPS.js";import"./chunk-VVCV3FQN.js";import"./chunk-MTN5X6Q6.js";import{C as Ot,H as fe,I as Mt,J as Dt,O as Ft,P as wt}from"./chunk-EU5ZHKTW.js";import{$ as pe,$a as It,A as vt,Aa as Le,B as xt,C as de,Ca as ue,G as Pt,Ha as kt,Ia as Ne,Mb as Ve,U as St,W as Be,X as q,Z as J,Za as bt,_ as z,a as gt,ab as At,b as yt,c as le,d as Oe,e as Me,eb as Tt,fb as $e,g as _t,j as De,l as Fe,p as we,s as Re,ua as me,w as Ct}from"./chunk-H2QHHFZD.js";import{$ as Qe,$a as et,$b as c,$c as rt,Ab as A,Ad as ke,Af as se,Bb as s,Bc as oe,Ca as _e,Cb as nt,Cc as H,Cd as be,D as L,Db as it,Dg as D,Eb as G,Eg as F,Fb as ve,I as ne,Ic as M,Ja as Je,Kb as N,Kd as ae,La as ie,Lb as g,M as S,Ma as Xe,Mb as Q,Nb as C,Ob as ot,Og as ft,Pa as i,Tb as W,U as Ke,Ub as O,Vb as xe,Xa as Ze,Ya as E,Za as x,_d as Ie,_e as Te,a as ye,ab as tt,ac as l,af as lt,bb as u,bc as at,d as j,da as T,ec as $,ee as st,ga as w,hb as P,i as ze,ib as o,ih as ht,ke as ct,lg as pt,ma as K,me as Ae,mf as dt,n as Ye,na as v,ng as mt,o as Y,q as B,qa as m,r as te,rg as Ee,sb as d,sg as ce,tb as p,ub as f,uc as Pe,va as k,vb as y,wa as b,wb as _,wc as Se,xa as qe,xb as Ce,xc as V,yb as I,yg as ut,zf as re}from"./chunk-PRP3ZKGZ.js";import{a as Z,b as ee}from"./chunk-25N2FLV6.js";U.PAYMENT_TYPE="paymentType";var Bi={checkout:{steps:[{id:"paymentType",name:"checkoutB2B.progress.methodOfPayment",routeName:"checkoutPaymentType",type:[U.PAYMENT_TYPE]},{id:"deliveryAddress",name:"checkoutProgress.deliveryAddress",routeName:"checkoutDeliveryAddress",type:[U.DELIVERY_ADDRESS]},{id:"deliveryMode",name:"checkoutProgress.deliveryMode",routeName:"checkoutDeliveryMode",type:[U.DELIVERY_MODE]},{id:"paymentDetails",name:"checkoutProgress.paymentDetails",routeName:"checkoutPaymentDetails",type:[U.PAYMENT_DETAILS]},{id:"reviewOrder",name:"checkoutProgress.reviewOrder",routeName:"checkoutReviewOrder",type:[U.REVIEW_ORDER]}],express:!1,defaultDeliveryMode:[Bt.FREE],guest:!1}};var Li=[...$t,"CheckoutCostCenterComponent","CheckoutPaymentType"];var Xt=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=K({token:t,factory:()=>ft({facade:t,feature:Lt,methods:["getPaymentTypes","getPaymentTypesState","setPaymentType","getSelectedPaymentTypeState","isAccountPayment","getPurchaseOrderNumberState"]}),providedIn:"root"})}}return t})();var cn=t=>({paymentLink:t});function ln(t,r){t&1&&Ce(0)}function dn(t,r){if(t&1&&(d(0,"div",4),u(1,ln,1,0,"ng-container",5),p()),t&2){let e=r.ngIf;s();let n=N(3),a=N(5);i(),o("ngTemplateOutlet",e!=null&&e.isLoading?a:n)("ngTemplateOutletContext",O(2,cn,e))}}function pn(t,r){if(t&1&&(d(0,"div",8)(1,"a",9),c(2,"cxTranslate"),c(3,"cxTranslate"),g(4),c(5,"cxTranslate"),p()()),t&2){let e=s(2).paymentLink;i(),o("href",e.destination.url,ie),P("title",l(2,4,"opfCheckout.proceedPayment"))("aria-label",l(3,6,"opfCheckout.proceedPaymentButtonLabel")),i(3),Q(l(5,8,"opfCheckout.proceedPayment"))}}function mn(t,r){if(t&1&&(y(0),f(1,"iframe",10),_()),t&2){let e=s(2).paymentLink,n=s();i(),o("src",n.bypassSecurityTrustResourceUrl(e.destination==null?null:e.destination.url),Xe)}}function un(t,r){if(t&1&&f(0,"input",14),t&2){let e=r.$implicit;o("name",e==null?null:e.name)("value",e==null?null:e.value)}}function fn(t,r){if(t&1&&(d(0,"div",8)(1,"form",11)(2,"fieldset"),u(3,un,1,2,"input",12),p(),f(4,"input",13),c(5,"cxTranslate"),p()()),t&2){let e=s(2).paymentLink;i(),o("action",e.destination==null?null:e.destination.url,ie)("method",e.destination==null?null:e.destination.method)("enctype",e.destination==null?null:e.destination.contentType),i(2),o("ngForOf",e.destination==null?null:e.destination.form),i(),o("value",l(5,5,"opfCheckout.proceedPayment"))}}function hn(t,r){if(t&1&&(y(0),u(1,pn,6,10,"div",7)(2,mn,2,1,"ng-container",6)(3,fn,6,7,"div",7),_()),t&2){let e=s().paymentLink,n=s();i(),o("ngIf",e.renderType===n.RENDER_PATTERN.FULL_PAGE&&!(!(e.destination==null||e.destination.form==null)&&e.destination.form.length)),i(),o("ngIf",e.renderType===n.RENDER_PATTERN.IFRAME&&!(!(e==null||e.destination==null||e.destination.form==null)&&e.destination.form.length)),i(),o("ngIf",e==null||e.destination==null||e.destination.form==null?null:e.destination.form.length)}}function gn(t,r){if(t&1&&(y(0),f(1,"div",15),_()),t&2){let e=s().paymentLink,n=s();i(),o("innerHTML",n.bypassSecurityTrustHtml(e.html),Je)}}function yn(t,r){if(t&1&&(d(0,"div"),u(1,hn,4,3,"ng-container",6)(2,gn,2,1,"ng-container",6),p()),t&2){let e=r.paymentLink;i(),o("ngIf",e==null||e.destination==null?null:e.destination.url),i(),o("ngIf",e==null?null:e.html)}}function _n(t,r){if(t&1){let e=I();y(0),d(1,"div",4)(2,"div",8)(3,"button",17),c(4,"cxTranslate"),c(5,"cxTranslate"),A("click",function(){k(e);let a=s(2);return b(a.retryInitiatePayment())}),g(6),c(7,"cxTranslate"),p()()(),_()}t&2&&(i(3),o("ngClass","btn btn-primary"),P("title",l(4,4,"opfCheckout.retryPayment"))("aria-label",l(5,6,"opfCheckout.retryPayment")),i(3),C(" ",l(7,8,"opfCheckout.retryPayment")," "))}function Cn(t,r){t&1&&f(0,"cx-spinner")}function vn(t,r){if(t&1&&u(0,_n,8,10,"ng-container",16)(1,Cn,1,0,"ng-template",null,2,$),t&2){let e=r.paymentLink,n=N(2);o("ngIf",e==null?null:e.isError)("ngIfElse",n)}}var xn=(t,r)=>({billingAddress:t,isSameAsDelivery:r});function Pn(t,r){if(t&1){let e=I();d(0,"button",10),c(1,"cxTranslate"),c(2,"cxTranslate"),A("click",function(){k(e);let a=s(4);return b(a.editCustomBillingAddress())}),f(3,"cx-icon",11),p()}if(t&2){let e=s(4);P("aria-label",l(1,3,"paymentForm.editBillingAddress"))("title",l(2,5,"paymentForm.editBillingAddress")),i(3),o("type",e.iconTypes.PENCIL)}}function Sn(t,r){if(t&1&&(y(0),d(1,"div",7),f(2,"cx-card",8),c(3,"cxGetAddressCardContent"),u(4,Pn,4,7,"button",9),p(),_()),t&2){let e=s().ngIf;i(2),o("content",l(3,2,e.billingAddress)),i(2),o("ngIf",!e.isSameAsDelivery)}}function kn(t,r){if(t&1){let e=I();y(0),d(1,"cx-address-form",12),c(2,"cxTranslate"),c(3,"cxTranslate"),A("submitAddress",function(a){k(e);let h=s(3);return b(h.onSubmitAddress(a))})("backToAddress",function(){k(e);let a=s(3);return b(a.cancelAndHideForm())}),p(),_()}if(t&2){let e=s().ngIf,n=s(2);i(),G("actionBtnLabel",l(2,7,"common.save")),G("cancelBtnLabel",l(3,9,"common.cancel")),o("addressData",n.getAddressData(e.billingAddress))("showTitleCode",!0)("showCancelBtn",!0)("setAsDefaultField",!1)("countries",n.countries$)}}function bn(t,r){if(t&1){let e=I();y(0),d(1,"div",3)(2,"div",4)(3,"label")(4,"input",5),c(5,"cxTranslate"),A("change",function(a){k(e);let h=s(2);return b(h.toggleSameAsDeliveryAddress(a))}),p(),d(6,"span",6),g(7),c(8,"cxTranslate"),p()()()(),u(9,Sn,5,4,"ng-container",2)(10,kn,4,11,"ng-container",2),_()}if(t&2){let e=r.ngIf,n=s(2);i(4),o("checked",e.isSameAsDelivery),P("aria-label",l(5,5,"paymentForm.billingAddressSameAsShipping")),i(3),Q(l(8,7,"paymentForm.sameAsDeliveryAddress")),i(2),o("ngIf",!n.isEditBillingAddress&&e.billingAddress),i(),o("ngIf",n.isEditBillingAddress)}}function In(t,r){if(t&1&&(y(0),u(1,bn,11,9,"ng-container",2),c(2,"async"),c(3,"async"),_()),t&2){let e=s();i(),o("ngIf",xe(5,xn,l(2,1,e.billingAddress$),l(3,3,e.isSameAsDelivery$)))}}function An(t,r){t&1&&f(0,"cx-spinner")}var Zt=t=>({label:t});function Tn(t,r){}function En(t,r){}function On(t,r){t&1&&(d(0,"abbr",11),c(1,"cxTranslate"),g(2,"*"),p()),t&2&&G("title",l(1,1,"common.required"))}function Mn(t,r){if(t&1){let e=I();d(0,"button",7),c(1,"cxTranslate"),c(2,"cxTranslate"),A("click",function(){k(e);let a=s(2);return b(a.close())}),f(3,"cx-icon",4),p()}if(t&2){let e=s(2);P("aria-label",l(1,3,"opfCheckout.closeTermsAndConditionsAlert"))("title",l(2,5,"opfCheckout.closeTermsAndConditionsAlert")),i(3),o("type",e.iconTypes.CLOSE)}}function Dn(t,r){if(t&1&&(d(0,"div",1)(1,"div",2)(2,"span",3),f(3,"cx-icon",4),p(),d(4,"p",5),g(5),c(6,"cxTranslate"),p(),u(7,Mn,4,7,"button",6),p()()),t&2){let e=s();i(3),o("type",e.iconTypes.INFO),i(2),C(" ",l(6,3,e.isExplicit?"opfCheckout.checkTermsAndConditionsExplicit":"opfCheckout.checkTermsAndConditionsImplicit")," "),i(2),o("ngIf",e.isDismissible)}}var Fn=["*"];function wn(t,r){if(t&1&&(d(0,"h3"),g(1),c(2,"cxTranslate"),p()),t&2){let e=s();i(),C(" ",l(2,1,e.headingTranslationKey||"opfCheckout.paymentOption")," ")}}function Rn(t,r){if(t&1&&(y(0),g(1),_()),t&2){let e=s().$implicit;i(),C(" ",e.displayName," ")}}function Bn(t,r){if(t&1&&f(0,"img",12),t&2){let e=s(2).$implicit;o("src",e.logoUrl,ie)("alt",e.displayName)}}function Ln(t,r){if(t&1){let e=I();y(0),d(1,"div",7)(2,"input",8),A("change",function(){k(e);let a=s().$implicit,h=s(3);return b(h.changePayment(a))}),p(),d(3,"label",9)(4,"div",10),g(5),u(6,Bn,1,2,"img",11),p()()(),_()}if(t&2){let e=s().$implicit,n=s(3);i(2),ve("id","paymentId-",e.id,""),o("value",e.id)("checked",e.id===n.selectedPaymentId)("disabled",n.disabled&&n.explicitTermsAndConditions),P("aria-checked",e.id===n.selectedPaymentId),i(),ve("for","paymentId-",e.id,""),i(2),C(" ",e.displayName," "),i(),o("ngIf",e==null?null:e.logoUrl)}}function Nn(t,r){if(t&1&&(d(0,"div",14)(1,"span",15),f(2,"cx-icon",16),p(),d(3,"p",17),g(4),p()()),t&2){let e=s().ngIf,n=s(5);i(2),o("type",n.iconTypes.INFO),i(2),C(" ",e," ")}}function $n(t,r){if(t&1&&(y(0),u(1,Nn,5,2,"div",13),_()),t&2){let e=s(2).$implicit,n=s(3);i(),o("ngIf",e.id===n.selectedPaymentId)}}function Vn(t,r){if(t&1&&(y(0),u(1,$n,2,1,"ng-container",1),c(2,"async"),_()),t&2){let e=s().$implicit,n=s(3);i(),o("ngIf",l(2,1,n.getPaymentInfoMessage(e.id)))}}function Un(t,r){t&1&&Ce(0)}function jn(t,r){if(t&1&&(y(0),u(1,Un,1,0,"ng-container",18),_()),t&2){let e=s(4);i(),o("ngTemplateOutlet",e.customPaymentTemplate)}}function Gn(t,r){if(t&1&&f(0,"cx-opf-checkout-payment-wrapper",19),t&2){let e=s(4);o("selectedPaymentId",e.selectedPaymentId)}}function Wn(t,r){if(t&1&&(d(0,"div"),y(1),u(2,Rn,2,1,"ng-container",1)(3,Ln,7,10,"ng-container",1),_(),u(4,Vn,3,3,"ng-container",1)(5,jn,2,1,"ng-container",1)(6,Gn,1,1,"cx-opf-checkout-payment-wrapper",6),p()),t&2){let e=r.$implicit,n=s(3);i(2),o("ngIf",n.isOnlyOnePaymentOptionAvailable&&!n.hideOnlyOnePaymentProviderLabel&&!n.forceRadioInputsView),i(),o("ngIf",!n.isOnlyOnePaymentOptionAvailable||n.forceRadioInputsView),i(),o("ngIf",n.isPaymentInfoMessageVisible),i(),o("ngIf",n.customPaymentTemplate),i(),o("ngIf",!n.customPaymentTemplate&&n.isPaymentRenderBelow&&n.selectedPaymentId&&e.id===n.selectedPaymentId)}}function Hn(t,r){if(t&1){let e=I();y(0),d(1,"div",3),it(2),u(3,Wn,7,5,"div",4),d(4,"cx-pagination",5),A("viewPageEvent",function(a){k(e);let h=s(2);return b(h.pageChange(a))}),p()(),_()}if(t&2){let e=s().ngIf,n=s();i(3),o("ngForOf",e==null||e.data==null?null:e.data.value),i(),o("pagination",n.paginationModel)}}function zn(t,r){if(t&1&&(y(0),u(1,Hn,5,2,"ng-container",2),_()),t&2){let e=r.ngIf;s();let n=N(6);i(),o("ngIf",!(e!=null&&e.loading))("ngIfElse",n)}}function Yn(t,r){t&1&&f(0,"cx-spinner")}var Kn=t=>({cxRoute:t});function Qn(t,r){if(t&1&&(d(0,"button",3),c(1,"cxUrl"),c(2,"cxTranslate"),f(3,"cx-icon",4),p()),t&2){let e=s(2);o("routerLink",l(1,3,O(7,Kn,e.editConfig.route))),P("aria-label",l(2,5,e.editConfig.ariaLabelKey||"opfCheckout.editCardDefaultLabel")),i(3),o("type",e.iconTypes.PENCIL)}}function qn(t,r){if(t&1&&(y(0),f(1,"cx-card",1),u(2,Qn,4,9,"button",2),_()),t&2){let e=r.ngIf,n=s();i(),o("content",e),i(),o("ngIf",n.editConfig==null?null:n.editConfig.route)}}var Jn=t=>({count:t}),en=()=>[],Xn=(t,r)=>({items:t,readonly:!0,promotionLocation:r});function Zn(t,r){}var ei=t=>({value:t}),ti=t=>({route:t,ariaLabelKey:"checkoutReview.editDeliveryAddressDetails"}),ni=t=>({route:t,ariaLabelKey:"checkoutReview.editDeliveryMode"}),ii=()=>["for-mobile"],oi=()=>({cxRoute:"termsAndConditions"}),ai=()=>["for-desktop"];function ri(t,r){if(t&1&&f(0,"cx-opf-checkout-review-card",8),t&2){let e=r.ngIf,n=s(2);o("cardContent$",n.getDeliveryAddressCard(e))("editConfig",O(2,ti,n.getCheckoutStepUrl(n.checkoutStepTypeDeliveryAddress)))}}function si(t,r){if(t&1&&f(0,"cx-opf-checkout-review-card",8),t&2){let e=r.ngIf,n=s(2);o("cardContent$",n.getDeliveryModeCard(e))("editConfig",O(2,ni,n.getCheckoutStepUrl(n.checkoutStepTypeDeliveryMode)))}}function ci(t,r){if(t&1&&f(0,"cx-opf-checkout-terms-and-conditions-alert",9),t&2){let e=s().ngIf,n=s();o("isVisible",n.termsAndConditionInvalid)("isExplicit",e.value)("isDismissible",!1)("ngClass",W(4,ii))}}function li(t,r){if(t&1){let e=I();d(0,"div",10),c(1,"cxTranslate"),d(2,"h3"),g(3),c(4,"cxTranslate"),p(),d(5,"form",11)(6,"div",12)(7,"label")(8,"input",13),A("change",function(){k(e);let a=s(2);return b(a.toggleTermsAndConditions())}),p(),d(9,"span",14),g(10),c(11,"cxTranslate"),d(12,"a",15),c(13,"cxUrl"),g(14),c(15,"cxTranslate"),p()()()()()()}if(t&2){let e=s(2);P("aria-label",l(1,6,"opfCheckout.termsAndConditions")),i(3),Q(l(4,8,"opfCheckout.termsAndConditions")),i(2),o("formGroup",e.checkoutSubmitForm),i(5),C(" ",l(11,10,"checkoutReview.confirmThatRead")," "),i(2),o("routerLink",l(13,12,W(16,oi))),i(2),C(" ",l(15,14,"checkoutReview.termsAndConditions")," ")}}function di(t,r){if(t&1&&f(0,"cx-opf-checkout-terms-and-conditions-alert",16),t&2){let e=s().ngIf,n=s();o("isDismissible",!0)("isVisible",n.termsAndConditionInvalid)("isExplicit",e.value)("ngClass",W(4,ai))}}function pi(t,r){if(t&1&&(y(0),d(1,"div",1),u(2,ri,1,4,"cx-opf-checkout-review-card",2),c(3,"async"),u(4,si,1,4,"cx-opf-checkout-review-card",2),c(5,"async"),p(),u(6,ci,1,5,"cx-opf-checkout-terms-and-conditions-alert",3)(7,li,16,17,"div",4),f(8,"cx-opf-checkout-billing-address-form"),d(9,"cx-opf-checkout-payments",5),u(10,di,1,5,"cx-opf-checkout-terms-and-conditions-alert",6),p(),f(11,"cx-opf-checkout-review-cart-details",7),c(12,"async"),c(13,"async"),_()),t&2){let e=r.ngIf,n=s();i(2),o("ngIf",l(3,10,n.deliveryAddress$)),i(2),o("ngIf",l(5,12,n.deliveryMode$)),i(2),o("ngIf",!e.value),i(),o("ngIf",e.value),i(2),o("elementsPerPage",10)("explicitTermsAndConditions",e.value)("disabled",n.termsAndConditionInvalid),i(),o("ngIf",!e.value),i(),o("cart",l(12,14,n.cart$))("entries",l(13,16,n.entries$))}}var mi=(()=>{class t{transform(e){return e?{textBold:`${e.firstName} ${e.lastName}`,text:[e.line1,e.line2,this.getTownLine(e),e.postalCode,e.phone]}:{}}getTownLine(e){let n=e.region?.isocode||"",a=e.town||"",h=e.country?.isocode||"",R=[];return a&&R.push(a),n&&(a&&R.push(", "),R.push(n)),h&&((a||n)&&R.push(", "),R.push(h)),R.join("")}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275pipe=et({name:"cxGetAddressCardContent",type:t,pure:!0,standalone:!1})}}return t})(),We=(()=>{class t{constructor(){this.opfPaymentFacade=m(Qt),this.opfResourceLoaderService=m(zt),this.userIdService=m(Ie),this.activeCartService=m(fe),this.routingService=m(Ae),this.globalMessageService=m(se),this.orderFacade=m(Rt),this.opfMetadataStoreService=m(X),this.cartAccessCodeFacade=m(Mt),this.winRef=m(st),this.renderPaymentMethodEvent$=new j({isLoading:!1,isError:!1})}executeScriptFromHtml(e){this.routingService.getRouterState().pipe(S(1),L(n=>n.state.semanticRoute===Ge)).subscribe(()=>{setTimeout(()=>{this.opfResourceLoaderService.executeScriptFromHtml(e)})})}getRenderPaymentMethodEvent(){return this.renderPaymentMethodEvent$.asObservable()}initiatePayment(e){return this.lastPaymentOptionId=e,this.renderPaymentMethodEvent$.next({isLoading:!0,isError:!1}),this.opfResourceLoaderService.clearAllResources(),te([this.userIdService.getUserId(),this.activeCartService.getActiveCartId()]).pipe(w(()=>this.opfMetadataStoreService.updateOpfMetadata({isPaymentInProgress:!0})),T(([n,a])=>this.cartAccessCodeFacade.getCartAccessCode(n,a).pipe(L(h=>!!h?.accessCode),B(({accessCode:h})=>this.getPaymentInitiationConfig(a,h,e,qt(this.winRef?.nativeWindow))))),T(n=>this.opfPaymentFacade.initiatePayment(n)),w(n=>{n instanceof Error||(this.storePaymentSessionId(n),this.renderPaymentGateway(n))}),ne(n=>this.handlePaymentInitiationError(n)),dt({shouldRetry:Te,maxTries:lt}),S(1))}storePaymentSessionId(e){let n=e.pattern===ge.FULL_PAGE&&e.paymentSessionId?e.paymentSessionId:void 0;this.opfMetadataStoreService.updateOpfMetadata({opfPaymentSessionId:n})}reloadPaymentMode(){this.lastPaymentOptionId&&this.initiatePayment(this.lastPaymentOptionId).subscribe()}renderPaymentGateway(e){if(e?.dynamicScript){let n=e?.dynamicScript?.html;this.opfResourceLoaderService.loadResources(e.dynamicScript.jsUrls,e.dynamicScript.cssUrls).then(()=>{this.renderPaymentMethodEvent$.next({isLoading:!1,isError:!1,renderType:e?.pattern,html:n}),n&&this.executeScriptFromHtml(n)}).catch(()=>{this.handleGeneralPaymentError().pipe(S(1)).subscribe()});return}if(e?.destination){this.renderPaymentMethodEvent$.next({isLoading:!1,isError:!1,renderType:e?.pattern,destination:e?.destination});return}this.handleGeneralPaymentError().pipe(S(1)).subscribe()}handlePaymentInitiationError(e){return Te(e)?Y(()=>e):Number(e.status)===ut.CONFLICT?this.handlePaymentAlreadyDoneError():this.handleGeneralPaymentError()}handlePaymentAlreadyDoneError(){return this.orderFacade.placePaymentAuthorizedOrder(!0).pipe(ne(()=>(this.onPlaceOrderError(),Ye())),T(()=>(this.onPlaceOrderSuccess(),Y(()=>"Payment already done"))))}onPlaceOrderSuccess(){this.routingService.go({cxRoute:"orderConfirmation"})}onPlaceOrderError(){this.renderPaymentMethodEvent$.next(ee(Z({},this.renderPaymentMethodEvent$.value),{isError:!0})),this.showErrorMessage("opfCheckout.errors.unknown"),this.routingService.go({cxRoute:Ge})}handleGeneralPaymentError(){return this.renderPaymentMethodEvent$.next(ee(Z({},this.renderPaymentMethodEvent$.value),{isError:!0})),this.showErrorMessage("opfPayment.errors.proceedPayment"),Y("Payment failed")}showErrorMessage(e){this.globalMessageService.add({key:e},re.MSG_TYPE_ERROR)}getPaymentInitiationConfig(e,n,a,h){return{otpKey:n,config:{cartId:e,browserInfo:h,configurationId:String(a),resultURL:this.routingService.getFullUrl({cxRoute:"paymentVerificationResult"}),cancelURL:this.routingService.getFullUrl({cxRoute:"paymentVerificationCancel"})}}}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=K({token:t,factory:t.\u0275fac})}}return t})(),ui=(()=>{class t{constructor(){this.service=m(We),this.sanitizer=m(rt),this.globalFunctionsService=m(Kt),this.vcr=m(Ze),this.renderPaymentMethodEvent$=this.service.getRenderPaymentMethodEvent(),this.RENDER_PATTERN=ge,this.sub=new ye}bypassSecurityTrustHtml(e){return this.sanitizer.bypassSecurityTrustHtml(e)}bypassSecurityTrustResourceUrl(e){return this.sanitizer.bypassSecurityTrustResourceUrl(e)}ngOnInit(){this.initiatePaymentMode()}ngOnDestroy(){this.globalFunctionsService.unregisterGlobalFunctions(he.CHECKOUT),this.sub.unsubscribe()}retryInitiatePayment(){this.service.reloadPaymentMode()}initiatePaymentMode(){this.sub.add(this.service.initiatePayment(this.selectedPaymentId).subscribe({next:e=>{this.isHostedFields(e)?this.globalFunctionsService.registerGlobalFunctions({domain:he.CHECKOUT,paymentSessionId:e.paymentSessionId,vcr:this.vcr}):this.globalFunctionsService.unregisterGlobalFunctions(he.CHECKOUT)}}))}isHostedFields(e){return!!(!(e instanceof Error)&&e?.paymentSessionId&&e?.pattern===ge.HOSTED_FIELDS)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=E({type:t,selectors:[["cx-opf-checkout-payment-wrapper"]],inputs:{selectedPaymentId:"selectedPaymentId"},standalone:!1,decls:6,vars:3,consts:[["paymentData",""],["noPaymentData",""],["loading",""],["class","cx-payment-option-container",4,"ngIf"],[1,"cx-payment-option-container"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngIf"],["class","cx-payment-link",4,"ngIf"],[1,"cx-payment-link"],[1,"btn","btn-primary",3,"href"],[1,"cx-payment-iframe",3,"src"],[3,"action","method","enctype"],["type","hidden",3,"name","value",4,"ngFor","ngForOf"],["type","submit",1,"btn","btn-primary",3,"value"],["type","hidden",3,"name","value"],[3,"innerHTML"],[4,"ngIf","ngIfElse"],["type","button",3,"click","ngClass"]],template:function(n,a){n&1&&(u(0,dn,2,4,"div",3),c(1,"async"),u(2,yn,3,2,"ng-template",null,0,$)(4,vn,3,2,"ng-template",null,1,$)),n&2&&o("ngIf",l(1,1,a.renderPaymentMethodEvent$))},dependencies:[Pe,Se,V,oe,pe,H,D],encapsulation:2,changeDetection:0})}}return t})(),He=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=x({type:t})}static{this.\u0275inj=v({providers:[We],imports:[M,F,me]})}}return t})(),tn=(()=>{class t{constructor(){this.checkoutDeliveryAddressFacade=m(Nt),this.checkoutBillingAddressFacade=m(Vt),this.userPaymentService=m(ht),this.checkoutPaymentService=m(Ut),this.activeCartService=m(fe),this.globalMessageService=m(se),this.opfCheckoutPaymentWrapperService=m(We),this._$billingAddressSub=new j(void 0),this._$isLoadingAddress=new j(!1),this._$isSameAsDelivery=new j(!0),this.billingAddress$=this._$billingAddressSub.asObservable(),this.isLoadingAddress$=this._$isLoadingAddress.asObservable(),this.isSameAsDelivery$=this._$isSameAsDelivery.asObservable()}getCountries(){return this.userPaymentService.getAllBillingCountries().pipe(w(e=>{Object.keys(e).length===0&&this.userPaymentService.loadBillingCountries()}),Qe(1))}getAddresses(){this._$isLoadingAddress.next(!0),te([this.getDeliveryAddress(),this.getPaymentAddress()]).pipe(S(1)).subscribe(([e,n])=>{!n&&e&&(this.setBillingAddress(e),this._$billingAddressSub.next(e)),n&&e&&(this.billingAddressId=n.id,this._$billingAddressSub.next(n),this._$isSameAsDelivery.next(!1)),this._$isLoadingAddress.next(!1)})}setDeliveryAddressAsPaymentAddress(){this.getDeliveryAddress().pipe(T(e=>e?this.setBillingAddress(e):ze),S(1)).subscribe({next:()=>this.setIsSameAsDeliveryValue(!0),complete:()=>{},error:()=>this.setIsSameAsDeliveryValue(!1)})}setBillingAddress(e){return this._$isLoadingAddress.next(!0),this.checkoutBillingAddressFacade.setBillingAddress(this.getAddressWithId(e)).pipe(T(()=>(this.activeCartService.reloadActiveCart(),this.activeCartService.isStable())),L(n=>n),T(()=>this.getPaymentAddress()),w(n=>{n&&n.id&&(this.billingAddressId=n.id,this._$billingAddressSub.next(n),this.opfCheckoutPaymentWrapperService.reloadPaymentMode())}),ne(n=>(this.globalMessageService.add({key:"opfCheckout.errors.updateBillingAddress"},re.MSG_TYPE_ERROR),Y(n))),Ke(()=>{this._$isLoadingAddress.next(!1)}),S(1))}get isSameAsDeliveryValue(){return this._$isSameAsDelivery.value}setIsSameAsDeliveryValue(e){this._$isSameAsDelivery.next(e)}getDeliveryAddress(){return this.checkoutDeliveryAddressFacade.getDeliveryAddressState().pipe(L(e=>!e.loading),B(e=>e.data))}getPaymentAddress(){return this.activeCartService.getActive().pipe(B(e=>e.sapBillingAddress))}getAddressWithId(e){return ee(Z({},e),{id:this.billingAddressId})}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=K({token:t,factory:t.\u0275fac})}}return t})(),fi=(()=>{class t{constructor(){this.service=m(tn),this.iconTypes=q,this.billingAddress$=this.service.billingAddress$,this.isLoadingAddress$=this.service.isLoadingAddress$,this.isSameAsDelivery$=this.service.isSameAsDelivery$,this.isEditBillingAddress=!1,this.isAddingBillingAddressInProgress=!1}ngOnInit(){this.countries$=this.service.getCountries(),this.service.getAddresses()}cancelAndHideForm(){this.isEditBillingAddress=!1,this.isAddingBillingAddressInProgress&&(this.service.setIsSameAsDeliveryValue(!0),this.isAddingBillingAddressInProgress=!1)}editCustomBillingAddress(){this.isEditBillingAddress=!0}toggleSameAsDeliveryAddress(e){let n=e.target.checked;this.service.setIsSameAsDeliveryValue(n),n?(this.service.setDeliveryAddressAsPaymentAddress(),this.isEditBillingAddress=!1):(this.isAddingBillingAddressInProgress=!0,this.isEditBillingAddress=!0)}getAddressData(e){return e?.id&&!this.isAddingBillingAddressInProgress?e:{}}onSubmitAddress(e){this.isEditBillingAddress=!1,this.isAddingBillingAddressInProgress=!1,e&&this.service.setBillingAddress(e).subscribe()}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=E({type:t,selectors:[["cx-opf-checkout-billing-address-form"]],standalone:!1,decls:9,vars:10,consts:[["loading",""],[4,"ngIf","ngIfElse"],[4,"ngIf"],[1,"form-group"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"change","checked"],[1,"form-check-label"],[1,"cx-custom-address-info"],[3,"content"],[3,"click",4,"ngIf"],[3,"click"],[3,"type"],[1,"cx-form",3,"submitAddress","backToAddress","addressData","showTitleCode","showCancelBtn","actionBtnLabel","cancelBtnLabel","setAsDefaultField","countries"]],template:function(n,a){if(n&1&&(d(0,"section"),c(1,"cxTranslate"),d(2,"h3"),g(3),c(4,"cxTranslate"),p(),u(5,In,4,8,"ng-container",1),c(6,"async"),u(7,An,1,0,"ng-template",null,0,$),p()),n&2){let h=N(8);P("aria-label",l(1,4,"opfCheckout.billingAddress")),i(3),Q(l(4,6,"opfCheckout.billingAddress")),i(2),o("ngIf",!l(6,8,a.isLoadingAddress$))("ngIfElse",h)}},dependencies:[V,Le,J,pe,Et,H,D,mi],encapsulation:2,changeDetection:0})}}return t})(),nn=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=x({type:t})}static{this.\u0275inj=v({providers:[tn],imports:[bt,M,de,Pt,ue,F,z,Ne,me,Ue]})}}return t})(),hi=(()=>{class t{constructor(){this.cartGuestUserFacade=m(Dt),this.multiCartFacade=m(Ot),this.userIdService=m(Ie),this.router=m(Ae),this.semanticPathService=m(ct),this.activeCartFacade=m(fe),this.checkoutLoginForm=new _t({email:new De("",[le.required,Ve.emailValidator]),emailConfirmation:new De("",[le.required])},{validators:Ve.emailsMustMatch("email","emailConfirmation")})}onSubmit(){let e=this.checkoutLoginForm.get("email")?.value;this.updateCartGuestUserEmail(e)}updateCartGuestUserEmail(e){te([this.userIdService.takeUserId(),this.activeCartFacade.takeActiveCartId()]).pipe(T(([n,a])=>this.cartGuestUserFacade.updateCartGuestUser(n,a,{email:e}).pipe(w(()=>this.multiCartFacade.reloadCart(a)))),S(1)).subscribe(()=>this.router.go(this.semanticPathService.get("checkoutDeliveryAddress")))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=E({type:t,selectors:[["cx-opf-checkout-email-update"]],standalone:!1,decls:29,vars:35,consts:[["requiredAsterisk",""],[3,"ngSubmit","formGroup"],[1,"form-legend"],[1,"form-group"],[1,"label-content"],[3,"ngTemplateOutlet"],["required","true","type","email","name","email","formControlName","email",1,"form-control",3,"placeholder"],["id","emailError","aria-live","off",3,"translationParams","control"],["required","true","type","email","name","emailConfirmation","formControlName","emailConfirmation",1,"form-control",3,"placeholder"],["id","emailConfirmationError","aria-live","off",3,"translationParams","control"],["type","submit",1,"btn","btn-block","btn-primary"],["aria-hidden","true",1,"text-decoration-none","required-asterisk",3,"title"]],template:function(n,a){if(n&1){let h=I();d(0,"form",1),A("ngSubmit",function(){return k(h),b(a.onSubmit())}),d(1,"p",2),g(2),c(3,"cxTranslate"),p(),d(4,"div",3)(5,"label")(6,"span",4),g(7),c(8,"cxTranslate"),u(9,Tn,0,0,"ng-template",5),p(),f(10,"input",6),c(11,"cxTranslate"),f(12,"cx-form-errors",7),c(13,"cxTranslate"),p()(),d(14,"div",3)(15,"label")(16,"span",4),g(17),c(18,"cxTranslate"),u(19,En,0,0,"ng-template",5),p(),f(20,"input",8),c(21,"cxTranslate"),f(22,"cx-form-errors",9),c(23,"cxTranslate"),p()(),d(24,"button",10),g(25),c(26,"cxTranslate"),p()(),u(27,On,3,3,"ng-template",null,0,$)}if(n&2){let h=N(28);o("formGroup",a.checkoutLoginForm),i(2),C(" ",l(3,15,"formLegend.required")," "),i(5),C(" ",l(8,17,"checkoutLogin.emailAddress.label")," "),i(2),o("ngTemplateOutlet",h),i(),G("placeholder",l(11,19,"checkoutLogin.emailAddress.placeholder")),P("aria-describedby","emailError"),i(2),o("translationParams",O(31,Zt,l(13,21,"checkoutLogin.emailAddress.label")))("control",a.checkoutLoginForm.get("email")),i(5),C(" ",l(18,23,"checkoutLogin.confirmEmail.label")," "),i(2),o("ngTemplateOutlet",h),i(),G("placeholder",l(21,25,"checkoutLogin.confirmEmail.placeholder")),P("aria-describedby","emailConfirmationError"),i(2),o("translationParams",O(33,Zt,l(23,27,"checkoutLogin.confirmEmail.label")))("control",a.checkoutLoginForm.get("emailConfirmation")),i(3),C(" ",l(26,29,"checkoutLogin.continue")," ")}},dependencies:[oe,Fe,yt,Oe,Me,Ct,we,Re,kt,D],encapsulation:2})}}return t})(),gi=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=x({type:t})}static{this.\u0275inj=v({providers:[ae({cmsComponents:{OpfCheckoutEmailUpdateComponent:{component:hi}}})],imports:[M,F,xt,de,Ne]})}}return t})(),yi=(()=>{class t{constructor(){this.opfMetadataStoreService=m(X),this.iconTypes=q}close(){this.isVisible=!1,this.opfMetadataStoreService.updateOpfMetadata({isTermsAndConditionsAlertClosed:!0})}ngOnInit(){this.opfMetadataStoreService.getOpfMetadataState().pipe(S(1),L(({isTermsAndConditionsAlertClosed:e})=>e)).subscribe(()=>{this.isVisible=!1})}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=E({type:t,selectors:[["cx-opf-checkout-terms-and-conditions-alert"]],inputs:{isDismissible:"isDismissible",isVisible:"isVisible",isExplicit:"isExplicit"},standalone:!1,decls:1,vars:1,consts:[["class","cx-opf-checkout-terms-and-conditions-alert",4,"ngIf"],[1,"cx-opf-checkout-terms-and-conditions-alert"],[1,"alert","alert-info"],["aria-hidden","true",1,"alert-icon"],[3,"type"],["tabindex","0","role","alert","aria-live","polite",1,"message"],["class","close","type","button",3,"click",4,"ngIf"],["type","button",1,"close",3,"click"]],template:function(n,a){n&1&&u(0,Dn,8,5,"div",0),n&2&&o("ngIf",a.isVisible)},dependencies:[V,J,D],encapsulation:2,changeDetection:0})}}return t})(),on=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=x({type:t})}static{this.\u0275inj=v({imports:[M,F,z]})}}return t})(),_i=(()=>{class t{constructor(){this.opfBaseService=m(je),this.opfConfig=m(Ht),this.translation=m(mt),this.opfMetadataStoreService=m(X),this.globalMessageService=m(se),this.subscription=new ye,this.paginationIndex=0,this.isHeadingDisplayed=!0,this.isPaymentRenderBelow=!0,this.isPaymentInfoMessageEnabled=!0,this.disabled=!0,this.onlyPaymentWrapperMode=!1,this.hideOnlyOnePaymentProviderLabel=!1,this.forceRadioInputsView=!1,this.forceDefaultPaymentOptionInputSelection=!1,this.isOnlyOnePaymentOptionAvailable=!1,this.iconTypes=q,this.paymentChange=new _e,this.selectedPaymentProviderName=new _e}isStateEmpty(e){return!e?.loading&&!e?.data?.value?.length}handleDefaultPaymentOptionInputSelection(e){let n=e.data?.value?.[0];if(this.isOnlyOnePaymentOptionAvailable){this.selectedPaymentId=n?.id;let a=n?.displayName;a&&this.selectedPaymentProviderName.emit(a)}this.opfMetadataStoreService.updateOpfMetadata({defaultSelectedPaymentOptionId:n?.id}),this.forceDefaultPaymentOptionInputSelection&&!this.selectedPaymentId&&(this.selectedPaymentId=n?.id)}checkIfOnlyOnePaymentOptionAvailable(e){return e.data?.value?.length===1&&e.data?.page?.totalPages===1}getActiveConfigurations(){return this.opfBaseService.getActiveConfigurationsState({pageSize:this.elementsPerPage,pageNumber:this.paginationIndex+1}).pipe(w(e=>{e.error?this.displayError("loadActiveConfigurations"):this.isStateEmpty(e)&&this.displayError("noActiveConfigurations"),e.data?.value&&!e.error&&!e.loading&&(this.paginationModel=this.getPaginationModel(e.data?.page),this.onlyPaymentWrapperMode&&this.selectedPaymentId&&(e.data.value=e.data.value.filter(n=>n.id===this.selectedPaymentId)),this.isOnlyOnePaymentOptionAvailable=this.checkIfOnlyOnePaymentOptionAvailable(e),this.handleDefaultPaymentOptionInputSelection(e))}))}updateActiveConfiguration(){this.activeConfigurations$=this.getActiveConfigurations()}getPaymentInfoMessage(e){let n="opfCheckout.defaultPaymentInfoMessage",a=e&&this.opfConfig?.opf?.paymentOption?.paymentInfoMessagesMap?this.opfConfig.opf.paymentOption.paymentInfoMessagesMap[e]??n:n;return this.translation.translate(a)}get isPaymentInfoMessageVisible(){return!!(this.opfConfig?.opf?.paymentOption?.enableInfoMessage&&this.isPaymentInfoMessageEnabled)}preselectPaymentOption(){let e=!1;this.subscription.add(this.opfMetadataStoreService.getOpfMetadataState().subscribe(n=>{!e&&(n.termsAndConditionsChecked||!this.explicitTermsAndConditions)?(e=!0,this.selectedPaymentId=n.selectedPaymentOptionId?n.selectedPaymentOptionId:n.defaultSelectedPaymentOptionId,this.opfMetadataStoreService.updateOpfMetadata({selectedPaymentOptionId:this.selectedPaymentId})):!n.termsAndConditionsChecked&&this.explicitTermsAndConditions&&(e=!1,this.selectedPaymentId=void 0)}))}displayError(e){this.globalMessageService.add({key:`opfCheckout.errors.${e}`},re.MSG_TYPE_ERROR)}changePayment(e){this.selectedPaymentId=e.id,this.opfMetadataStoreService.updateOpfMetadata({selectedPaymentOptionId:this.selectedPaymentId}),this.paymentChange.emit(e)}getPaginationModel(e){return e?.number!==void 0&&(this.paginationIndex=e.number-1),{currentPage:this.paginationIndex,pageSize:e?.size,totalPages:e?.totalPages,totalResults:e?.totalElements}}pageChange(e){this.paginationIndex=e,this.updateActiveConfiguration()}ngOnInit(){this.updateActiveConfiguration(),this.preselectPaymentOption()}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=E({type:t,selectors:[["cx-opf-checkout-payments"]],inputs:{isHeadingDisplayed:"isHeadingDisplayed",headingTranslationKey:"headingTranslationKey",isPaymentRenderBelow:"isPaymentRenderBelow",isPaymentInfoMessageEnabled:"isPaymentInfoMessageEnabled",elementsPerPage:"elementsPerPage",disabled:"disabled",explicitTermsAndConditions:"explicitTermsAndConditions",onlyPaymentWrapperMode:"onlyPaymentWrapperMode",customPaymentTemplate:"customPaymentTemplate",hideOnlyOnePaymentProviderLabel:"hideOnlyOnePaymentProviderLabel",forceRadioInputsView:"forceRadioInputsView",forceDefaultPaymentOptionInputSelection:"forceDefaultPaymentOptionInputSelection"},outputs:{paymentChange:"paymentChange",selectedPaymentProviderName:"selectedPaymentProviderName"},standalone:!1,ngContentSelectors:Fn,decls:7,vars:7,consts:[["loading",""],[4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"cx-payment-options-list"],[4,"ngFor","ngForOf"],[1,"cx-payment-options-list-pagination",3,"viewPageEvent","pagination"],[3,"selectedPaymentId",4,"ngIf"],[1,"form-check"],["role","radio","type","radio","formControlName","paymentId",1,"form-check-input",3,"change","id","value","checked","disabled"],[1,"cx-payment-type-label","form-check-label","form-radio-label",3,"for"],[1,"cx-payment-type"],["class","cx-payment-logo",3,"src","alt",4,"ngIf"],[1,"cx-payment-logo",3,"src","alt"],["class","cx-payment-info-box",4,"ngIf"],[1,"cx-payment-info-box"],["aria-hidden","true",1,"alert-icon"],[3,"type"],["tabindex","0","role","alert","aria-live","polite",1,"cx-payment-info-box-message"],[4,"ngTemplateOutlet"],[3,"selectedPaymentId"]],template:function(n,a){n&1&&(nt(),d(0,"section"),c(1,"cxTranslate"),u(2,wn,3,3,"h3",1)(3,zn,2,2,"ng-container",1),c(4,"async"),u(5,Yn,1,0,"ng-template",null,0,$),p()),n&2&&(P("aria-label",l(1,3,"opfCheckout.paymentOption")),i(2),o("ngIf",a.isHeadingDisplayed),i(),o("ngIf",l(4,5,a.activeConfigurations$)))},dependencies:[Se,V,oe,pe,It,J,ui,H,D],encapsulation:2,changeDetection:0})}}return t})(),an=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=x({type:t})}static{this.\u0275inj=v({imports:[M,F,me,At,z,He,on]})}}return t})(),Ci=(()=>{class t{constructor(){this.iconTypes=q}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=E({type:t,selectors:[["cx-opf-checkout-review-card"]],inputs:{cardContent$:"cardContent$",editConfig:"editConfig"},standalone:!1,decls:2,vars:3,consts:[[4,"ngIf"],[3,"content"],["class","cx-opf-card-review-edit-button",3,"routerLink",4,"ngIf"],[1,"cx-opf-card-review-edit-button",3,"routerLink"],[3,"type"]],template:function(n,a){n&1&&(u(0,qn,3,2,"ng-container",0),c(1,"async")),n&2&&o("ngIf",l(1,1,a.cardContent$))},dependencies:[V,ke,Le,J,H,D,Ee],encapsulation:2,changeDetection:0})}}return t})(),vi=(()=>{class t{constructor(){this.promotionLocation=wt.Checkout,this.cartOutlets=Ft}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=E({type:t,selectors:[["cx-opf-checkout-review-cart-details"]],inputs:{cart:"cart",entries:"entries"},standalone:!1,decls:9,vars:18,consts:[[1,"cx-review-cart-total","d-none","d-lg-block","d-xl-block"],[1,"cx-review-cart-item","col-md-12"],[3,"promotions"],[1,"cx-items-to-ship-label"],[3,"cxOutlet","cxOutletContext"]],template:function(n,a){n&1&&(d(0,"div",0),g(1),c(2,"cxTranslate"),p(),d(3,"div",1),f(4,"cx-promotions",2),d(5,"div",3),g(6),c(7,"cxTranslate"),p(),u(8,Zn,0,0,"ng-template",4),p()),n&2&&(i(),ot(" ",at(2,6,"cartItems.cartTotal",O(11,Jn,a.cart==null?null:a.cart.deliveryItemsQuantity)),": ",a.cart==null||a.cart.totalPrice==null?null:a.cart.totalPrice.formattedValue,`
`),i(3),o("promotions",((a.cart==null?null:a.cart.appliedOrderPromotions)||W(13,en)).concat((a.cart==null?null:a.cart.potentialOrderPromotions)||W(14,en))),i(2),C(" ",l(7,9,"opfCheckout.itemsToBeShipped")," "),i(2),o("cxOutlet",a.cartOutlets.CART_ITEM_LIST)("cxOutletContext",xe(15,Xn,a.entries,a.promotionLocation)))},dependencies:[Tt,St,D],encapsulation:2,changeDetection:0})}}return t})(),xi=(()=>{class t extends Wt{constructor(){super(...arguments),this.fb=m(vt),this.opfMetadataStoreService=m(X),this.cmsService=m(pt),this.checkoutPaymentTypeFacade=m(Xt),this.opfBaseFacade=m(je),this.defaultTermsAndConditionsFieldValue=!1,this.selectedPaymentProviderName$=new j(void 0),this.explicitTermsAndConditions$=this.cmsService.getCurrentPage().pipe(B(e=>this.isCmsComponentInPage(Yt,e))),this.checkoutSubmitForm=this.fb.group({termsAndConditions:[this.defaultTermsAndConditionsFieldValue,le.requiredTrue]}),this.getSelectedPayment$=this.opfBaseFacade.getActiveConfigurationsState(),this.getSelectedPaymentId$=this.opfMetadataStoreService.getOpfMetadataState().pipe(S(1),B(e=>e?.selectedPaymentOptionId))}get termsAndConditionInvalid(){return this.checkoutSubmitForm.invalid}get termsAndConditionsFieldValue(){return!!this.checkoutSubmitForm.get("termsAndConditions")?.value}isCmsComponentInPage(e,n){return!!n&&JSON.stringify(n).includes(e)}updateTermsAndConditionsState(){this.opfMetadataStoreService.updateOpfMetadata({termsAndConditionsChecked:this.termsAndConditionsFieldValue})}toggleTermsAndConditions(){this.updateTermsAndConditionsState()}onPaymentProviderSelected(e){this.selectedPaymentProviderName$.next(e)}ngOnInit(){this.updateTermsAndConditionsState()}static{this.\u0275fac=(()=>{let e;return function(a){return(e||(e=qe(t)))(a||t)}})()}static{this.\u0275cmp=E({type:t,selectors:[["cx-opf-checkout-payment-and-review"]],standalone:!1,features:[tt],decls:2,vars:5,consts:[[4,"ngIf"],[1,"cx-opf-review-card-wrapper"],[3,"cardContent$","editConfig",4,"ngIf"],[3,"isVisible","isExplicit","isDismissible","ngClass",4,"ngIf"],["class","cx-opf-terms-and-conditions",4,"ngIf"],[3,"elementsPerPage","explicitTermsAndConditions","disabled"],[3,"isDismissible","isVisible","isExplicit","ngClass",4,"ngIf"],[3,"cart","entries"],[3,"cardContent$","editConfig"],[3,"isVisible","isExplicit","isDismissible","ngClass"],[1,"cx-opf-terms-and-conditions"],[1,"cx-place-order-form","form-check",3,"formGroup"],[1,"form-group"],["formControlName","termsAndConditions","type","checkbox",1,"scaled-input","form-check-input",3,"change"],[1,"form-check-label"],["target","_blank","rel","noopener noreferrer",1,"cx-tc-link",3,"routerLink"],[3,"isDismissible","isVisible","isExplicit","ngClass"]],template:function(n,a){n&1&&(u(0,pi,14,18,"ng-container",0),c(1,"async")),n&2&&o("ngIf",O(3,ei,l(1,1,a.explicitTermsAndConditions$)))},dependencies:[Pe,V,_i,Fe,gt,Oe,Me,we,Re,ke,fi,yi,Ci,vi,H,D,Ee],encapsulation:2,changeDetection:0})}}return t})(),rn=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=x({type:t})}static{this.\u0275inj=v({imports:[M,be,F,ue,z,ce]})}}return t})(),Pi=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=x({type:t})}static{this.\u0275inj=v({imports:[M,F,ce,$e,Be]})}}return t})(),Si=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=x({type:t})}static{this.\u0275inj=v({providers:[ae({cmsComponents:{OpfCheckoutPaymentAndReview:{component:xi,guards:[Gt,jt]}}})],imports:[M,F,an,ce,de,be,nn,Ue,Be,$e,z,ue,on,He,rn,Pi]})}}return t})(),sn=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=x({type:t})}static{this.\u0275inj=v({imports:[Si,an,nn,He,rn,gi]})}}return t})();var So=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=x({type:t})}static{this.\u0275inj=v({imports:[sn]})}}return t})();export{So as OpfCheckoutModule};
