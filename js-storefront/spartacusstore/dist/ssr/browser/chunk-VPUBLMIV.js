import{c as Ce,d as Z,e as wi,f as Mi}from"./chunk-MOKI6WPS.js";import{$ as xe,B as ve,C as he,Ha as Ie,Ia as _e,J as yi,K as xi,L as Ti,M as Ne,Ma as Be,Mb as Pe,Na as Ue,Oa as w,P as ye,Pa as M,Z as Ii,_ as _i,b as ce,c as B,d as le,e as de,g as pe,ga as Ci,j as U,l as me,la as Oe,p as ue,qa as ki,ra as bi,s as fe,sa as Fi,ua as Te,w as ge}from"./chunk-H2QHHFZD.js";import{$b as r,Ab as _,Ad as H,Ae as ci,Af as K,Bb as h,Cc as q,Cd as V,De as li,Df as vi,Dg as F,Eb as ee,Ef as ie,Eg as O,Ge as di,Hb as Me,I as be,Ib as Se,Ic as R,Jb as Ee,Kb as Ze,Kd as C,Lb as p,Le as pi,Mb as ze,Mf as Ve,Nb as m,Ob as Ye,Oc as ni,Pa as o,Pb as Je,Pe as mi,Qb as Xe,Qf as se,Rb as ei,Rf as Ae,Tb as $,Te as ui,Ub as j,Uc as oi,Ue as Re,Wa as L,Ya as b,Za as x,_d as ai,ab as Qe,ac as a,bb as T,bc as De,d as ne,da as z,ec as ii,ee as W,ga as S,gc as ti,hb as P,he as si,ia as Fe,ib as c,kb as oe,m as ke,ma as k,me as re,n as We,na as y,ng as hi,oa as Y,pa as I,qa as g,rg as Q,sb as l,sg as N,tb as s,ub as u,uc as Le,va as E,vb as J,wa as D,wb as X,wd as ri,wf as fi,xa as Ke,xc as G,xf as gi,yb as we,ye as A,zf as ae}from"./chunk-PRP3ZKGZ.js";import{a as He}from"./chunk-25N2FLV6.js";var Ei=()=>({cxRoute:"forgotPassword"}),Di=e=>({label:e});function Gi(e,v){e&1&&u(0,"cx-spinner",10)}function qi(e,v){if(e&1&&(u(0,"cx-form-errors",11),r(1,"cxTranslate")),e&2){let i=h();c("translationParams",j(4,Di,a(1,2,"loginForm.emailAddress.label")))("control",i.form.get("userId"))}}function Hi(e,v){if(e&1&&u(0,"cx-form-errors",12),e&2){let i=h();c("control",i.form.get("userId"))}}function Wi(e,v){if(e&1&&(u(0,"cx-form-errors",13),r(1,"cxTranslate")),e&2){let i=h();c("translationParams",j(4,Di,a(1,2,"loginForm.password.label")))("control",i.form.get("password"))}}function Ki(e,v){if(e&1&&u(0,"cx-form-errors",12),e&2){let i=h();c("control",i.form.get("password"))}}var Li=()=>({cxRoute:"login"});function Qi(e,v){if(e&1){let i=we();J(0),l(1,"div",3),p(2),r(3,"async"),s(),l(4,"cx-page-slot",4),_("cxDomChange",function(n){let d=E(i).ngIf,f=h(2);return D(f.onRootNavBtnAdded(n,d))}),s(),X()}if(e&2){let i=h(2);o(2),m(" ",a(3,1,i.greeting$)," ")}}function Zi(e,v){if(e&1&&(J(0),T(1,Qi,5,3,"ng-container",2),r(2,"async"),X()),e&2){let i=h();o(),c("ngIf",a(2,1,i.greeting$))}}function zi(e,v){e&1&&(l(0,"a",5),r(1,"cxUrl"),p(2),r(3,"cxTranslate"),s()),e&2&&(c("routerLink",a(1,2,$(6,Li))),o(2),ze(a(3,4,"miniLogin.signInRegister")))}var Yi=()=>({cxRoute:"logout"});function Ji(e,v){if(e&1&&(J(0),l(1,"div",2),p(2),s(),l(3,"a",3),r(4,"cxUrl"),p(5),r(6,"cxTranslate"),s(),X()),e&2){let i=v.ngIf;o(2),Ye("",i.title,"",i.name,""),o(),c("routerLink",a(4,4,$(8,Yi))),o(2),m("",a(6,6,"myAccountV2User.signOut")," ")}}function Xi(e,v){e&1&&u(0,"cx-spinner",9)}function et(e,v){e&1&&(l(0,"h3",12),p(1),r(2,"cxTranslate"),s()),e&2&&(o(),m(" ",a(2,1,"verificationTokenDialog.title")," "))}function it(e,v){e&1&&(l(0,"span",12),p(1),r(2,"cxTranslate"),s()),e&2&&(o(),m(" ",a(2,1,"verificationTokenDialog.title")," "))}var tt=["noReceiveCodeLink"],nt=["resendLink"],ot=e=>({seconds:e}),rt=e=>({"disabled-link":e}),at=e=>({waitTime:e});function st(e,v){e&1&&u(0,"cx-spinner",14)}function ct(e,v){if(e&1&&(l(0,"div",15),p(1),r(2,"cxTranslate"),s()),e&2){let i=h();o(),m(" ",De(2,1,"register.rateLimitForRegistrationMessage",j(4,ot,i.waitTimeForRateLimit))," ")}}function lt(e,v){if(e&1&&(J(0),p(1),r(2,"cxTranslate"),X()),e&2){let i=h(2);o(),m(" ",De(2,1,"verificationTokenForm.sendRateLime",j(4,at,i.waitTime))," ")}}function dt(e,v){if(e&1){let i=we();l(0,"div",16)(1,"div",17)(2,"span",18)(3,"a",19,0),_("keydown.enter",function(){E(i);let n=h();return D(n.resendOTP())})("keydown.space",function(){E(i);let n=h();return D(n.resendOTP())})("click",function(){E(i);let n=h();return D(n.resendOTP())}),p(5),r(6,"cxTranslate"),s(),T(7,lt,3,6,"ng-container",20),s()(),l(8,"div",21)(9,"a",22,1),_("keydown",function(n){E(i);let d=h();return D(d.onOpenInfoDailogKeyDown(n))})("click",function(){E(i);let n=h();return D(n.openInfoDailog())}),p(11),r(12,"cxTranslate"),s()()()}if(e&2){let i=h();o(3),c("ngClass",j(8,rt,i.isResendDisabled)),o(2),m(" ",a(6,4,"verificationTokenForm.resend")," "),o(2),c("ngIf",i.isResendDisabled),o(4),m(" ",a(12,6,"verificationTokenForm.noReceiveCode")," ")}}var $e=(()=>{class e{constructor(i,t,n){this.auth=i,this.globalMessage=t,this.winRef=n,this.busy$=new ne(!1),this.isUpdating$=this.busy$.pipe(S(d=>{let f=this.winRef.nativeWindow?.history?.state?.newUid;f&&this.form.patchValue({userId:f}),d===!0?this.form.disable():this.form.enable()})),this.form=new pe({userId:new U("",[B.required,Pe.emailValidator]),password:new U("",B.required)})}login(){if(!this.form.valid){this.form.markAllAsTouched();return}this.busy$.next(!0),ke(this.auth.loginWithCredentials(this.form.value.userId.toLowerCase(),this.form.value.password)).pipe(Fe(this.auth.isUserLoggedIn()),S(([i,t])=>this.onSuccess(t))).subscribe()}onSuccess(i){i&&(this.globalMessage.remove(ae.MSG_TYPE_ERROR),this.form.reset()),this.busy$.next(!1)}static{this.\u0275fac=function(t){return new(t||e)(I(A),I(K),I(W))}}static{this.\u0275prov=k({token:e,factory:e.\u0275fac})}}return e})(),pt=(()=>{class e{constructor(i){this.service=i,this.form=this.service.form,this.isUpdating$=this.service.isUpdating$,this.style=!0,Ae("a11yPasswordVisibliltyBtnValueOverflow")}onSubmit(){this.service.login()}static{this.\u0275fac=function(t){return new(t||e)(L($e))}}static{this.\u0275cmp=b({type:e,selectors:[["cx-login-form"]],hostVars:2,hostBindings:function(t,n){t&2&&oe("user-form",n.style)},standalone:!1,decls:31,vars:41,consts:[["class","overlay",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"label-content"],["required","true","type","email","formControlName","userId",1,"form-control",3,"placeholder"],["id","userIdError",3,"translationParams","control",4,"cxFeature"],[3,"control",4,"cxFeature"],["required","true","type","password","formControlName","password","cxPasswordVisibilitySwitch","",1,"form-control",3,"placeholder"],["id","passwordError",3,"translationParams","control",4,"cxFeature"],[1,"btn-link",3,"routerLink"],["type","submit",1,"btn","btn-block","btn-primary",3,"disabled"],[1,"overlay"],["id","userIdError",3,"translationParams","control"],[3,"control"],["id","passwordError",3,"translationParams","control"]],template:function(t,n){if(t&1&&(T(0,Gi,1,0,"cx-spinner",0),r(1,"async"),l(2,"form",1),_("ngSubmit",function(){return n.onSubmit()}),u(3,"cx-form-required-legend"),l(4,"label")(5,"span",2),p(6),r(7,"cxTranslate"),u(8,"cx-form-required-asterisks"),s(),u(9,"input",3),r(10,"cxTranslate"),r(11,"cxTranslate"),T(12,qi,2,6,"cx-form-errors",4)(13,Hi,1,1,"cx-form-errors",5),s(),l(14,"label")(15,"span",2),p(16),r(17,"cxTranslate"),u(18,"cx-form-required-asterisks"),s(),u(19,"input",6),r(20,"cxTranslate"),r(21,"cxTranslate"),T(22,Wi,2,6,"cx-form-errors",7)(23,Ki,1,1,"cx-form-errors",5),s(),l(24,"a",8),r(25,"cxUrl"),p(26),r(27,"cxTranslate"),s(),l(28,"button",9),p(29),r(30,"cxTranslate"),s()()),t&2){let d,f;c("ngIf",a(1,20,n.isUpdating$)),o(2),c("formGroup",n.form),o(4),m(" ",a(7,22,"loginForm.emailAddress.label")," "),o(3),ee("placeholder",a(10,24,"loginForm.emailAddress.placeholder")),P("aria-label",a(11,26,"loginForm.emailAddress.label"))("aria-invalid",((d=n.form.get("userId"))==null?null:d.touched)&&((d=n.form.get("userId"))==null?null:d.invalid))("aria-errormessage","userIdError"),o(3),c("cxFeature","formErrorsDescriptiveMessages"),o(),c("cxFeature","!formErrorsDescriptiveMessages"),o(3),m(" ",a(17,28,"loginForm.password.label")," "),o(3),ee("placeholder",a(20,30,"loginForm.password.placeholder")),P("aria-label",a(21,32,"loginForm.password.placeholder"))("aria-invalid",((f=n.form.get("password"))==null?null:f.touched)&&((f=n.form.get("password"))==null?null:f.invalid))("aria-errormessage","passwordError"),o(3),c("cxFeature","formErrorsDescriptiveMessages"),o(),c("cxFeature","!formErrorsDescriptiveMessages"),o(),c("routerLink",a(25,34,$(40,Ei))),o(2),m(" ",a(27,36,"loginForm.forgotPassword")," "),o(2),c("disabled",n.form.disabled),o(),m(" ",a(30,38,"loginForm.signIn")," ")}},dependencies:[G,me,ce,le,de,ge,ue,fe,H,Ie,xe,Be,Ve,w,M,q,Q,F],encapsulation:2,changeDetection:0})}}return e})(),mt=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=x({type:e})}static{this.\u0275inj=y({providers:[C({cmsComponents:{ReturningCustomerLoginComponent:{component:pt,guards:[ie],providers:[{provide:$e,useClass:$e,deps:[A,K,W]}]}}})],imports:[R,ve,he,V,N,O,_e,Te,Ue,se,w,M]})}}return e})(),ut=(()=>{class e{constructor(i){this.activatedRoute=i,this.loginAsGuest=!1,this.routingService=g(re,{optional:!0})}ngOnInit(){this.loginAsGuest=this.activatedRoute.snapshot.queryParams.forced}navigateTo(i){this.routingService?.go({cxRoute:i})}static{this.\u0275fac=function(t){return new(t||e)(L(ri))}}static{this.\u0275cmp=b({type:e,selectors:[["cx-login-register"]],standalone:!1,decls:7,vars:7,consts:[[1,"register"],[1,"cx-section-title"],[1,"btn","btn-block","btn-secondary",3,"click","ngClass"]],template:function(t,n){t&1&&(l(0,"div",0)(1,"p",1),p(2),r(3,"cxTranslate"),s(),l(4,"button",2),_("click",function(){return n.navigateTo(n.loginAsGuest?"checkoutLogin":"register")}),p(5),r(6,"cxTranslate"),s()()),t&2&&(o(2),m(" ",a(3,3,"loginForm.dontHaveAccount")," "),o(2),c("ngClass",n.loginAsGuest?"btn-guest":"btn-register"),o(),m(" ",a(6,5,n.loginAsGuest?"loginForm.guestCheckout":"loginForm.register")," "))},dependencies:[Le,F],encapsulation:2})}}return e})(),ft=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=x({type:e})}static{this.\u0275inj=y({providers:[C({cmsComponents:{ReturningCustomerRegisterComponent:{component:ut,guards:[ie]}}})],imports:[R,V,N,Oe,O,ki]})}}return e})(),Ri=(()=>{class e{constructor(i,t,n){this.auth=i,this.userAccount=t,this.translation=n}ngOnInit(){this.user$=this.auth.isUserLoggedIn().pipe(z(i=>i?this.userAccount.get():We(void 0))),this.greeting$=this.user$.pipe(z(i=>this.translation.translate("miniLogin.userGreeting",{name:i?.name})))}onRootNavBtnAdded(i,t){i.target.setAttribute("aria-label",t)}static{this.\u0275fac=function(t){return new(t||e)(L(A),L(Ce),L(hi))}}static{this.\u0275cmp=b({type:e,selectors:[["cx-login"]],standalone:!1,decls:4,vars:4,consts:[["login",""],[4,"ngIf","ngIfElse"],[4,"ngIf"],[1,"cx-login-greet"],["cxDomChangeTargetSelector","nav ul li:first-child button","id","account-nav","position","HeaderLinks",3,"cxDomChange"],["role","link",3,"routerLink"]],template:function(t,n){if(t&1&&(T(0,Zi,3,3,"ng-container",1),r(1,"async"),T(2,zi,4,7,"ng-template",null,0,ii)),t&2){let d=Ze(3);c("ngIf",a(1,2,n.user$))("ngIfElse",d)}},dependencies:[G,H,Ci,bi,q,Q,F],encapsulation:2})}}return e})(),gt=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=x({type:e})}static{this.\u0275inj=y({providers:[C({cmsComponents:{LoginComponent:{component:Ri}}})],imports:[R,V,N,Oe,O,Fi]})}}return e})(),vt=(()=>{class e extends Ri{static{this.\u0275fac=(()=>{let i;return function(n){return(i||(i=Ke(e)))(n||e)}})()}static{this.\u0275cmp=b({type:e,selectors:[["cx-my-account-v2-user"]],standalone:!1,features:[Qe],decls:3,vars:3,consts:[[1,"cx-my-account-v2-user"],[4,"ngIf"],[1,"cx-name"],[1,"cx-sign-out",3,"routerLink"]],template:function(t,n){t&1&&(l(0,"div",0),T(1,Ji,7,9,"ng-container",1),r(2,"async"),s()),t&2&&(o(),c("ngIf",a(2,1,n.user$)))},dependencies:[G,H,q,Q,F],encapsulation:2})}}return e})(),ht=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=x({type:e})}static{this.\u0275inj=y({providers:[C({cmsComponents:{MyAccountViewUserComponent:{component:vt,guards:[vi]}}})],imports:[R,V,N,O]})}}return e})(),Vi="LOGIN",yt=(()=>{class e{constructor(){this.routingService=g(re),this.verificationTokenFacade=g(Z),this.winRef=g(W),this.busy$=new ne(!1),this.isUpdating$=this.busy$.pipe(S(i=>{let t=this.winRef.nativeWindow?.history?.state?.newUid;t&&this.form.patchValue({userId:t}),i===!0?this.form.disable():this.form.enable()})),this.form=new pe({userId:new U("",[B.required,Pe.emailValidator]),password:new U("",B.required)}),this.style=!0,Ae("a11yPasswordVisibliltyBtnValueOverflow")}onSubmit(){if(!this.form.valid){this.form.markAllAsTouched();return}this.busy$.next(!0);let i=this.collectDataFromLoginForm();this.verificationTokenFacade.createVerificationToken(i).subscribe({next:t=>this.goToVerificationTokenForm(t,i),error:t=>{this.routingService.go({cxRoute:"verifyToken"},{state:{loginId:i.loginId,password:i.password,errorStatus:t.status}}),this.busy$.next(!1)},complete:()=>this.onCreateVerificationTokenComplete()})}goToVerificationTokenForm(i,t){this.routingService.go({cxRoute:"verifyToken"},{state:{loginId:t.loginId,password:t.password,tokenId:i.tokenId,expiresIn:i.expiresIn}})}onCreateVerificationTokenComplete(){this.form.reset(),this.busy$.next(!1)}collectDataFromLoginForm(){return{loginId:this.form.value.userId.toLowerCase(),password:this.form.value.password,purpose:Vi}}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=b({type:e,selectors:[["cx-otp-login-form"]],hostVars:2,hostBindings:function(t,n){t&2&&oe("user-form",n.style)},standalone:!1,decls:28,vars:36,consts:[["class","overlay",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"label-content"],["required","true","type","email","formControlName","userId",1,"form-control",3,"placeholder"],["id","userIdError",3,"control"],["required","true","type","password","formControlName","password","cxPasswordVisibilitySwitch","",1,"form-control",3,"placeholder"],["id","passwordError",3,"control"],[1,"btn-link",3,"routerLink"],["type","submit",1,"btn","btn-block","btn-primary",3,"disabled"],[1,"overlay"]],template:function(t,n){if(t&1&&(T(0,Xi,1,0,"cx-spinner",0),r(1,"async"),l(2,"form",1),_("ngSubmit",function(){return n.onSubmit()}),u(3,"cx-form-required-legend"),l(4,"label")(5,"span",2),p(6),r(7,"cxTranslate"),u(8,"cx-form-required-asterisks"),s(),u(9,"input",3),r(10,"cxTranslate"),u(11,"cx-form-errors",4),s(),l(12,"label")(13,"span",2),p(14),r(15,"cxTranslate"),u(16,"cx-form-required-asterisks"),s(),u(17,"input",5),r(18,"cxTranslate"),r(19,"cxTranslate"),u(20,"cx-form-errors",6),s(),l(21,"a",7),r(22,"cxUrl"),p(23),r(24,"cxTranslate"),s(),l(25,"button",8),p(26),r(27,"cxTranslate"),s()()),t&2){let d,f;c("ngIf",a(1,17,n.isUpdating$)),o(2),c("formGroup",n.form),o(4),m(" ",a(7,19,"loginForm.emailAddress.label")," "),o(3),ee("placeholder",a(10,21,"loginForm.emailAddress.placeholder")),P("aria-invalid",((d=n.form.get("userId"))==null?null:d.touched)&&((d=n.form.get("userId"))==null?null:d.invalid))("aria-errormessage","userIdError"),o(2),c("control",n.form.get("userId")),o(3),m(" ",a(15,23,"loginForm.password.label")," "),o(3),ee("placeholder",a(18,25,"loginForm.password.placeholder")),P("aria-label",a(19,27,"loginForm.password.placeholder"))("aria-invalid",((f=n.form.get("password"))==null?null:f.touched)&&((f=n.form.get("password"))==null?null:f.invalid))("aria-errormessage","passwordError"),o(3),c("control",n.form.get("password")),o(),c("routerLink",a(22,29,$(35,Ei))),o(2),m(" ",a(24,31,"loginForm.forgotPassword")," "),o(2),c("disabled",n.form.disabled),o(),m(" ",a(27,33,"loginForm.signIn")," ")}},dependencies:[G,me,ce,le,de,ge,ue,fe,H,Ie,xe,Be,w,M,q,Q,F],encapsulation:2,changeDetection:0})}}return e})(),xt=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=x({type:e})}static{this.\u0275inj=y({providers:[C({cmsComponents:{ReturningCustomerOTPLoginComponent:{component:yt,guards:[ie]}}})],imports:[R,ve,he,V,N,O,_e,Te,Ue,se,w,M]})}}return e})(),Tt=(()=>{class e{constructor(i){this.launchDialogService=i,this.VERIFICATION_TOKEN_DIALOG_ACTION=wi,this.focusConfig={trap:!0,block:!0,autofocus:!0,focusOnEscape:!0}}closeModal(i){this.launchDialogService.closeDialog(i)}static{this.\u0275fac=function(t){return new(t||e)(L(ye))}}static{this.\u0275cmp=b({type:e,selectors:[["cx-verification-token-dialog"]],standalone:!1,decls:28,vars:21,consts:[["role","dialog","aria-labelledby","verification-token-dialog-title",1,"cx-verification-token-dialog","cx-modal-container","cx-asm-dialog",3,"esc","cxFocus"],[1,"cx-modal-content"],[1,"cx-dialog-header","modal-header"],[1,"info-icon"],["type","INFO"],["id","verification-token-dialog-title","class","title modal-title",4,"cxFeature"],[1,"spliter"],[1,"cx-dialog-body","modal-body"],[1,"cx-dialog-row"],[1,"cx-dialog-item"],[1,"cx-dialog-footer","modal-footer"],["type","button",1,"btn","btn-primary",3,"click"],["id","verification-token-dialog-title",1,"title","modal-title"]],template:function(t,n){t&1&&(l(0,"div",0),_("esc",function(){return n.closeModal(n.VERIFICATION_TOKEN_DIALOG_ACTION.OK)}),l(1,"div",1)(2,"div",2)(3,"div")(4,"span",3),u(5,"cx-icon",4),s(),T(6,et,3,3,"h3",5)(7,it,3,3,"span",5),s()(),u(8,"hr",6),l(9,"div",7)(10,"div",8)(11,"div",9),p(12),r(13,"cxTranslate"),s(),l(14,"div",9),p(15),r(16,"cxTranslate"),s(),l(17,"div",9),p(18),r(19,"cxTranslate"),s(),l(20,"div",9),p(21),r(22,"cxTranslate"),s()()(),l(23,"div",10)(24,"button",11),r(25,"cxTranslate"),_("click",function(){return n.closeModal(n.VERIFICATION_TOKEN_DIALOG_ACTION.OK)}),p(26),r(27,"cxTranslate"),s()()()()),t&2&&(c("cxFocus",n.focusConfig),o(6),c("cxFeature","a11yDialogsHeading"),o(),c("cxFeature","!a11yDialogsHeading"),o(5),m(" ",a(13,9,"verificationTokenDialog.noReceiveCode")," "),o(3),m(" ",a(16,11,"verificationTokenDialog.contentLine1")," "),o(3),m(" ",a(19,13,"verificationTokenDialog.contentLine2")," "),o(3),m(" ",a(22,15,"verificationTokenDialog.contentLine3")," "),o(3),P("aria-label",a(25,17,"verificationTokenDialog.ok")),o(2),m(" ",a(27,19,"verificationTokenDialog.close")," "))},dependencies:[yi,Ii,Ve,F],encapsulation:2})}}return e})(),It={launch:{[Ne.ACCOUNT_VERIFICATION_TOKEN]:{inlineRoot:!0,component:Tt,dialogType:Ti.DIALOG}}},_t=1e4,je=(()=>{class e{constructor(){this.globalMessage=g(K),this.verificationTokenFacade=g(Z),this.auth=g(A),this.busy$=new ne(!1),this.isUpdating$=this.busy$.pipe(S(i=>{i===!0?this.form.disable():this.form.enable()})),this.form=new pe({tokenId:new U("",[B.required]),tokenCode:new U("",[B.required])})}login(){if(!this.form.valid){this.form.markAllAsTouched();return}this.busy$.next(!0),ke(this.auth.otpLoginWithCredentials(this.form.value.tokenId,this.form.value.tokenCode)).pipe(Fe(this.auth.isUserLoggedIn()),S(([i,t])=>this.onSuccess(t))).subscribe()}displayMessage(i,t){this.globalMessage.add({key:i,params:t},ae.MSG_TYPE_CONFIRMATION,_t)}createVerificationToken(i,t,n){return this.verificationTokenFacade.createVerificationToken({loginId:i,password:t,purpose:n})}onSuccess(i){i&&(this.globalMessage.remove(ae.MSG_TYPE_ERROR),this.form.reset()),this.busy$.next(!1)}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275prov=k({token:e,factory:e.\u0275fac})}}return e})(),Ct=(()=>{class e{constructor(){this.service=g(je),this.launchDialogService=g(ye),this.cdr=g(ti),this.routingService=g(re),this.waitTime=60,this.form=this.service.form,this.isUpdating$=this.service.isUpdating$,this.style=!0,this.isResendDisabled=!0,this.waitTimeForRateLimit=300}ngOnInit(){history.state&&(this.tokenId=history.state.tokenId,this.password=history.state.password,this.target=history.state.loginId,this.errorStatus=history.state.errorStatus,history.pushState({tokenId:"",password:"",loginId:"",errorStatus:""},"verifyToken"),this.errorStatus===400?(this.upToRateLimit=!0,this.tokenId="invalidTokenId",this.startRateLimitWaitTimeInterval()):!this.target||!this.password||!this.tokenId?(this.service.displayMessage("verificationTokenForm.needInputCredentials",{}),this.routingService.go(["/login"])):(this.startWaitTimeInterval(),this.service.displayMessage("verificationTokenForm.createVerificationToken",{target:this.target})))}onSubmit(){this.service.login()}resendOTP(){this.isResendDisabled=!0,this.resendLink.nativeElement.tabIndex=-1,this.resendLink.nativeElement.blur(),this.waitTime=60,this.startWaitTimeInterval(),this.service.createVerificationToken(this.target,this.password,Vi).subscribe({next:i=>this.tokenId=i.tokenId,complete:()=>this.service.displayMessage("verificationTokenForm.createVerificationToken",{target:this.target})})}startWaitTimeInterval(){let i=setInterval(()=>{this.waitTime--,this.cdr.detectChanges(),this.waitTime<=0&&(clearInterval(i),this.isResendDisabled=!1,this.resendLink.nativeElement.tabIndex=0,this.cdr.detectChanges())},1e3)}openInfoDailog(){this.launchDialogService.openDialogAndSubscribe(Ne.ACCOUNT_VERIFICATION_TOKEN,this.element)}onOpenInfoDailogKeyDown(i){(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),this.openInfoDailog())}startRateLimitWaitTimeInterval(){let i=setInterval(()=>{this.waitTimeForRateLimit--,this.cdr.detectChanges(),this.waitTimeForRateLimit<=0&&(clearInterval(i),this.upToRateLimit=!1,this.isResendDisabled=!1,this.cdr.detectChanges())},1e3)}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=b({type:e,selectors:[["cx-verification-token-form"]],viewQuery:function(t,n){if(t&1&&(Me(tt,5),Me(nt,5)),t&2){let d;Se(d=Ee())&&(n.element=d.first),Se(d=Ee())&&(n.resendLink=d.first)}},hostVars:2,hostBindings:function(t,n){t&2&&oe("user-form",n.style)},standalone:!1,decls:26,vars:28,consts:[["resendLink",""],["noReceiveCodeLink",""],["class","overlay",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"label-content"],["required","true","formControlName","tokenCode","aria-describedby","tokenInputHint",1,"form-control",3,"placeholder"],[3,"control"],["class","rate-limit-error-display",4,"ngIf"],["id","tokenInputHint",1,"cx-visually-hidden"],["type","hidden","formControlName","tokenId",3,"ngModelChange","ngModel"],["class","resend-link-text",4,"ngIf"],[1,"verify-container"],["type","submit",1,"btn","btn-block","btn-primary",3,"disabled"],[1,"btn","btn-block","btn-secondary","btn-register",3,"routerLink"],[1,"overlay"],[1,"rate-limit-error-display"],[1,"resend-link-text"],[1,"left-text"],["role","timer","aria-live","polite","aria-atomic","true"],["role","button","tabindex","-1",1,"btn-link",3,"keydown.enter","keydown.space","click","ngClass"],[4,"ngIf"],[1,"right-text"],["role","button","tabindex","0",1,"btn-link",3,"keydown","click"]],template:function(t,n){t&1&&(T(0,st,1,0,"cx-spinner",2),r(1,"async"),l(2,"form",3),_("ngSubmit",function(){return n.onSubmit()}),u(3,"cx-form-required-legend"),l(4,"label")(5,"span",4),p(6),r(7,"cxTranslate"),u(8,"cx-form-required-asterisks"),s(),u(9,"input",5),r(10,"cxTranslate"),u(11,"cx-form-errors",6),T(12,ct,3,6,"div",7),s(),l(13,"span",8),p(14),r(15,"cxTranslate"),s(),l(16,"input",9),ei("ngModelChange",function(f){return Xe(n.tokenId,f)||(n.tokenId=f),f}),s(),T(17,dt,13,10,"div",10),l(18,"div",11)(19,"button",12),p(20),r(21,"cxTranslate"),s(),l(22,"button",13),r(23,"cxUrl"),p(24),r(25,"cxTranslate"),s()()()),t&2&&(c("ngIf",a(1,13,n.isUpdating$)),o(2),c("formGroup",n.form),o(4),m(" ",a(7,15,"verificationTokenForm.verificationCode.label")," "),o(3),c("placeholder",a(10,17,"verificationTokenForm.verificationCode.placeholder")),o(2),c("control",n.form.get("tokenCode")),o(),c("ngIf",n.upToRateLimit),o(2),m(" ",a(15,19,"verificationTokenForm.tokenInputHint")," "),o(2),Je("ngModel",n.tokenId),o(),c("ngIf",!n.upToRateLimit),o(2),c("disabled",n.form.disabled),o(),m(" ",a(21,21,"verificationTokenForm.verify")," "),o(2),c("routerLink",a(23,23,$(27,Li))),o(2),m(" ",a(25,25,"verificationTokenForm.back")," "))},dependencies:[Le,G,me,ce,le,de,ge,ue,fe,H,Ie,xe,w,M,q,Q,F],encapsulation:2,changeDetection:0})}}return e})(),kt=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=x({type:e})}static{this.\u0275inj=y({providers:[C({cmsComponents:{VerifyOTPTokenComponent:{component:Ct,guards:[ie],providers:[{provide:je,useClass:je,deps:[A,K,Z,W]}]}}}),C(It)],imports:[R,ve,xi,he,V,N,_i,O,_e,Te,se,w,M]})}}return e})(),Ai=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=x({type:e})}static{this.\u0275inj=y({imports:[gt,mt,kt,ft,ht,xt]})}}return e})();var Bi=new Y("UserAccountNormalizer"),on=new Y("UserAccountSerializer"),Ui=new Y("VerificationTokenNormalizer"),Pi=new Y("LoginFormSerializer"),te=class{},qe=(()=>{class e{constructor(i){this.adapter=i}get(i){return this.adapter.load(i)}createVerificationToken(i){return this.adapter.createVerificationToken(i)}static{this.\u0275fac=function(t){return new(t||e)(I(te))}}static{this.\u0275prov=k({token:e,factory:e.\u0275fac})}}return e})(),Ni=(()=>{class e{constructor(i,t,n){this.userAccountConnector=i,this.userIdService=t,this.query=n,this.userQuery=this.query.create(()=>this.userIdService.takeUserId(!0).pipe(z(d=>this.userAccountConnector.get(d))),{reloadOn:[Mi],resetOn:[gi,fi]})}getById(i){return this.userAccountConnector.get(i)}get(){return this.userQuery.get()}static{this.\u0275fac=function(t){return new(t||e)(I(qe),I(ai),I(mi))}}static{this.\u0275prov=k({token:e,factory:e.\u0275fac})}}return e})(),Oi=(()=>{class e{constructor(){this.connector=g(qe),this.command=g(pi),this.createVerificationTokenCommand=this.command.create(({verificationTokenCreation:i})=>this.connector.createVerificationToken(i))}createVerificationToken(i){return this.createVerificationTokenCommand.execute({verificationTokenCreation:i})}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275prov=k({token:e,factory:e.\u0275fac})}}return e})(),bt=[Ni,{provide:Ce,useExisting:Ni},Oi,{provide:Z,useExisting:Oi}],$i=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=x({type:e})}static{this.\u0275inj=y({providers:[qe,...bt]})}}return e})();var Ft={backend:{occ:{endpoints:{user:"users/${userId}",createVerificationToken:"users/anonymous/verificationToken"}}}},wt={"Content-Type":"application/json"},Mt=(()=>{class e{constructor(i,t,n){this.http=i,this.occEndpoints=t,this.converter=n,this.logger=g(si)}load(i){let t=this.occEndpoints.buildUrl("user",{urlParams:{userId:i}});return this.http.get(t).pipe(be(n=>{throw Re(n,this.logger)}),this.converter.pipeable(Bi))}createVerificationToken(i){let t=this.occEndpoints.buildUrl("createVerificationToken"),n=li.createHeader(ci,!0,new ni(He({},wt)));return i=this.converter.convert(i,Pi),this.http.post(t,i,{headers:n}).pipe(be(d=>{throw Re(d,this.logger)}),this.converter.pipeable(Ui))}static{this.\u0275fac=function(t){return new(t||e)(I(oi),I(di),I(ui))}}static{this.\u0275prov=k({token:e,factory:e.\u0275fac})}}return e})(),ji=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=x({type:e})}static{this.\u0275inj=y({providers:[C(Ft),{provide:te,useClass:Mt}]})}}return e})();var xn=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=x({type:e})}static{this.\u0275inj=y({imports:[$i,ji,Ai]})}}return e})();export{xn as UserAccountModule};
