import{b as _r}from"./chunk-MTN5X6Q6.js";import{C as dt,F as Yr,G as me,H as P,I as Br,J as Wr,K as Rt,L as qr,M as zr,R as f,S as Kr,U as K,c as Dr,d as Mr,e as Fr,f as br,g as Ur,h as wr,i as Or,j as Vr,k as Lr,l as jr,n as $r,q as Se,r as ye,s as Ae,t as Nr,u as xr,v as Pr,w as Gr,x as kr,y as Hr}from"./chunk-EU5ZHKTW.js";import{kc as Tr}from"./chunk-H2QHHFZD.js";import{$ as ue,$d as pe,Af as Ie,D as l,F as Je,Gf as ct,He as Er,Hf as mt,I as b,Ic as sr,Ie as le,J as tt,K as Xe,Ke as gr,Le as at,M as S,Me as z,Oe as ve,Pe as Ee,Q as T,Qe as ge,R as tr,Re as Ir,Ud as d,W as er,Wd as U,Xd as ur,Y as rr,Yd as L,Za as W,Zd as hr,_d as q,a as yt,bf as fr,da as v,e as Ke,ed as Ce,ee as At,fc as ir,fd as nr,ga as N,gd as rt,hd as R,he as st,ia as g,id as D,ig as Rr,jd as ar,kd as cr,ke as Cr,m as V,ma as p,me as pr,n as M,na as B,nd as y,nf as j,oa as et,od as it,oe as nt,p as Qe,pa as c,pd as E,q as o,qa as m,qd as or,r as X,rf as w,s as F,sf as Sr,te as lr,tf as yr,ve as x,vf as Ar,we as vr,xa as he,yf as mr,yg as fe,z as Ze,zd as dr,zf as $,zg as ot}from"./chunk-PRP3ZKGZ.js";import{a as C,b as I}from"./chunk-25N2FLV6.js";var ni="cart",h="[Multi Cart] Multi Cart Data",H="addVoucher",te="[Cart-entry] Add Entry",ft="[Cart-entry] Add Entry Success",ee="[Cart-entry] Add Entry Fail",we="[Cart-entry] Remove Entry",re="[Cart-entry] Remove Entry Success",Oe="[Cart-entry] Remove Entry Fail",Ve="[Cart-entry] Update Entry",ie="[Cart-entry] Update Entry Success",Le="[Cart-entry] Update Entry Fail",ht=class extends d.EntityProcessesIncrementAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=te}},Ct=class extends d.EntityProcessesDecrementAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=ft}},pt=class extends d.EntityProcessesDecrementAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=ee,this.error=n.error}},Tt=class extends d.EntityProcessesIncrementAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=we}},_t=class extends d.EntityProcessesDecrementAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=re}},Dt=class extends d.EntityProcessesDecrementAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=Oe,this.error=n.error}},Mt=class extends d.EntityProcessesIncrementAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=Ve}},Ft=class extends d.EntityProcessesDecrementAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=ie}},bt=class extends d.EntityProcessesDecrementAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=Le,this.error=n.error}},St="[Cart-voucher] Add Cart Vouchers",je="[Cart-voucher] Add Cart Voucher Fail",se="[Cart-voucher] Add Cart Voucher Success",ai="[Cart-voucher] Reset Add Cart Voucher",ne="[Cart-voucher] Remove Cart Voucher",$e="[Cart-voucher] Remove Cart Voucher Fail",ae="[Cart-voucher] Remove Cart Voucher Success",Ut=class extends d.EntityLoadAction{constructor(n){super(ct,H),this.payload=n,this.type=St}},wt=class extends d.EntityFailAction{constructor(n){super(ct,H,n.error),this.payload=n,this.type=je}},Ot=class extends d.EntitySuccessAction{constructor(n){super(ct,H),this.payload=n,this.type=se}},Vt=class extends d.EntityLoaderResetAction{constructor(){super(ct,H),this.type=ai}},Lt=class extends d.EntityProcessesIncrementAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=ne}},jt=class extends d.EntityProcessesDecrementAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=$e,this.error=n.error}},$t=class extends d.EntityProcessesDecrementAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=ae}},Q="[Cart] Create Cart",Ne="[Cart] Create Cart Fail",Z="[Cart] Create Cart Success",lt="[Cart] Load Cart",ci="[Cart] Load Cart Fail",G="[Cart] Load Cart Success",xe="[Cart] Load Carts Success",Pe="[Cart] Add Email to Cart",oi="[Cart] Add Email to Cart Fail",di="[Cart] Add Email to Cart Success",Ge="[Cart] Merge Cart",ke="[Cart] Merge Cart Success",ui="[Cart] Reset Cart Details",He="[Cart] Remove Cart",ce="[Cart] Delete Cart",oe="[Cart] Delete Cart Success",Ye="[Cart] Delete Cart Fail",vt=class extends d.EntityLoadAction{constructor(n){super(h,n.tempCartId),this.payload=n,this.type=Q}},Nt=class extends d.EntityFailAction{constructor(n){super(h,n.tempCartId,n.error),this.payload=n,this.type=Ne}},xt=class extends d.EntitySuccessAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=Z}},Pt=class extends d.EntityProcessesIncrementAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=Pe}},Gt=class extends d.EntityProcessesDecrementAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=oi,this.error=n.error}},kt=class extends d.EntityProcessesDecrementAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=di}},A=class extends d.EntityLoadAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=lt}},Et=class extends d.EntityFailAction{constructor(n){super(h,n.cartId,n.error),this.payload=n,this.type=ci}},Ht=class extends d.EntitySuccessAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=G}},Re=class extends d.EntitySuccessAction{constructor(n){super(h,n.map(t=>t?.code??"")),this.payload=n,this.type=xe}},Yt=class{constructor(n){this.payload=n,this.type=Ge}},Bt=class extends d.EntityRemoveAction{constructor(n){super(h,n.oldCartId),this.payload=n,this.type=ke}},Wt=class extends d.ProcessesLoaderResetAction{constructor(){super(h),this.type=ui}},Y=class extends d.EntityRemoveAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=He}},qt=class{constructor(n){this.payload=n,this.type=ce}},zt=class extends d.EntityRemoveAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=oe}},Kt=class{constructor(n){this.payload=n,this.type=Ye,this.error=n.error}},hi="[Cart] Cart Processes Increment",Ci="[Cart] Cart Processes Decrement",Qt="[Cart] Set Active Cart Id",Be="[Cart] Clear Cart State",We="[Cart] Set cart type index",qe="[Cart] Set cart data",Zt=class extends d.EntityProcessesIncrementAction{constructor(n){super(h,n),this.payload=n,this.type=hi}},gt=class extends d.EntityProcessesDecrementAction{constructor(n){super(h,n),this.payload=n,this.type=Ci}},It=class{constructor(n){this.payload=n,this.type=Qt}},Jt=class extends d.EntityRemoveAllAction{constructor(){super(h),this.type=Be}},O=class{constructor(n){this.payload=n,this.type=We}},Te=class extends d.EntitySuccessAction{constructor(n){super(h,n.cartId),this.payload=n,this.type=qe}},Ds=Object.freeze({__proto__:null,ADD_EMAIL_TO_CART:Pe,ADD_EMAIL_TO_CART_FAIL:oi,ADD_EMAIL_TO_CART_SUCCESS:di,AddEmailToCart:Pt,AddEmailToCartFail:Gt,AddEmailToCartSuccess:kt,CART_ADD_ENTRY:te,CART_ADD_ENTRY_FAIL:ee,CART_ADD_ENTRY_SUCCESS:ft,CART_ADD_VOUCHER:St,CART_ADD_VOUCHER_FAIL:je,CART_ADD_VOUCHER_SUCCESS:se,CART_PROCESSES_DECREMENT:Ci,CART_PROCESSES_INCREMENT:hi,CART_REMOVE_ENTRY:we,CART_REMOVE_ENTRY_FAIL:Oe,CART_REMOVE_ENTRY_SUCCESS:re,CART_REMOVE_VOUCHER:ne,CART_REMOVE_VOUCHER_FAIL:$e,CART_REMOVE_VOUCHER_SUCCESS:ae,CART_RESET_ADD_VOUCHER:ai,CART_UPDATE_ENTRY:Ve,CART_UPDATE_ENTRY_FAIL:Le,CART_UPDATE_ENTRY_SUCCESS:ie,CLEAR_CART_STATE:Be,CREATE_CART:Q,CREATE_CART_FAIL:Ne,CREATE_CART_SUCCESS:Z,CartAddEntry:ht,CartAddEntryFail:pt,CartAddEntrySuccess:Ct,CartAddVoucher:Ut,CartAddVoucherFail:wt,CartAddVoucherSuccess:Ot,CartProcessesDecrement:gt,CartProcessesIncrement:Zt,CartRemoveEntry:Tt,CartRemoveEntryFail:Dt,CartRemoveEntrySuccess:_t,CartRemoveVoucher:Lt,CartRemoveVoucherFail:jt,CartRemoveVoucherSuccess:$t,CartResetAddVoucher:Vt,CartUpdateEntry:Mt,CartUpdateEntryFail:bt,CartUpdateEntrySuccess:Ft,ClearCartState:Jt,CreateCart:vt,CreateCartFail:Nt,CreateCartSuccess:xt,DELETE_CART:ce,DELETE_CART_FAIL:Ye,DELETE_CART_SUCCESS:oe,DeleteCart:qt,DeleteCartFail:Kt,DeleteCartSuccess:zt,LOAD_CART:lt,LOAD_CARTS_SUCCESS:xe,LOAD_CART_FAIL:ci,LOAD_CART_SUCCESS:G,LoadCart:A,LoadCartFail:Et,LoadCartSuccess:Ht,LoadCartsSuccess:Re,MERGE_CART:Ge,MERGE_CART_SUCCESS:ke,MergeCart:Yt,MergeCartSuccess:Bt,REMOVE_CART:He,RESET_CART_DETAILS:ui,RemoveCart:Y,ResetCartDetails:Wt,SET_ACTIVE_CART_ID:Qt,SET_CART_DATA:qe,SET_CART_TYPE_INDEX:We,SetActiveCartId:It,SetCartData:Te,SetCartTypeIndex:O}),_e=class{},pi=(()=>{class e{constructor(t){this.adapter=t}add(t,r,i,s,a){return this.adapter.add(t,r,i,s,a)}update(t,r,i,s,a,u=!1){return this.adapter.update(t,r,i,s,a,u)}remove(t,r,i){return this.adapter.remove(t,r,i)}static{this.\u0275fac=function(r){return new(r||e)(c(_e))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),wi=(()=>{class e{constructor(t,r){this.actions$=t,this.cartEntryConnector=r,this.contextChange$=this.actions$.pipe(E(x.CURRENCY_CHANGE,x.LANGUAGE_CHANGE)),this.logger=m(st),this.addEntry$=y(()=>this.actions$.pipe(E(te),o(i=>i.payload),tt(i=>this.cartEntryConnector.add(i.userId,i.cartId,i.productCode,i.quantity,i.pickupStore).pipe(o(s=>new Ct(C(C({},i),s))),b(s=>V([new pt(I(C({},i),{error:w(s,this.logger)})),new A({cartId:i.cartId,userId:i.userId})])))),j(this.contextChange$))),this.removeEntry$=y(()=>this.actions$.pipe(E(we),o(i=>i.payload),tt(i=>this.cartEntryConnector.remove(i.userId,i.cartId,i.entryNumber).pipe(o(()=>new _t(C({},i))),b(s=>V([new Dt(I(C({},i),{error:w(s,this.logger)})),new A({cartId:i.cartId,userId:i.userId})])))),j(this.contextChange$))),this.updateEntry$=y(()=>this.actions$.pipe(E(Ve),o(i=>i.payload),tt(i=>this.cartEntryConnector.update(i.userId,i.cartId,i.entryNumber,i.quantity,i.pickupStore,i.pickupToDelivery).pipe(o(()=>new Ft(C({},i))),b(s=>V([new bt(I(C({},i),{error:w(s,this.logger)})),new A({cartId:i.cartId,userId:i.userId})])))),j(this.contextChange$)))}static{this.\u0275fac=function(r){return new(r||e)(c(it),c(pi))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac})}}return e})(),De=class{},li=(()=>{class e{constructor(t){this.adapter=t}add(t,r,i){return this.adapter.add(t,r,i)}remove(t,r,i){return this.adapter.remove(t,r,i)}static{this.\u0275fac=function(r){return new(r||e)(c(De))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Oi=(()=>{class e{constructor(t,r,i){this.actions$=t,this.cartVoucherConnector=r,this.messageService=i,this.logger=m(st),this.addCartVoucher$=y(()=>this.actions$.pipe(E(St),o(s=>s.payload),F(s=>this.cartVoucherConnector.add(s.userId,s.cartId,s.voucherId).pipe(o(()=>(this.showGlobalMessage("voucher.applyVoucherSuccess",s.voucherId,$.MSG_TYPE_CONFIRMATION),new Ot(C({},s)))),b(a=>V([new wt(I(C({},s),{error:w(a,this.logger)})),new gt(s.cartId),new A({userId:s.userId,cartId:s.cartId})])))))),this.removeCartVoucher$=y(()=>this.actions$.pipe(E(ne),o(s=>s.payload),F(s=>this.cartVoucherConnector.remove(s.userId,s.cartId,s.voucherId).pipe(o(()=>(this.showGlobalMessage("voucher.removeVoucherSuccess",s.voucherId,$.MSG_TYPE_INFO),new $t({userId:s.userId,cartId:s.cartId,voucherId:s.voucherId}))),b(a=>V([new jt({error:w(a,this.logger),cartId:s.cartId,userId:s.userId,voucherId:s.voucherId}),new A({userId:s.userId,cartId:s.cartId})]))))))}showGlobalMessage(t,r,i){this.messageService.add({key:t,params:{voucherCode:r}},i)}static{this.\u0275fac=function(r){return new(r||e)(c(it),c(li),c(Ie))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac})}}return e})();function k(e,n){return n===U?e?.guid??"":e?.code??""}function vi(e=""){return e.startsWith("selectivecart")}function Ei(e){return e.reason==="notFound"&&e.subjectType==="cart"&&!vi(e.subject)}function Vi(e){return e.message==="coupon.already.redeemed"}function Li(e){return e.message==="coupon.invalid.code.provided"}function ji(e){return e.type==="VoucherOperationError"}function $i(e){return e.type==="CartError"||e.type==="CartAddressError"||e.type==="CartEntryError"||e.type==="CartEntryGroupError"}function Qr(e){return e.startsWith("temp-")}function ut(e){return!e||typeof e=="object"&&Object.keys(e).length===0}function Ni(e){return e?!!e.match(fr):!1}function xi(e,n){return e!==U&&n!==e}var de=ar(ni),J=D(de,e=>e.carts),gi=e=>D(J,n=>d.entityProcessesLoaderStateSelector(n,e)),ze=e=>D(J,n=>d.entityValueSelector(n,e)),Ii=e=>D(J,n=>d.entityIsStableSelector(n,e)),fi=e=>D(J,n=>d.entityHasPendingProcessesSelector(n,e)),Xt=e=>D(ze(e),n=>n&&n.entries?n.entries:[]),Si=(e,n)=>D(Xt(e),t=>t.find(r=>r.product?.code===n)),yi=D(J,e=>Object.keys(e.entities).map(n=>d.entityValueSelector(e,n))),Ai=D(de,e=>e.index),mi=e=>D(Ai,n=>n&&n[e]),Me=class{},Ri=(()=>{class e{constructor(t){this.adapter=t}loadAll(t){return this.adapter.loadAll(t)}load(t,r){return this.adapter.load(t,r)}create(t,r,i){return this.adapter.create(t,r,i)}delete(t,r){return this.adapter.delete(t,r)}save(t,r,i,s){return this.adapter.save(t,r,i,s)}addEmail(t,r,i){return this.adapter.addEmail(t,r,i)}static{this.\u0275fac=function(r){return new(r||e)(c(Me))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Pi=(()=>{class e{handleLoadCartError(t,r){if(r?.error?.errors){if(r.error.errors.filter(a=>a.reason==="invalid").length>0)return M(new A(C({},t)));if(r.error.errors.filter(a=>Ei(a)||a.reason==="UnknownResourceError").length>0)return M(new Y({cartId:t.cartId}))}return M(new Et(I(C({},t),{error:w(r,this.logger)})))}constructor(t,r,i){this.actions$=t,this.cartConnector=r,this.store=i,this.contextChange$=this.actions$.pipe(E(x.CURRENCY_CHANGE,x.LANGUAGE_CHANGE)),this.logger=m(st),this.loadCart$=y(()=>this.actions$.pipe(E(lt),o(s=>s.payload),er(s=>s.cartId),F(s=>s.pipe(v(a=>M(a).pipe(g(this.store.pipe(R(fi(a.cartId)))))),l(([a,u])=>!u),o(([a])=>a),v(a=>this.cartConnector.load(a.userId,a.cartId).pipe(F(u=>{let _=[];return u?(_.push(new Ht(I(C({},a),{cart:u,cartId:k(u,a.userId)}))),a.cartId===L&&_.push(new Y({cartId:L}))):_=[new Et(I(C({},a),{error:{}}))],_}),b(u=>this.handleLoadCartError(a,u)))))),j(this.contextChange$))),this.createCart$=y(()=>this.actions$.pipe(E(Q),o(s=>s.payload),F(s=>this.cartConnector.create(s.userId,s.oldCartId,s.toMergeCartGuid).pipe(v(a=>{let u=[];return s.oldCartId&&u.push(new Bt({extraData:s.extraData,userId:s.userId,tempCartId:s.tempCartId,cartId:k(a,s.userId),oldCartId:s.oldCartId})),[new xt(I(C({},s),{cart:a,cartId:k(a,s.userId)})),new Y({cartId:s.tempCartId}),...u]}),b(a=>M(new Nt(I(C({},s),{error:w(a,this.logger)})))))),j(this.contextChange$))),this.mergeCart$=y(()=>this.actions$.pipe(E(Ge),o(s=>s.payload),v(s=>this.cartConnector.load(s.userId,L).pipe(o(a=>{if(a?.code!==s.cartId)return new vt({userId:s.userId,oldCartId:s.cartId,toMergeCartGuid:a?a.guid:void 0,extraData:s.extraData,tempCartId:s.tempCartId})}),l(nt))),j(this.contextChange$))),this.refresh$=y(()=>this.actions$.pipe(E(se),o(s=>s.payload),tt(s=>V([new gt(s.cartId),new A({userId:s.userId,cartId:s.cartId})])))),this.refreshWithoutProcesses$=y(()=>this.actions$.pipe(E(ft,re,ie,ae),o(s=>s.payload),o(s=>new A({userId:s.userId,cartId:s.cartId})))),this.resetCartDetailsOnSiteContextChange$=y(()=>this.actions$.pipe(E(x.LANGUAGE_CHANGE,x.CURRENCY_CHANGE),F(()=>[new Wt]))),this.addEmail$=y(()=>this.actions$.pipe(E(Pe),o(s=>s.payload),F(s=>this.cartConnector.addEmail(s.userId,s.cartId,s.email).pipe(F(()=>[new kt(C({},s)),new A({userId:s.userId,cartId:s.cartId})]),b(a=>V([new Gt(I(C({},s),{error:w(a,this.logger)})),new A({userId:s.userId,cartId:s.cartId})])))),j(this.contextChange$))),this.deleteCart$=y(()=>this.actions$.pipe(E(ce),o(s=>s.payload),F(s=>this.cartConnector.delete(s.userId,s.cartId).pipe(o(()=>new zt(C({},s))),b(a=>V([new Kt(I(C({},s),{error:w(a,this.logger)})),new A(C({},s))]))))))}static{this.\u0275fac=function(r){return new(r||e)(c(it),c(Ri),c(rt))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac})}}return e})(),Ti=(()=>{class e{getActiveCartTypeOnLoadSuccess(t){if(t?.payload?.extraData?.active)return t.payload?.cart.saveTime?new O({cartType:f.ACTIVE,cartId:""}):new O({cartType:f.ACTIVE,cartId:t.meta.entityId})}static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac})}}return e})(),Gi=(()=>{class e{getActiveCartTypeOnLoad(t){if(t?.payload?.cartId===L)return new O({cartType:f.ACTIVE,cartId:""})}getActiveCartTypeOnLoadSuccess(t){return this.multiCartEffectsService.getActiveCartTypeOnLoadSuccess(t)}getActiveCartTypeOnCreate(t){if(t?.payload?.extraData?.active)return new O({cartType:f.ACTIVE,cartId:t.meta.entityId})}constructor(t,r){this.actions$=t,this.multiCartEffectsService=r,this.processesIncrement$=y(()=>this.actions$.pipe(E(St),o(i=>i.payload),o(i=>new Zt(i.cartId)))),this.setSelectiveId$=y(()=>this.actions$.pipe(E(G),o(i=>{switch(i.type){case G:{let s=i.payload;if(vi(s.cartId))return new O({cartType:f.SELECTIVE,cartId:s.cartId});break}}}),l(nt))),this.setActiveCartId$=y(()=>this.actions$.pipe(E(G,lt,Z,Q,Qt),o(i=>{switch(i.type){case lt:return this.getActiveCartTypeOnLoad(i);case G:return this.getActiveCartTypeOnLoadSuccess(i);case Q:return this.getActiveCartTypeOnCreate(i);case Z:return new O({cartType:i?.payload?.extraData?.active?f.ACTIVE:f.NEW_CREATED,cartId:i.meta.entityId});case Qt:return new O({cartType:f.ACTIVE,cartId:i.payload})}}),l(nt)))}static{this.\u0275fac=function(r){return new(r||e)(c(it),c(Ti))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac})}}return e})(),ki=[wi,Oi,Pi,Gi],Zr={[f.ACTIVE]:""};function Hi(e=Zr,n){switch(n.type){case We:return I(C({},e),{[n.payload.cartType]:n.payload.cartId});case He:case oe:return n.payload?.cartId===e[f.ACTIVE]?I(C({},e),{[f.ACTIVE]:""}):e;case Be:return Zr}return e}var Yi=void 0;function Bi(e=Yi,n){switch(n.type){case xe:return n.payload;case G:case Z:case qe:return n.payload.cart}return e}function Wi(e){return function(n,t){return t.type===hr.LOGOUT&&(n=void 0),e(n,t)}}var qi=[Wi],_i=new et("MultiCartReducers");function zi(){return{carts:d.entityProcessesLoaderReducer(h,Bi),index:Hi}}var Ki={provide:_i,useFactory:zi},Ms=Object.freeze({__proto__:null,getCartEntitySelectorFactory:gi,getCartEntriesSelectorFactory:Xt,getCartEntrySelectorFactory:Si,getCartHasPendingProcessesSelectorFactory:fi,getCartIdByTypeFactory:mi,getCartIsStableSelectorFactory:Ii,getCartSelectorFactory:ze,getCartTypeIndex:Ai,getCartsSelectorFactory:yi,getMultiCartEntities:J,getMultiCartState:de}),Qi=(()=>{class e{constructor(t,r,i){this.statePersistenceService=t,this.store=r,this.siteContextParamsService=i,this.subscription=new yt}initSync(){this.subscription.add(this.statePersistenceService.syncWithStorage({key:"cart",state$:this.getCartState(),context$:this.siteContextParamsService.getValues([lr]),storageType:Er.LOCAL_STORAGE,onRead:t=>this.onRead(t)}))}getCartState(){return this.store.pipe(l(t=>!!t.cart),R(de),l(t=>!!t),o(t=>t.index),tr("Active"),o(t=>({active:t[f.ACTIVE]??""})))}onRead(t){this.store.dispatch(new Jt),t?this.store.dispatch(new It(t.active)):this.store.dispatch(new It(""))}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(r){return new(r||e)(c(Sr),c(rt),c(Rr))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Zi(e,n){return()=>Qe(n.getStable("context").pipe(N(()=>{e.initSync()})))}function Ji(){return n=>(t,r)=>{let i=C({},t);return r.type==="@ngrx/store/init"&&(i.cart=I(C({},i.cart),{index:{[f.ACTIVE]:void 0}})),n(i,r)}}var Xi=(()=>{class e{static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275mod=W({type:e})}static{this.\u0275inj=B({providers:[{provide:Ir,useFactory:Zi,deps:[Qi,Ar],multi:!0},{provide:nr,useFactory:Ji,multi:!0}]})}}return e})(),Fe=class{},Di=(()=>{class e{constructor(){this.adapter=m(Fe)}getCartAccessCode(t,r){return this.adapter.getCartAccessCode(t,r)}static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac})}}return e})(),Fs=new et("CartAccessCodeNormalizer"),be=class{},Mi=(()=>{class e{constructor(){this.adapter=m(be)}createCartGuestUser(t,r,i){return this.adapter.createCartGuestUser(t,r,i)}updateCartGuestUser(t,r,i){return this.adapter.updateCartGuestUser(t,r,i)}static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac})}}return e})(),bs=new et("CartGuestUserNormalizer"),Us=new et("CartValidationNormalizer"),Ue=class{},Fi=(()=>{class e{constructor(t){this.adapter=t}validate(t,r){return this.adapter.validate(t,r)}static{this.\u0275fac=function(r){return new(r||e)(c(Ue))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),ts=(()=>{class e{constructor(t,r,i,s){this.actionsSubject=t,this.event=r,this.activeCartService=i,this.stateEventService=s,this.register()}register(){this.registerCreateCart(),this.registerAddEntry(),this.registerRemoveEntry(),this.registerUpdateEntry(),this.registerDeleteCart(),this.registerAddCartVoucher(),this.registerRemoveCartVoucher(),this.registerMergeCartSuccess()}registerAddEntry(){this.registerMapped({action:te,event:br}),this.registerMapped({action:ft,event:Ur}),this.registerMapped({action:ee,event:wr})}registerRemoveEntry(){this.registerMapped({action:re,event:Vr}),this.registerMapped({action:Oe,event:Or})}registerUpdateEntry(){this.registerMapped({action:ie,event:Lr}),this.registerMapped({action:Le,event:jr})}registerMergeCartSuccess(){this.registerMapped({action:ke,event:$r})}registerCreateCart(){this.stateEventService.register({action:Q,event:Dr}),this.stateEventService.register({action:Z,event:Mr}),this.stateEventService.register({action:Ne,event:Fr})}registerDeleteCart(){this.stateEventService.register({action:ce,event:Se,factory:t=>z(Se,I(C({},t.payload),{cartCode:t.payload.cartId}))}),this.stateEventService.register({action:oe,event:ye,factory:t=>z(ye,I(C({},t.payload),{cartCode:t.payload.cartId}))}),this.stateEventService.register({action:Ye,event:Ae,factory:t=>z(Ae,I(C({},t.payload),{cartCode:t.payload.cartId}))})}registerAddCartVoucher(){this.stateEventService.register({action:St,event:Nr}),this.stateEventService.register({action:se,event:xr}),this.stateEventService.register({action:je,event:Pr})}registerRemoveCartVoucher(){this.stateEventService.register({action:ne,event:Gr}),this.stateEventService.register({action:ae,event:kr}),this.stateEventService.register({action:$e,event:Hr})}registerMapped(t){let r=this.getAction(t.action).pipe(v(i=>M(i).pipe(g(this.activeCartService.getActive(),this.activeCartService.getActiveCartId()))),l(([i,s,a])=>i.payload.cartId===a),o(([i,s])=>z(t.event,I(C({},i.payload),{cartCode:s.code,entry:i.payload.entry?i.payload.entry:s.entries?.[Number(i.payload.entryNumber)]}))));return this.event.register(t.event,r)}getAction(t){return this.actionsSubject.pipe(E(...[].concat(t)))}static{this.\u0275fac=function(r){return new(r||e)(c(Ce),c(ve),c(P),c(mr))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),es=(()=>{class e{constructor(t){}static{this.\u0275fac=function(r){return new(r||e)(c(ts))}}static{this.\u0275mod=W({type:e})}static{this.\u0275inj=B({})}}return e})(),rs=(()=>{class e{constructor(t){this.eventService=t,this.register()}register(){this.eventService.register(me,this.buildCartPageEvent())}buildCartPageEvent(){return this.eventService.get(Tr).pipe(l(t=>t.semanticRoute==="cart"),o(t=>z(me,{navigation:t})))}static{this.\u0275fac=function(r){return new(r||e)(c(ve))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),is=(()=>{class e{constructor(t){}static{this.\u0275fac=function(r){return new(r||e)(c(rs))}}static{this.\u0275mod=W({type:e})}static{this.\u0275inj=B({})}}return e})(),Jr=(()=>{class e{constructor(t,r,i){this.multiCartFacade=t,this.userIdService=r,this.winRef=i,this.subscription=new yt,this.activeCartId$=this.userIdService.getUserId().pipe(S(1),v(()=>this.multiCartFacade.getCartIdByType(f.ACTIVE)),l(s=>s!==void 0),o(s=>s===""?L:s)),this.cartEntity$=this.activeCartId$.pipe(v(s=>this.multiCartFacade.getCartEntity(s))),this.shouldLoadCartOnCodeFlow=!0,this.checkInitLoad=void 0,this.initActiveCart(),this.detectUserChange()}initActiveCart(){let t=this.cartEntity$.pipe(o(i=>({cart:i.value,isStable:!i.loading&&i.processesCount===0,loaded:!!((i.error||i.success)&&!i.loading)})),l(({isStable:i,cart:s})=>i||ut(s))),r=t.pipe(g(this.activeCartId$,this.userIdService.getUserId()),N(([{cart:i,loaded:s,isStable:a},u,_])=>{a&&ut(i)&&!s&&!Qr(u)&&this.shouldLoadCartOnCodeFlow&&this.load(u,_)}));this.activeCart$=Je(()=>r.subscribe(),()=>t).pipe(o(({cart:i})=>i||{}),T(),ue({bufferSize:1,refCount:!0}))}detectUserChange(){this.subscription.add(this.userIdService.getUserId().pipe(rr(),g(this.activeCartId$)).subscribe(([[t,r],i])=>{xi(r,t)&&this.loadOrMerge(i,r,t)})),this.isLoggedInWithCodeFlow()&&(this.shouldLoadCartOnCodeFlow=!1,this.subscription.add(this.userIdService.getUserId().pipe(g(this.activeCartId$)).subscribe(([t,r])=>{this.loadOrMerge(r,t,U),this.winRef?.localStorage?.removeItem(pe)})))}getActive(){return this.activeCart$}takeActive(){return this.isStable().pipe(l(t=>t),v(()=>this.getActive()),l(t=>!!t),S(1))}getActiveCartId(){return this.activeCart$.pipe(g(this.userIdService.getUserId()),o(([t,r])=>k(t,r)),T())}takeActiveCartId(){return this.isStable().pipe(l(t=>t),v(()=>this.getActiveCartId()),l(t=>!!t),S(1))}getEntries(){return this.activeCartId$.pipe(v(t=>this.multiCartFacade.getEntries(t)),T())}getLastEntry(t){return this.activeCartId$.pipe(v(r=>this.multiCartFacade.getLastEntry(r,t)),T())}getLoading(){return this.cartEntity$.pipe(o(t=>!!t.loading),T())}isStable(){return this.activeCartId$.pipe(v(t=>this.multiCartFacade.isStable(t)))}load(t,r){r===U&&t===L||this.multiCartFacade.loadCart({userId:r,cartId:t,extraData:{active:!0}})}loadOrMerge(t,r,i){t===L||i!==U?this.multiCartFacade.loadCart({userId:r,cartId:t,extraData:{active:!0}}):ge(this.isGuestCart())?this.guestCartMerge(t):this.multiCartFacade.mergeToCurrentCart({userId:r,cartId:t,extraData:{active:!0}})}guestCartMerge(t){this.getEntries().pipe(S(1)).subscribe(r=>{this.multiCartFacade.deleteCart(t,U),this.addEntriesGuestMerge(r)})}addEntriesGuestMerge(t){let r=t.map(i=>({productCode:i.product?.code??"",quantity:i.quantity??0}));this.requireLoadedCart(!0).pipe(g(this.userIdService.getUserId())).subscribe(([i,s])=>{this.multiCartFacade.addEntries(s,k(i,s),r)})}isCartCreating(t,r){return Qr(r)&&(t.loading||t.success||t.error)}isLoggedInWithCodeFlow(){return!!this.winRef?.localStorage?.getItem(pe)}requireLoadedCart(t=!1){this.checkInitLoad=this.checkInitLoad===void 0;let r=(t?this.cartEntity$.pipe(l(()=>!ge(this.isGuestCart()))):this.cartEntity$).pipe(l(i=>!i.loading||!!this.checkInitLoad));return this.activeCartId$.pipe(g(r),l(([i,s])=>!this.isCartCreating(s,i)),o(([,i])=>i),S(1)).pipe(g(this.userIdService.getUserId()),N(([i,s])=>{ut(i.value)&&s!==U&&!i.loading&&this.load(L,s),this.checkInitLoad=!1}),v(()=>r),g(this.userIdService.getUserId()),l(([i,s])=>!!(s===U||i.success||i.error)),S(1)).pipe(N(([i,s])=>{ut(i.value)&&this.multiCartFacade.createCart({userId:s,extraData:{active:!0}})}),v(()=>r),l(i=>!!(i.success||i.error)),g(this.activeCartId$),l(([i,s])=>!this.isCartCreating(i,s)),o(([i])=>i.value),l(i=>!ut(i)),S(1))}addEntry(t,r,i){this.requireLoadedCart().pipe(g(this.userIdService.getUserId())).subscribe(([s,a])=>{this.multiCartFacade.addEntry(a,k(s,a),t,r,i)})}removeEntry(t){this.activeCartId$.pipe(g(this.userIdService.getUserId()),S(1)).subscribe(([r,i])=>{this.multiCartFacade.removeEntry(i,r,t.entryNumber)})}updateEntry(t,r,i,s=!1){this.activeCartId$.pipe(g(this.userIdService.getUserId()),S(1)).subscribe(([a,u])=>{this.multiCartFacade.updateEntry(u,a,t,r,i,s)})}getEntry(t){return this.activeCartId$.pipe(v(r=>this.multiCartFacade.getEntry(r,t)),T())}addEmail(t){this.activeCartId$.pipe(g(this.userIdService.getUserId()),S(1)).subscribe(([r,i])=>{this.multiCartFacade.assignEmail(r,i,t)})}getAssignedUser(){return this.activeCart$.pipe(o(t=>t.user))}isGuestCart(t){return t?M(this.isCartUserGuest(t)):this.activeCart$.pipe(o(r=>this.isCartUserGuest(r)),T())}isCartUserGuest(t){let r=t.user;return!!(r&&(r.name===ur||Ni(r.uid?.split("|").slice(1).join("|"))))}addEntries(t){let r=t.map(i=>({productCode:i.product?.code??"",quantity:i.quantity??0}));this.requireLoadedCart().pipe(g(this.userIdService.getUserId())).subscribe(([i,s])=>{i&&this.multiCartFacade.addEntries(s,k(i,s),r)})}reloadActiveCart(){X([this.getActiveCartId(),this.userIdService.takeUserId()]).pipe(S(1),o(([t,r])=>{this.multiCartFacade.loadCart({cartId:t,userId:r,extraData:{active:!0}})})).subscribe()}hasPickupItems(){return this.getActive().pipe(o(t=>t.pickupItemsQuantity?t.pickupItemsQuantity>0:!1))}hasDeliveryItems(){return this.getActive().pipe(o(t=>t.deliveryItemsQuantity?t.deliveryItemsQuantity>0:!1))}getPickupEntries(){return this.getEntries().pipe(o(t=>t.filter(r=>r.deliveryPointOfService!==void 0)))}getDeliveryEntries(){return this.getEntries().pipe(o(t=>t.filter(r=>r.deliveryPointOfService===void 0)))}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(r){return new(r||e)(c(dt),c(q),c(At))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac})}}return e})(),Xr=(()=>{class e{constructor(){this.queryService=m(Ee),this.commandService=m(at),this.cartAccessCodeConnector=m(Di),this.getCartAccessCodeCommand=this.commandService.create(({userId:t,cartId:r})=>this.cartAccessCodeConnector.getCartAccessCode(t,r))}getCartAccessCode(t,r){return this.getCartAccessCodeCommand.execute({userId:t,cartId:r})}static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac})}}return e})(),ti=(()=>{class e{constructor(){this.queryService=m(Ee),this.commandService=m(at),this.cartGuestUserConnector=m(Mi),this.createCartGuestUserCommand=this.commandService.create(({userId:t,cartId:r,guestUserDetails:i})=>this.cartGuestUserConnector.createCartGuestUser(t,r,i)),this.updateCartGuestUserCommand=this.commandService.create(({userId:t,cartId:r,guestUserDetails:i})=>this.cartGuestUserConnector.updateCartGuestUser(t,r,i))}createCartGuestUser(t,r,i){return this.createCartGuestUserCommand.execute({userId:t,cartId:r,guestUserDetails:i})}updateCartGuestUser(t,r,i){return this.updateCartGuestUserCommand.execute({userId:t,cartId:r,guestUserDetails:i})}static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac})}}return e})(),bi=(()=>{class e{constructor(t){this.routingService=t,this.NAVIGATION_SKIPS=2,this.navigationIdCount=0,this.subscription=new yt,this.cartValidationResult$=new Ke(1),this.checkForValidationResultClear$=this.routingService.getRouterState().pipe(g(this.cartValidationResult$),N(([r,i])=>{this.navigationIdCount+this.NAVIGATION_SKIPS<=r.navigationId&&i.length&&(this.cartValidationResult$.next([]),this.navigationIdCount=r.navigationId)})),this.setInitialState()}ngOnDestroy(){this.subscription.unsubscribe()}setInitialState(){this.setNavigationIdStep(),this.subscription.add(this.checkForValidationResultClear$.subscribe())}updateValidationResultAndRoutingId(t){this.cartValidationResult$.next(t),this.setNavigationIdStep()}setNavigationIdStep(){this.routingService.getRouterState().pipe(S(1)).subscribe(t=>this.navigationIdCount=t.navigationId)}static{this.\u0275fac=function(r){return new(r||e)(c(pr))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),ei=(()=>{class e{constructor(t,r,i,s,a){this.cartValidationConnector=t,this.command=r,this.userIdService=i,this.activeCartFacade=s,this.cartValidationStateService=a,this.validateCartCommand=this.command.create(()=>X([this.activeCartFacade.getActiveCartId(),this.userIdService.takeUserId(),this.activeCartFacade.isStable()]).pipe(l(([u,_,Ui])=>Ui),S(1),v(([u,_])=>this.cartValidationConnector.validate(u,_))),{strategy:gr.CancelPrevious})}validateCart(){return this.validateCartCommand.execute()}getValidationResults(){return this.cartValidationStateService.cartValidationResult$}static{this.\u0275fac=function(r){return new(r||e)(c(Fi),c(at),c(q),c(P),c(bi))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac})}}return e})(),ri=(()=>{class e{constructor(t,r,i){this.store=t,this.activeCartFacade=r,this.userIdService=i}addVoucher(t,r){this.combineUserAndCartId(r).subscribe(([i,s])=>this.store.dispatch(new Ut({userId:i,cartId:s,voucherId:t})))}removeVoucher(t,r){this.combineUserAndCartId(r).subscribe(([i,s])=>this.store.dispatch(new Lt({userId:i,cartId:s,voucherId:t})))}getAddVoucherResultError(){return this.store.pipe(R(mt.getProcessErrorFactory(H)))}getAddVoucherResultSuccess(){return this.store.pipe(R(mt.getProcessSuccessFactory(H)))}getAddVoucherResultLoading(){return this.store.pipe(R(mt.getProcessLoadingFactory(H)))}resetAddVoucherProcessingState(){this.store.dispatch(new Vt)}combineUserAndCartId(t){return t?this.userIdService.getUserId().pipe(S(1),o(r=>[r,t])):X([this.userIdService.getUserId(),this.activeCartFacade.getActiveCartId()]).pipe(S(1))}static{this.\u0275fac=function(r){return new(r||e)(c(rt),c(P),c(q))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac})}}return e})(),ii=(()=>{class e{constructor(t,r){this.store=t,this.userIdService=r,this.windowRef=m(At)}getCart(t){return this.store.pipe(R(ze(t)))}getCarts(){return this.store.pipe(R(yi))}getCartEntity(t){return this.store.pipe(R(gi(t)))}isStable(t){return this.store.pipe(R(Ii(t)),Xe(r=>r?Ze(0):M(void 0)),T())}generateTempCartId(){let t=new Uint32Array(1);return this.windowRef.nativeWindow?.crypto.getRandomValues(t),`temp-${t[0].toString(36).substring(2,11)}`}createCart({userId:t,oldCartId:r,toMergeCartGuid:i,extraData:s}){let a=this.generateTempCartId();return this.store.dispatch(new vt({extraData:s,userId:t,oldCartId:r,toMergeCartGuid:i,tempCartId:a})),this.getCartIdByType(s?.active?f.ACTIVE:f.NEW_CREATED).pipe(v(u=>this.getCart(u)),l(nt))}mergeToCurrentCart({userId:t,cartId:r,extraData:i}){let s=this.generateTempCartId();this.store.dispatch(new Yt({userId:t,cartId:r,extraData:i,tempCartId:s}))}loadCart({cartId:t,userId:r,extraData:i}){this.store.dispatch(new A({userId:r,cartId:t,extraData:i}))}getEntries(t){return this.store.pipe(R(Xt(t)))}getLastEntry(t,r){return this.store.pipe(R(Xt(t)),o(i=>{let s=i.filter(a=>a.product?.code===r);return s?s[s.length-1]:void 0}))}addEntry(t,r,i,s,a){this.store.dispatch(new ht({userId:t,cartId:r,productCode:i,quantity:s,pickupStore:a}))}addEntries(t,r,i){i.forEach(s=>{this.store.dispatch(new ht({userId:t,cartId:r,productCode:s.productCode,quantity:s.quantity}))})}removeEntry(t,r,i){this.store.dispatch(new Tt({userId:t,cartId:r,entryNumber:`${i}`}))}updateEntry(t,r,i,s,a,u=!1){s!==void 0&&s<=0?this.removeEntry(t,r,i):this.store.dispatch(new Mt({userId:t,cartId:r,pickupStore:a,pickupToDelivery:u,entryNumber:`${i}`,quantity:s}))}getEntry(t,r){return this.store.pipe(R(Si(t,r)))}assignEmail(t,r,i){this.store.dispatch(new Pt({userId:r,cartId:t,email:i}))}removeCart(t){this.store.dispatch(new Y({cartId:t}))}deleteCart(t,r){this.store.dispatch(new qt({userId:r,cartId:t}))}reloadCart(t,r){this.userIdService.takeUserId().subscribe(i=>this.store.dispatch(new A({userId:i,cartId:t,extraData:r})))}getCartIdByType(t){return this.store.pipe(R(mi(t)),T())}static{this.\u0275fac=function(r){return new(r||e)(c(rt),c(q))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac})}}return e})(),si=(()=>{class e{constructor(t,r,i,s){this.userProfileFacade=t,this.multiCartFacade=r,this.baseSiteService=i,this.userIdService=s}getCart(){return this.selectiveCart$||(this.selectiveCart$=X([this.getSelectiveCartId(),this.userProfileFacade.get(),this.userIdService.getUserId(),this.baseSiteService.getActive()]).pipe(T(),N(([t,r,i,s])=>{!t&&i!==U&&r?.customerId&&this.multiCartFacade.loadCart({userId:i,cartId:`selectivecart${s}${r.customerId}`})}),l(([t])=>!!t),v(([t])=>this.multiCartFacade.getCart(t)),ue({bufferSize:1,refCount:!0}))),this.selectiveCart$}getEntries(){return this.getSelectiveCartId().pipe(v(t=>this.multiCartFacade.getEntries(t)))}isStable(){return this.getSelectiveCartId().pipe(v(t=>this.multiCartFacade.isStable(t)))}addEntry(t,r){this.getSelectiveIdWithUserId().subscribe(([i,s])=>{this.multiCartFacade.addEntry(s,i,t,r)})}removeEntry(t){this.getSelectiveIdWithUserId().subscribe(([r,i])=>{this.multiCartFacade.removeEntry(i,r,t.entryNumber)})}updateEntry(t,r){this.getSelectiveIdWithUserId().subscribe(([i,s])=>{this.multiCartFacade.updateEntry(s,i,t,r)})}getEntry(t){return this.getSelectiveCartId().pipe(v(r=>this.multiCartFacade.getEntry(r,t)))}getSelectiveCartId(){return this.multiCartFacade.getCartIdByType(f.SELECTIVE)}getSelectiveIdWithUserId(){return this.getSelectiveCartId().pipe(T(),g(this.userIdService.getUserId()),S(1))}static{this.\u0275fac=function(r){return new(r||e)(c(_r),c(dt),c(vr),c(q))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac})}}return e})(),ss=[Jr,{provide:P,useExisting:Jr},ri,{provide:qr,useExisting:ri},ii,{provide:dt,useExisting:ii},si,{provide:zr,useExisting:si},ei,{provide:Rt,useExisting:ei},Xr,{provide:Br,useExisting:Xr},ti,{provide:Wr,useExisting:ti}],ns=(()=>{class e extends ot{constructor(){super(...arguments),this.responseStatus=fe.BAD_REQUEST}getPriority(){return le.NORMAL}hasMatch(t){return super.hasMatch(t)&&this.getErrors(t).some($i)}handleError(t,r){this.handleCartNotFoundError(t,r),this.handleOtherCartErrors(t,r)}handleCartNotFoundError(t,r){this.getErrors(r).filter(i=>Ei(i)).forEach(()=>{this.globalMessageService.add({key:"httpHandlers.cartNotFound"},$.MSG_TYPE_ERROR)})}handleOtherCartErrors(t,r){this.getErrors(r).filter(i=>i.reason!=="notFound"||i.subjectType!=="cart").forEach(i=>{this.globalMessageService.add(i.message?i.message:{key:"httpHandlers.otherCartErrors"},$.MSG_TYPE_ERROR)})}getErrors(t){return(t.error?.errors||[]).filter(r=>r.type!=="JaloObjectNoLongerValidError")}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=he(e)))(i||e)}})()}static{this.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),as=(()=>{class e extends ot{constructor(){super(...arguments),this.responseStatus=fe.BAD_REQUEST}getPriority(){return le.NORMAL}hasMatch(t){return super.hasMatch(t)&&this.getErrors(t).some(ji)}handleError(t,r){this.handleVoucherExceededError(t,r),this.handleVoucherInvalidError(t,r)}handleVoucherExceededError(t,r){this.getErrors(r).filter(i=>Vi(i)).forEach(()=>{this.globalMessageService.add({key:"httpHandlers.voucherExceeded"},$.MSG_TYPE_ERROR)})}handleVoucherInvalidError(t,r){this.getErrors(r).filter(i=>Li(i)).forEach(()=>{this.globalMessageService.add({key:"httpHandlers.invalidCodeProvided"},$.MSG_TYPE_ERROR)})}getErrors(t){return(t.error?.errors||[]).filter(r=>r.type!=="JaloObjectNoLongerValidError")}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=he(e)))(i||e)}})()}static{this.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),cs=(()=>{class e{static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275mod=W({type:e})}static{this.\u0275inj=B({providers:[Ki,Ti],imports:[sr,yr,cr.forFeature(ni,_i,{metaReducers:qi}),or.forFeature(ki)]})}}return e})(),ws=(()=>{class e{static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275mod=W({type:e})}static{this.\u0275inj=B({providers:[Ri,pi,li,Fi,Di,Mi,...ss,{provide:ot,useExisting:ns,multi:!0},{provide:ot,useExisting:as,multi:!0}],imports:[es,cs,Xi,is]})}}return e})(),os=(()=>{class e{constructor(t){this.config=t}isSelectiveCartEnabled(){return!!this.config?.cart?.selectiveCart?.enabled}isCartValidationEnabled(){return!!this.config?.cart?.validation?.enabled}static{this.\u0275fac=function(r){return new(r||e)(c(Yr))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Os=(()=>{class e{constructor(t,r,i,s,a,u,_){this.cartValidationService=t,this.semanticPathService=r,this.router=i,this.globalMessageService=s,this.activeCartService=a,this.cartValidationStateService=u,this.cartConfigService=_,this.GLOBAL_MESSAGE_TIMEOUT=1e4}canActivate(){return this.cartConfigService.isCartValidationEnabled()?this.cartValidationService.validateCart().pipe(g(this.activeCartService.getEntries()),o(([t,r])=>{if(this.cartValidationStateService.updateValidationResultAndRoutingId(t.cartModifications??[]),t.cartModifications!==void 0&&t.cartModifications.length!==0){let i,s=t.cartModifications[0];return r.length===1&&r[0].product?.code===s.entry?.product?.code&&s.statusCode===Kr.NO_STOCK?i={key:"validation.cartEntryRemoved",params:{name:s.entry?.product?.name}}:i={key:"validation.cartEntriesChangeDuringCheckout"},this.globalMessageService.add(i,$.MSG_TYPE_ERROR,this.GLOBAL_MESSAGE_TIMEOUT),this.activeCartService.reloadActiveCart(),this.router.parseUrl(this.semanticPathService.get("cart")??"")}return!0})):M(!0)}static{this.\u0275fac=function(r){return new(r||e)(c(Rt),c(Cr),c(dr),c(Ie),c(P),c(bi),c(os))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Vs=(()=>{class e{constructor(t){this.actionsSubject=t,this.logger=m(st)}getResults(t){return this.actionsSubject.pipe(E(ft,ee),l(r=>r.payload.cartId===t),o(r=>this.mapMessages(r)))}mapMessages(t){let{productCode:r}=t.payload;if(t instanceof Ct){let{quantity:i,quantityAdded:s,entry:a,statusCode:u}=t.payload;if(u===K.LOW_STOCK)return{productCode:r,statusCode:u,productName:a?.product?.name,quantity:i,quantityAdded:s};if(u===K.SUCCESS||u===K.NO_STOCK)return{productCode:r,statusCode:u,productName:a?.product?.name}}else if(t instanceof pt){let{error:i}=t.payload;if(i?.details[0]?.type==="UnknownIdentifierError")return{productCode:r,statusCode:K.UNKNOWN_IDENTIFIER}}return ir()&&this.logger.warn("Unrecognized cart add entry action type while mapping messages",t),{productCode:r,statusCode:K.UNKNOWN_ERROR}}static{this.\u0275fac=function(r){return new(r||e)(c(Ce))}}static{this.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();export{h as a,Ds as b,_e as c,De as d,k as e,vi as f,ut as g,Me as h,Ri as i,Ms as j,Fe as k,Fs as l,be as m,bs as n,Us as o,Ue as p,ws as q,os as r,Os as s,Vs as t};
