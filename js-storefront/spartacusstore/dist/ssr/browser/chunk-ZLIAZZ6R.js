import{c as te}from"./chunk-E4GOOKTU.js";import{c as J,f as W}from"./chunk-MOKI6WPS.js";import{b as B,d as V,e as X,f as ee}from"./chunk-MTN5X6Q6.js";import{mb as Y,ob as $}from"./chunk-H2QHHFZD.js";import{Ae as E,Ce as H,De as P,Ge as q,I as a,If as Q,Kd as x,Ke as T,Le as w,M as k,Oc as h,Oe as G,Pe as Z,Qc as N,Te as z,Uc as L,Ue as d,Za as f,_d as y,da as g,fg as K,ga as v,gd as O,he as _,ma as u,na as l,oa as m,pa as o,q as j,qa as M,ye as A,za as D}from"./chunk-PRP3ZKGZ.js";import{a as R}from"./chunk-25N2FLV6.js";var F=new m("UserProfileNormalizer"),ne=new m("UserProfileSerializer"),je=new m("UserSerializer"),ce=new m("UserSignUpSerializer"),ae=new m("TitleNormalizer"),C=class{},I=(()=>{class r{constructor(e){this.userProfileAdapter=e}update(e,t){return this.userProfileAdapter.update(e,t)}register(e){return this.userProfileAdapter.register(e)}registerGuest(e,t){return this.userProfileAdapter.registerGuest(e,t)}requestForgotPasswordEmail(e){return this.userProfileAdapter.requestForgotPasswordEmail(e)}resetPassword(e,t){return this.userProfileAdapter.resetPassword(e,t)}updateEmail(e,t,s){return this.userProfileAdapter.updateEmail(e,t,s)}updatePassword(e,t,s){return this.userProfileAdapter.updatePassword(e,t,s)}remove(e){return this.userProfileAdapter.close(e)}getTitles(){return this.userProfileAdapter.loadTitles()}static{this.\u0275fac=function(t){return new(t||r)(o(C))}}static{this.\u0275prov=u({token:r,factory:r.\u0275fac})}}return r})(),re=(()=>{class r{constructor(e,t,s){this.userIdService=e,this.userProfileConnector=t,this.command=s,this.updateCommand=this.command.create(i=>this.userIdService.takeUserId(!0).pipe(g(n=>this.userProfileConnector.updateEmail(n,i.password,i.newUid))),{strategy:T.Queue})}update(e,t){return this.updateCommand.execute({password:e,newUid:t})}static{this.\u0275fac=function(t){return new(t||r)(o(y),o(I),o(w))}}static{this.\u0275prov=u({token:r,factory:r.\u0275fac})}}return r})(),ie=(()=>{class r{constructor(e,t,s){this.userProfileConnector=e,this.userIdService=t,this.command=s,this.updateCommand=this.command.create(i=>this.userIdService.takeUserId(!0).pipe(k(1),g(n=>this.userProfileConnector.updatePassword(n,i.oldPassword,i.newPassword)))),this.resetCommand=this.command.create(i=>this.userProfileConnector.resetPassword(i.token,i.password)),this.requestForgotPasswordEmailCommand=this.command.create(i=>this.userProfileConnector.requestForgotPasswordEmail(i.email))}update(e,t){return this.updateCommand.execute({oldPassword:e,newPassword:t})}reset(e,t){return this.resetCommand.execute({token:e,password:t})}requestForgotPasswordEmail(e){return this.requestForgotPasswordEmailCommand.execute({email:e})}static{this.\u0275fac=function(t){return new(t||r)(o(I),o(y),o(w))}}static{this.\u0275prov=u({token:r,factory:r.\u0275fac})}}return r})(),b=(()=>{class r{constructor(e,t,s,i,n,c,p){this.userAccountService=e,this.authService=t,this.userProfileConnector=s,this.eventService=i,this.userIdService=n,this.query=c,this.command=p,this.updateCommand=this.command.create(S=>this.userIdService.takeUserId(!0).pipe(g(pe=>this.userProfileConnector.update(pe,S.details).pipe(v(()=>{this.eventService.dispatch({user:S.details},W)})))),{strategy:T.Queue}),this.closeCommand=this.command.create(()=>this.userIdService.takeUserId(!0).pipe(g(S=>this.userProfileConnector.remove(S).pipe(v(()=>this.authService.logout()))))),this.titleQuery=this.query.create(()=>this.userProfileConnector.getTitles(),{reloadOn:[K]})}get(){return this.userAccountService.get()}update(e){return this.updateCommand.execute({details:e})}close(){return this.closeCommand.execute(void 0)}getTitles(){return this.titleQuery.get().pipe(j(e=>e??[]))}static{this.\u0275fac=function(t){return new(t||r)(o(J),o(A),o(I),o(G),o(y),o(Z),o(w))}}static{this.\u0275prov=u({token:r,factory:r.\u0275fac})}}return r})(),se=(()=>{class r{constructor(e,t,s,i,n){this.userProfile=e,this.userConnector=t,this.authService=s,this.command=i,this.store=n,this.registerCommand=this.command.create(({user:c})=>this.userConnector.register(c).pipe(v(()=>{this.store.dispatch(new Q.RegisterUserSuccess)}))),this.registerGuestCommand=this.command.create(c=>this.userConnector.registerGuest(c.guid,c.password).pipe(v(p=>{this.authService.loginWithCredentials(p.uid,c.password)})))}register(e){return this.registerCommand.execute({user:e})}registerGuest(e,t){return this.registerGuestCommand.execute({guid:e,password:t})}getTitles(){return this.userProfile.getTitles()}static{this.\u0275fac=function(t){return new(t||r)(o(b),o(I),o(A),o(w),o(O))}}static{this.\u0275prov=u({token:r,factory:r.\u0275fac})}}return r})(),le=[re,ie,b,se,{provide:V,useExisting:re},{provide:X,useExisting:ie},{provide:B,useExisting:b},{provide:ee,useExisting:se}],de=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=f({type:r})}static{this.\u0275inj=l({providers:[I,...le]})}}return r})();var me={backend:{occ:{endpoints:{userRegister:"users",userForgotPassword:"forgottenpasswordtokens",userRestoreToken:"passwordRestoreToken",userResetPassword:"resetpassword",userUpdateLoginId:"users/${userId}/login",userUpdatePassword:"users/${userId}/password",titles:"titles"}}}},U={"Content-Type":"application/json"},fe={"Content-Type":"application/x-www-form-urlencoded"},ge=(()=>{class r{constructor(e,t,s){this.http=e,this.occEndpoints=t,this.converter=s,this.logger=M(_),this.captchaConfig=M(Y,{optional:!0}),this.injector=M(D,{optional:!0})}update(e,t){let s=this.occEndpoints.isConfigured("userUpdateProfile")?"userUpdateProfile":"user",i=this.occEndpoints.buildUrl(s,{urlParams:{userId:e}});return t=this.converter.convert(t,ne),this.http.patch(i,t).pipe(a(n=>{throw d(n,this.logger)}))}register(e){let t=this.occEndpoints.buildUrl("userRegister"),s=new h(R({},U));return s=P.createHeader(E,!0,s),s=this.appendCaptchaToken(s),e=this.converter.convert(e,ce),this.http.post(t,e,{headers:s}).pipe(a(i=>{throw d(i,this.logger)}),this.converter.pipeable(F))}registerGuest(e,t){let s=this.occEndpoints.buildUrl("userRegister"),i=new h(R({},fe));i=P.createHeader(E,!0,i),i=this.appendCaptchaToken(i);let n=new N().set("guid",e).set("password",t);return this.http.post(s,n,{headers:i}).pipe(a(c=>{throw d(c,this.logger)}),this.converter.pipeable(F))}requestForgotPasswordEmail(e){let t=this.occEndpoints.buildUrl("userRestoreToken"),s={loginId:e},i=new h(U);return i=P.createHeader(E,!0,i),this.http.post(t,s,{headers:i}).pipe(a(n=>{throw d(n,this.logger)}))}resetPassword(e,t){let s=this.occEndpoints.buildUrl("userResetPassword"),i=new h(R({},U));return i=P.createHeader(E,!0,i),this.http.post(s,{token:e,newPassword:t},{headers:i}).pipe(a(n=>{throw d(n,this.logger)}))}updateEmail(e,t,s){let i=this.occEndpoints.buildUrl("userUpdateLoginId",{urlParams:{userId:e}}),n={newLoginId:s,password:t},c=new h(U);return this.http.post(i,n,{headers:c}).pipe(a(p=>{throw d(p,this.logger)}))}updatePassword(e,t,s){let i=this.occEndpoints.buildUrl("userUpdatePassword",{urlParams:{userId:e}}),n={oldPassword:t,newPassword:s},c=new h(U);return this.http.post(i,n,{headers:c}).pipe(a(p=>{throw d(p,this.logger)}))}close(e){let t=this.occEndpoints.isConfigured("userCloseAccount")?"userCloseAccount":"user",s=this.occEndpoints.buildUrl(t,{urlParams:{userId:e}});return this.http.delete(s).pipe(a(i=>{throw d(i,this.logger)}))}loadTitles(){let e=this.occEndpoints.buildUrl("titles");return this.http.get(e).pipe(a(t=>{throw d(t,this.logger)}),j(t=>t.titles??[]),this.converter.pipeableMany(ae))}appendCaptchaToken(e){if(this.injector&&this.captchaConfig?.captchaRenderer){let t=this.injector.get(this.captchaConfig.captchaRenderer),s=t.getCaptchaConfig().subscribe(i=>i.enabled);if(t?.getToken()&&s)return e.append(H,t.getToken())}return e}static{this.\u0275fac=function(t){return new(t||r)(o(L),o(q),o(z))}}static{this.\u0275prov=u({token:r,factory:r.\u0275fac})}}return r})(),ue=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=f({type:r})}static{this.\u0275inj=l({providers:[x(me),{provide:C,useClass:ge}]})}}return r})();var Ze=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=f({type:r})}static{this.\u0275inj=l({imports:[de,ue,te,$]})}}return r})();export{Ze as UserProfileModule};
