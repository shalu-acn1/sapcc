import './polyfills.server.mjs';
import{a as Y}from"./chunk-ZOJN3DPF.mjs";import{c as w}from"./chunk-HCL456IH.mjs";import{M as j}from"./chunk-M3PBDWUL.mjs";import{$e as D,B as T,Jc as P,La as C,M as I,Zf as L,a as v,ag as U,d as O,fb as m,fg as k,ig as g,kd as y,ma as a,me as u,na as E,ob as R,pa as l,q as A,qa as c,qe as _,wf as F,ya as S,yh as N,z as M}from"./chunk-JI3YDV22.mjs";import{a as d,b as h}from"./chunk-H4UZCO6D.mjs";var ae="sap-commerce-cloud-public-key",ce="sap-commerce-cloud-access-code",B={opf:{opfBaseUrl:"",paymentOption:{enableInfoMessage:!0}}},de=(()=>{class e extends u{static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=S(e)))(r||e)}})()}static{this.\u0275prov=a({token:e,factory:function(i){let r=null;return i?r=new(i||e):r=l(u),r},providedIn:"root"})}}return e})(),fe=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:function(i){let r=null;return i?r=new(i||e):r=l(u),r},providedIn:"root"})}}return e})(),G=(()=>{class e extends g{constructor(){super(...arguments),this.isGlobalMessageDisabled=!1,this.disabledKeys=[],this.defaultTimeout=2e3}add(t,i,r){this.isGlobalMessageDisabled&&this.disabledKeys?.length&&t?.key&&this.disabledKeys.includes(t.key)||super.add(t,i,r)}disableGlobalMessage(t,i){this.isGlobalMessageDisabled=!0,this.disabledKeys=t,M(i??this.defaultTimeout).pipe(I(1)).subscribe(()=>{this.isGlobalMessageDisabled=!1,this.disabledKeys=[]})}static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=S(e)))(r||e)}})()}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),K=(()=>{class e{constructor(){this.INITIAL_STATE=Object.freeze({termsAndConditionsChecked:!1,selectedPaymentOptionId:void 0,isPaymentInProgress:!1,opfPaymentSessionId:void 0,isTermsAndConditionsAlertClosed:!1}),this.opfMetadataState=new O(this.INITIAL_STATE)}getOpfMetadataState(){return this.opfMetadataState.asObservable()}updateOpfMetadata(t){this.opfMetadataState.next(d(d({},this.opfMetadataState.value),t))}clearOpfMetadata(){this.opfMetadataState.next(this.INITIAL_STATE)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),x=(()=>{class e{constructor(){this.statePersistenceService=c(U),this.opfMetadataStoreService=c(K),this.subscription=new v,this.key="opf"}initSync(){this.subscription.add(this.statePersistenceService.syncWithStorage({key:this.key,state$:this.getOpfState(),onRead:t=>this.onRead(t)}))}getActiveLanguage(){return this.statePersistenceService.readStateFromStorage({key:D})}getOpfState(){return this.opfMetadataStoreService.getOpfMetadataState().pipe(A(t=>({metadata:t})))}onRead(t){t&&t.metadata&&this.opfMetadataStoreService.updateOpfMetadata(t.metadata)}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();j.OPF_ERROR="OPF_ERROR";var H=function(e){return e.CHECKOUT_REVIEW_PAGE="opfCheckoutPaymentAndReview",e.CONFIRMATION_PAGE="orderConfirmation",e.RESULT_PAGE="paymentVerificationResult",e.CART_PAGE="cart",e}(H||{}),f=function(e){return e.SCRIPT="SCRIPT",e.STYLES="STYLES",e}(f||{}),V=function(e){return e.PAYMENT_GATEWAY="PAYMENT_GATEWAY",e.PAYMENT_METHOD="PAYMENT_METHOD",e}(V||{}),le={messageKey:"opfPayment.errors.proceedPayment",confirmKey:"common.continue"},ue=(()=>{class e{constructor(){this.scriptLoader=c(L),this.document=c(P),this.platformId=c(C),this.CORS_DEFAULT_VALUE="anonymous",this.OPF_RESOURCE_LOAD_ONCE_ATTRIBUTE_KEY="opf-load-once",this.OPF_RESOURCE_ATTRIBUTE_KEY="data-opf-resource"}embedStyles(t){let{attributes:i,src:r,sri:n,callback:s,errorCallback:b}=t,o=this.document.createElement("link");o.href=r,o.rel="stylesheet",o.type="text/css",n&&(o.integrity=n,o.crossOrigin=i?.crossorigin??this.CORS_DEFAULT_VALUE,delete i?.crossorigin),i&&Object.keys(i)?.forEach(p=>{p in o||o.setAttribute(p,i[p])}),s&&o.addEventListener("load",s),b&&o.addEventListener("error",b),this.document.head.appendChild(o)}hasStyles(t){return!!this.document.querySelector(`link[href="${t}"]`)}hasScript(t){return this.scriptLoader.hasScript(t)}createAttributesList(t){let i={};return t?.forEach(r=>{i[r.key]=r.value}),(!i?.[this.OPF_RESOURCE_LOAD_ONCE_ATTRIBUTE_KEY]||i[this.OPF_RESOURCE_LOAD_ONCE_ATTRIBUTE_KEY]!=="true")&&(i[this.OPF_RESOURCE_ATTRIBUTE_KEY]="true"),delete i?.[this.OPF_RESOURCE_LOAD_ONCE_ATTRIBUTE_KEY],i}loadScript(t){return new Promise((i,r)=>{let n=d({type:"text/javascript"},this.createAttributesList(t.attributes));t?.sri&&(n.integrity=t.sri,n.crossOrigin=n?.crossorigin??this.CORS_DEFAULT_VALUE,delete n?.crossorigin),t?.url&&!this.hasScript(t.url)?this.scriptLoader.embedScript({attributes:n,src:t.url,callback:()=>i(),errorCallback:()=>r(),disableKeyRestriction:!0}):i()})}loadStyles(t){return new Promise((i,r)=>{t.url&&!this.hasStyles(t.url)?this.embedStyles({attributes:this.createAttributesList(t?.attributes),src:t.url,sri:t?.sri,callback:()=>i(),errorCallback:()=>r()}):i()})}executeScriptFromHtml(t){if(!y(this.platformId)&&t){let r=new DOMParser().parseFromString(t,"text/html").getElementsByTagName("script");if(!r?.[0]?.innerText)return;Function(r[0].innerText)()}}clearAllResources(){this.document.querySelectorAll(`[${this.OPF_RESOURCE_ATTRIBUTE_KEY}]`).forEach(t=>{t&&t.remove()})}loadResources(t=[],i=[]){if(y(this.platformId))return Promise.resolve();let r=[...t.map(s=>h(d({},s),{type:f.SCRIPT})),...i.map(s=>h(d({},s),{type:f.STYLES}))];if(!r.length)return Promise.resolve();let n=r.map(s=>{if(!s.url)return Promise.resolve();switch(s.type){case f.SCRIPT:return this.loadScript(s);case f.STYLES:return this.loadStyles(s);default:return Promise.resolve()}});return Promise.all(n).then(()=>{})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),W=(()=>{class e{constructor(){this.eventService=c(F),this.opfMetadataStoreService=c(K),this.subscriptions=new v,this.onOpfPaymentMetadataResetConditionsMet()}onOpfPaymentMetadataResetConditionsMet(){this.subscriptions.add(T(this.eventService.get(k),this.eventService.get(Y),this.eventService.get(w)).subscribe(()=>this.opfMetadataStoreService.clearOpfMetadata()))}ngOnDestroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),$="opfBase",pe=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:()=>N({facade:e,feature:$,methods:["getActiveConfigurationsState"]}),providedIn:"root"})}}return e})(),q=(()=>{class e{constructor(t){}static{this.\u0275fac=function(i){return new(i||e)(l(W))}}static{this.\u0275mod=m({type:e})}static{this.\u0275inj=E({})}}return e})();function z(){let e=c(x);return()=>e.initSync()}var he=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=m({type:e})}static{this.\u0275inj=E({providers:[{provide:R,useFactory:z,multi:!0},{provide:g,useExisting:G},_(B)],imports:[q]})}}return e})();export{ae as a,ce as b,de as c,fe as d,G as e,K as f,x as g,H as h,V as i,le as j,ue as k,$ as l,pe as m,he as n};
