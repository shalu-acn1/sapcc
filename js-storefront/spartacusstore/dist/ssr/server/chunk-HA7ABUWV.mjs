import './polyfills.server.mjs';
import{b as ie,e as re}from"./chunk-3MVLZVKE.mjs";import{a as U}from"./chunk-ZOJN3DPF.mjs";import{C as te,H as se,n as J,o as C,p as Z,q as $,z as ee}from"./chunk-HCL456IH.mjs";import{B as h,Ce as I,D as x,Lh as W,M as G,Mh as q,Nh as z,Oh as L,Pg as k,Ph as Q,Qg as b,We as K,_d as B,a as d,da as m,eg as F,fb as A,fg as O,ga as V,hg as j,ig as w,ma as n,me as H,na as R,pa as i,q as N,qe as P,qg as T,re as X,vf as g,wf as a,xd as Y,yh as l,zd as _}from"./chunk-JI3YDV22.mjs";var f=function(e){return e.DELIVERY_ADDRESS="deliveryAddress",e.DELIVERY_MODE="deliveryMode",e.PAYMENT_DETAILS="paymentDetails",e.REVIEW_ORDER="reviewOrder",e}(f||{}),ce=function(e){return e.COMPLETED="completed",e.SELECTED="selected",e.DISABLED="disabled",e}(ce||{}),oe=function(e){return e.FREE="FREE",e.LEAST_EXPENSIVE="LEAST_EXPENSIVE",e.MOST_EXPENSIVE="MOST_EXPENSIVE",e}(oe||{}),He=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=n({token:e,factory:function(s){let r=null;return s?r=new(s||e):r=i(H),r},providedIn:"root"})}}return e})(),de={checkout:{steps:[{id:"deliveryAddress",name:"checkoutProgress.deliveryAddress",routeName:"checkoutDeliveryAddress",type:[f.DELIVERY_ADDRESS]},{id:"deliveryMode",name:"checkoutProgress.deliveryMode",routeName:"checkoutDeliveryMode",type:[f.DELIVERY_MODE]},{id:"paymentDetails",name:"checkoutProgress.paymentDetails",routeName:"checkoutPaymentDetails",type:[f.PAYMENT_DETAILS]},{id:"reviewOrder",name:"checkoutProgress.reviewOrder",routeName:"checkoutReviewOrder",type:[f.REVIEW_ORDER]}],express:!1,defaultDeliveryMode:[oe.FREE],guest:!1}},ae={routing:{routes:{checkoutLogin:{paths:["checkout-login"],authFlow:!0},checkout:{paths:["checkout"]},checkoutDeliveryAddress:{paths:["checkout/delivery-address"]},checkoutDeliveryMode:{paths:["checkout/delivery-mode"]},checkoutPaymentDetails:{paths:["checkout/payment-details"]},checkoutReviewOrder:{paths:["checkout/review-order"]}}}},ve=(()=>{class e extends g{static{this.type="CheckoutQueryReloadEvent"}}return e})(),c=(()=>{class e extends g{static{this.type="CheckoutQueryResetEvent"}}return e})(),S=class extends g{},D=class extends S{},ue=(()=>{class e extends D{static{this.type="CheckoutDeliveryAddressCreatedEvent"}}return e})(),he=(()=>{class e extends D{static{this.type="CheckoutDeliveryAddressSetEvent"}}return e})(),le=(()=>{class e extends D{static{this.type="CheckoutDeliveryAddressClearedEvent"}}return e})(),v=class extends S{},ye=(()=>{class e extends v{static{this.type="CheckoutDeliveryModeSetEvent"}}return e})(),pe=(()=>{class e extends v{static{this.type="CheckoutDeliveryModeClearedEvent"}}return e})(),Ce=(()=>{class e extends v{static{this.type="CheckoutDeliveryModeClearedErrorEvent"}}return e})(),fe=(()=>{class e extends v{static{this.type="CheckoutSupportedDeliveryModesQueryReloadEvent"}}return e})(),E=(()=>{class e extends v{static{this.type="CheckoutSupportedDeliveryModesQueryResetEvent"}}return e})(),y=class extends S{},Ee=(()=>{class e extends y{static{this.type="CheckoutPaymentDetailsCreatedEvent"}}return e})(),Se=(()=>{class e extends y{static{this.type="CheckoutPaymentDetailsSetEvent"}}return e})(),De=(()=>{class e extends y{static{this.type="CheckoutPaymentCardTypesQueryReloadEvent"}}return e})(),Xe=(()=>{class e extends y{static{this.type="CheckoutPaymentCardTypesQueryResetEvent"}}return e})(),ge=(()=>{class e{constructor(t){this.eventService=t,this.subscriptions=new d,this.onCheckoutQueryReload(),this.onCheckoutQueryReset()}onCheckoutQueryReload(){this.subscriptions.add(h(this.eventService.get(k),this.eventService.get(b)).subscribe(()=>{this.eventService.dispatch({},ve)}))}onCheckoutQueryReset(){this.subscriptions.add(h(this.eventService.get(F),this.eventService.get(O),this.eventService.get(ie),this.eventService.get(re),this.eventService.get(J),this.eventService.get(U)).subscribe(()=>{this.eventService.dispatch({},c)}))}ngOnDestroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)(i(a))}}static{this.\u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),ne="checkout",p="checkoutCore",ke=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=n({token:e,factory:()=>l({facade:e,feature:p,methods:["getDeliveryAddressState","createAndSetAddress","setDeliveryAddress","clearCheckoutDeliveryAddress"],async:!0}),providedIn:"root"})}}return e})(),be=(()=>{class e{constructor(t,s,r,u){this.checkoutDeliveryAddressFacade=t,this.eventService=s,this.globalMessageService=r,this.activeCartFacade=u,this.subscriptions=new d,this.onDeliveryAddressCreated(),this.onDeliveryAddressSet(),this.onDeliveryAddressCleared(),this.onUserAddressChange(),this.onCartDeleted()}onUserAddressChange(){this.subscriptions.add(this.eventService.get(W).pipe(x(t=>t instanceof q||t instanceof z),m(({userId:t})=>this.activeCartFacade.takeActiveCartId().pipe(N(s=>({cartId:s,userId:t}))))).subscribe(({cartId:t,userId:s})=>{this.checkoutDeliveryAddressFacade.clearCheckoutDeliveryAddress(),this.eventService.dispatch({cartId:t,userId:s},E)}))}onDeliveryAddressCreated(){this.subscriptions.add(this.eventService.get(ue).subscribe(({cartId:t,userId:s})=>{s!==I&&this.eventService.dispatch({userId:s},L),this.globalMessageService.add({key:"addressForm.userAddressAddSuccess"},j.MSG_TYPE_CONFIRMATION),this.eventService.dispatch({userId:s,cartId:t},E),this.eventService.dispatch({},c)}))}onDeliveryAddressSet(){this.subscriptions.add(this.eventService.get(he).subscribe(({userId:t,cartId:s})=>{this.eventService.dispatch({userId:t,cartId:s},E),this.eventService.dispatch({},c)}))}onDeliveryAddressCleared(){this.subscriptions.add(this.eventService.get(le).subscribe(()=>this.eventService.dispatch({},c)))}onCartDeleted(){this.subscriptions.add(this.eventService.get($).subscribe(()=>this.eventService.dispatch({},c)))}ngOnDestroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)(i(ke),i(a),i(w),i(se))}}static{this.\u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Me=(()=>{class e{constructor(t){this.eventService=t,this.subscriptions=new d,this.onDeliveryModeSet(),this.onDeliveryModeCleared(),this.onDeliveryModeClearedError(),this.onDeliveryModeReset(),this.onGetSupportedDeliveryModesQueryReload(),this.onGetSupportedDeliveryModesQueryReset()}onDeliveryModeSet(){this.subscriptions.add(this.eventService.get(ye).subscribe(({userId:t,cartId:s,cartCode:r})=>{this.eventService.dispatch({},c),this.eventService.dispatch({userId:t,cartId:s,cartCode:r},C)}))}onDeliveryModeCleared(){this.subscriptions.add(this.eventService.get(pe).subscribe(({userId:t,cartId:s,cartCode:r})=>{this.eventService.dispatch({},c),this.eventService.dispatch({userId:t,cartId:s,cartCode:r},C)}))}onDeliveryModeClearedError(){this.subscriptions.add(this.eventService.get(Ce).subscribe(({userId:t,cartId:s,cartCode:r})=>{this.eventService.dispatch({},c),this.eventService.dispatch({userId:t,cartId:s,cartCode:r},C)}))}onDeliveryModeReset(){this.subscriptions.add(this.eventService.get(E).subscribe(({userId:t,cartId:s})=>this.eventService.dispatch({userId:t,cartId:s,cartCode:s},C)))}onGetSupportedDeliveryModesQueryReload(){this.subscriptions.add(h(this.eventService.get(k),this.eventService.get(b)).subscribe(()=>{this.eventService.dispatch({},fe)}))}onGetSupportedDeliveryModesQueryReset(){this.subscriptions.add(h(this.eventService.get(F),this.eventService.get(O)).subscribe(()=>{this.eventService.dispatch({},E)}))}ngOnDestroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)(i(a))}}static{this.\u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),me=(()=>{class e{constructor(t,s){this.eventService=t,this.globalMessageService=s,this.subscriptions=new d,this.onPaymentCreated(),this.onPaymentSet(),this.onGetCardTypesQueryReload()}onPaymentCreated(){this.subscriptions.add(this.eventService.get(Ee).subscribe(({userId:t})=>{t!==I&&this.eventService.dispatch({userId:t},Q),this.globalMessageService.add({key:"paymentForm.paymentAddedSuccessfully"},j.MSG_TYPE_CONFIRMATION),this.eventService.dispatch({},c)}))}onPaymentSet(){this.subscriptions.add(this.eventService.get(Se).subscribe(()=>{this.eventService.dispatch({},c)}))}onGetCardTypesQueryReload(){this.subscriptions.add(h(this.eventService.get(k),this.eventService.get(b)).subscribe(()=>{this.eventService.dispatch({},De)}))}ngOnDestroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)(i(a),i(w))}}static{this.\u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Re=(()=>{class e{constructor(t){this.eventService=t,this.subscriptions=new d,this.onOrderPlaced()}onOrderPlaced(){this.subscriptions.add(this.eventService.get(U).subscribe(({userId:t,cartId:s,cartCode:r})=>{this.eventService.dispatch({userId:t,cartId:s,cartCode:r},Z),this.eventService.dispatch({},c)}))}ngOnDestroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)(i(a))}}static{this.\u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Ae=(()=>{class e{constructor(t,s){this.eventService=t,this.store=s,this.subscriptions=new d,this.onUserAddressAction(),this.onUserPaymentAction()}onUserAddressAction(){this.subscriptions.add(this.eventService.get(L).subscribe(({userId:t})=>{this.store.dispatch(new T.LoadUserAddresses(t))}))}onUserPaymentAction(){this.subscriptions.add(this.eventService.get(Q).subscribe(({userId:t})=>{this.store.dispatch(new T.LoadUserPaymentMethods(t))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)(i(a),i(B))}}static{this.\u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Pe=(()=>{class e{constructor(t,s,r,u,M,we){}static{this.\u0275fac=function(s){return new(s||e)(i(ge),i(be),i(Me),i(me),i(Re),i(Ae))}}static{this.\u0275mod=A({type:e})}static{this.\u0275inj=R({})}}return e})(),Ie=(()=>{class e{constructor(t,s){this.routingService=t,this.multiCartFacade=s}intercept(t,s){return this.routingService.getRouterState().pipe(G(1),m(r=>s.handle(t).pipe(V({error:u=>{if(u instanceof Y&&this.isUserInCheckoutRoute(r.state?.semanticRoute)&&this.isCartNotFoundError(u)){this.routingService.go({cxRoute:"cart"});let M=this.getCartIdFromError(u);M&&this.multiCartFacade.reloadCart(M)}}}))))}isUserInCheckoutRoute(t){return t?.toLowerCase().startsWith("checkout")??!1}isCartNotFoundError(t){return t.status===400&&t.error?.errors?.[0]?.type==="CartError"&&t.error?.errors?.[0]?.reason==="notFound"}getCartIdFromError(t){return t.error?.errors?.[0]?.subject}static{this.\u0275fac=function(s){return new(s||e)(i(K),i(te))}}static{this.\u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Fe=[{provide:_,useExisting:Ie,multi:!0}],Oe=["CheckoutOrchestrator","CheckoutOrderSummary","CheckoutProgress","CheckoutProgressMobileBottom","CheckoutProgressMobileTop","CheckoutDeliveryMode","CheckoutPaymentDetails","CheckoutPlaceOrder","CheckoutReviewOrder","CheckoutReviewPayment","CheckoutReviewShipping","CheckoutReviewOverview","CheckoutDeliveryAddress","GuestCheckoutLoginComponent"];function je(){return{featureModules:{[ne]:{cmsComponents:Oe,dependencies:[ee]},[p]:ne}}}var Ke=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=A({type:e})}static{this.\u0275inj=R({providers:[...Fe,P(ae),P(de),X(je)],imports:[Pe]})}}return e})(),We=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=n({token:e,factory:()=>l({facade:e,feature:p,methods:["setBillingAddress"],async:!0}),providedIn:"root"})}}return e})(),qe=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=n({token:e,factory:()=>l({facade:e,feature:p,methods:["getSupportedDeliveryModesState","getSupportedDeliveryModes","setDeliveryMode","getSelectedDeliveryModeState","clearCheckoutDeliveryMode"],async:!0}),providedIn:"root"})}}return e})(),ze=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=n({token:e,factory:()=>l({facade:e,feature:p,methods:["getPaymentCardTypesState","getPaymentCardTypes","getPaymentDetailsState","createPaymentDetails","setPaymentDetails"],async:!0}),providedIn:"root"})}}return e})(),Je=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=n({token:e,factory:()=>l({facade:e,feature:p,methods:["getCheckoutDetailsState"]}),providedIn:"root"})}}return e})();export{f as a,ce as b,oe as c,He as d,ve as e,c as f,ue as g,he as h,le as i,ye as j,pe as k,Ce as l,fe as m,E as n,Ee as o,Se as p,De as q,Xe as r,ne as s,p as t,ke as u,Oe as v,Ke as w,We as x,qe as y,ze as z,Je as A};
