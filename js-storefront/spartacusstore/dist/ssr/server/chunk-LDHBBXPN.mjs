import './polyfills.server.mjs';
import{a as L,b as T,c as _,e as D,f as w,g as F,h as j,i as H}from"./chunk-FLUBTONN.mjs";import{c as U}from"./chunk-R4QGEANI.mjs";import"./chunk-IQ5X27PC.mjs";import"./chunk-ROMJESGS.mjs";import{a as u,b as C,d as R,g as N}from"./chunk-B74IYF2B.mjs";import"./chunk-ZOJN3DPF.mjs";import{V as I}from"./chunk-HCL456IH.mjs";import"./chunk-M3PBDWUL.mjs";import{$f as p,Bf as S,Gf as A,Hf as g,I as s,Re as O,Wf as c,fb as d,hd as P,ma as y,na as m,of as b,qa as r,qe as E,sd as a,yd as v}from"./chunk-JI3YDV22.mjs";import{a as l,b as M}from"./chunk-H4UZCO6D.mjs";var Y=(()=>{class e{constructor(){this.http=r(v),this.converter=r(S),this.opfEndpointsService=r(U),this.config=r(R),this.opfMetadataStatePersistanceService=r(N),this.logger=r(O),this.headerWithNoLanguage={accept:"application/json","Content-Type":"application/json"},this.header=M(l({},this.headerWithNoLanguage),{"Accept-Language":this.opfMetadataStatePersistanceService.getActiveLanguage()}),this.headerWithContentLanguage=M(l({},this.headerWithNoLanguage),{"Content-Language":this.opfMetadataStatePersistanceService.getActiveLanguage()})}verifyPayment(t,i){let o=new a(this.headerWithNoLanguage).set(u,this.config.opf?.commerceCloudPublicKey||"");return this.http.post(this.verifyPaymentEndpoint(t),JSON.stringify(i),{headers:o}).pipe(s(n=>{throw p(n,this.logger)}),c({shouldRetry:g,maxTries:2}),this.converter.pipeable(w))}submitPayment(t,i,o){let n=new a(this.header).set(u,this.config.opf?.commerceCloudPublicKey||"").set(C,i||""),f=this.getSubmitPaymentEndpoint(o);return this.http.post(f,t,{headers:n}).pipe(s(h=>{throw p(h,this.logger)}),c({shouldRetry:g,maxTries:2}),this.converter.pipeable(F))}submitCompletePayment(t,i,o){let n=new a(this.headerWithContentLanguage).set(u,this.config.opf?.commerceCloudPublicKey||"").set(C,i||""),f=this.getSubmitCompletePaymentEndpoint(o);return this.http.post(f,t,{headers:n}).pipe(s(h=>{throw p(h,this.logger)}),c({shouldRetry:g,maxTries:2}),this.converter.pipeable(j))}getAfterRedirectScripts(t){let i=new a(this.header).set(u,this.config.opf?.commerceCloudPublicKey||""),o=this.getAfterRedirectScriptsEndpoint(t);return this.http.get(o,{headers:i}).pipe(s(n=>{throw p(n,this.logger)}),c({shouldRetry:g,maxTries:2}),this.converter.pipeable(H))}initiatePayment(t){let i=new a({"Accept-Language":this.opfMetadataStatePersistanceService.getActiveLanguage()}).set(u,this.config.opf?.commerceCloudPublicKey||"").set(C,t?.otpKey||""),o=this.getInitiatePaymentEndpoint();return t=this.converter.convert(t,L),this.http.post(o,t?.config,{headers:i}).pipe(s(n=>{throw p(n,this.logger)}))}verifyPaymentEndpoint(t){return this.opfEndpointsService.buildUrl("verifyPayment",{urlParams:{paymentSessionId:t}})}getSubmitPaymentEndpoint(t){return this.opfEndpointsService.buildUrl("submitPayment",{urlParams:{paymentSessionId:t}}).replace("//submit","/submit")}getSubmitCompletePaymentEndpoint(t){return this.opfEndpointsService.buildUrl("submitCompletePayment",{urlParams:{paymentSessionId:t}})}getAfterRedirectScriptsEndpoint(t){return this.opfEndpointsService.buildUrl("getAfterRedirectScripts",{urlParams:{paymentSessionId:t}})}getInitiatePaymentEndpoint(){return this.opfEndpointsService.buildUrl("initiatePayment")}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=y({token:e,factory:e.\u0275fac})}}return e})(),Z={backend:{opfApi:{endpoints:{verifyPayment:"payments/${paymentSessionId}/verify",submitPayment:"payments/${paymentSessionId}/submit",submitCompletePayment:"payments/${paymentSessionId}/submit-complete",getAfterRedirectScripts:"payments/${paymentSessionId}/after-redirect-scripts",initiatePayment:"payments"}}}},K=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=d({type:e})}static{this.\u0275inj=m({providers:[E(Z),{provide:T,useClass:Y}],imports:[P]})}}return e})();var $=(()=>{class e{constructor(){this.logger=r(O),this.occEndpoints=r(b),this.http=r(v),this.converter=r(S)}setCartPaymentOption(t,i,o,n){let f={"Content-Type":"application/json"},h=new a(l({},f));return this.http.put(this.getSetCartPaymentOptionEndpoint(t,i),JSON.stringify({sapPaymentOptionId:o,purchaseOrderNumber:n}),{headers:h}).pipe(s(W=>{throw p(W,this.logger)}),c({shouldRetry:A}),this.converter.pipeable(I))}getSetCartPaymentOptionEndpoint(t,i){return this.occEndpoints.buildUrl("setCartPaymentOption",{urlParams:{userId:t,cartId:i},queryParams:{fields:"DEFAULT"}})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=y({token:e,factory:e.\u0275fac})}}return e})(),J={backend:{occ:{endpoints:{setCartPaymentOption:"users/${userId}/carts/${cartId}/paymentOption"}}}},k=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=d({type:e})}static{this.\u0275inj=m({providers:[E(J),{provide:_,useClass:$}],imports:[P]})}}return e})();var vt=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=d({type:e})}static{this.\u0275inj=m({imports:[D,K,k]})}}return e})();export{vt as OpfPaymentModule};
