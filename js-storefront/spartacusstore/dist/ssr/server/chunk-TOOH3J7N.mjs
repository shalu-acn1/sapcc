import './polyfills.server.mjs';
import{H as St,O as bt,m as xt}from"./chunk-HCL456IH.mjs";import{C as ut,Qa as gt,Ra as Tt,U as lt,Ub as vt,W as mt,X as Ct,Z as ft,_ as ht,e as rt,fa as _t,g as st,j as pt,l as ct,oa as yt,p as dt}from"./chunk-M3PBDWUL.mjs";import{$b as U,D,Db as r,Eb as C,Fb as b,Fg as A,Gb as B,Hb as q,Jb as k,Jh as at,Lb as v,M as _,Mb as s,Sb as N,Tb as L,Ub as M,Vc as H,Wa as F,Wb as h,Xa as o,Xb as x,Yb as I,Yc as K,Za as S,Ze as z,_b as V,a as O,ac as j,bd as Y,cb as f,eb as P,fb as R,hd as $,jb as m,kc as p,lc as c,na as E,nh as nt,oh as ot,q as w,qa as y,qe as W,sb as Q,tb as a,tg as X,ug as Z,vg as tt,wa as g,wf as J,xa as T,xc as G,yg as et,zg as it}from"./chunk-JI3YDV22.mjs";var At=["addToCartDialogTriggerEl"];function Ot(i,l){i&1&&(r(0,"label"),h(1),p(2,"cxTranslate"),C()),i&2&&(o(),x(c(2,1,"addToCart.quantityFull")))}function wt(i,l){i&1&&(r(0,"label"),h(1),p(2,"cxTranslate"),C()),i&2&&(o(),x(c(2,1,"addToCart.quantity")))}function Dt(i,l){if(i&1&&b(0,"cx-item-counter",11),i&2){let t=s(3);a("max",t.maxQuantity)("control",t.addToCartForm.get("quantity"))("ariaDescribedById","add-to-card-stock-info")}}function Et(i,l){if(i&1&&(r(0,"span"),h(1),C()),i&2){let t=s(3);o(),x(t.getInventory())}}function Ft(i,l){if(i&1&&(r(0,"div",6),m(1,Ot,3,3,"label",7)(2,wt,3,3,"label",7),r(3,"div",8),m(4,Dt,1,3,"cx-item-counter",9),r(5,"span",10),m(6,Et,2,1,"span",4),p(7,"async"),h(8),p(9,"cxTranslate"),p(10,"cxTranslate"),C()()()),i&2){let t=s(2);o(),a("cxFeature","a11yQTY2Quantity"),o(),a("cxFeature","!a11yQTY2Quantity"),o(2),a("ngIf",t.hasStock),o(2),a("ngIf",c(7,5,t.showInventory$)),o(2),I(" ",t.hasStock?c(9,7,"addToCart.inStock"):c(10,9,"addToCart.outOfStock"),"")}}function Pt(i,l){}function Rt(i,l){if(i&1){let t=k();B(0),m(1,Pt,0,0,"ng-template",12),j("cxComponentRefChange",function(n){g(t);let d=s(2);return U(d.pickupOptionCompRef,n)||(d.pickupOptionCompRef=n),T(n)}),v("cxComponentRefChange",function(){g(t);let n=s(2);return T(n.onPickupOptionsCompLoaded())}),q()}if(i&2){let t=s(2);o(),a("cxOutlet",t.CartOutlets.ADD_TO_CART_PICKUP_OPTION),V("cxComponentRef",t.pickupOptionCompRef)}}function Qt(i,l){if(i&1&&(r(0,"span",16),b(1,"cx-icon",17),C()),i&2){let t=s(3);o(),a("type",t.iconTypes.REPEAT)}}function Bt(i,l){if(i&1&&(r(0,"button",13,0),p(2,"cxTranslate"),p(3,"cxTranslate"),m(4,Qt,2,1,"span",14),p(5,"cxTranslate"),r(6,"span",15),p(7,"cxTranslate"),h(8),p(9,"cxTranslate"),C()()),i&2){let t,e=s(2);a("ngClass",e.options!=null&&e.options.displayAddToCart?"btn btn-tertiary":"btn btn-primary btn-block")("disabled",e.disabled||e.quantity<=0||e.quantity>e.maxQuantity),Q("aria-label",e.product!=null&&e.product.name?c(2,6,"addToCart.addToCart")+", "+(e.product==null?null:e.product.name):c(3,8,"addToCart.addToCart")),o(4),a("ngIf",(e.options==null?null:e.options.addToCartString)===c(5,10,"addToCart.buyItAgain")),o(2),a("ngClass",(e.options==null?null:e.options.addToCartString)===c(7,12,"addToCart.buyItAgain")?"buyItAgainLink":""),o(2),I(" ",(t=e.options==null?null:e.options.addToCartString)!==null&&t!==void 0?t:c(9,14,"addToCart.addToCart")," ")}}function qt(i,l){if(i&1){let t=k();r(0,"form",2),v("submit",function(){g(t);let n=s();return T(n.addToCart())}),m(1,Ft,11,11,"div",3)(2,Rt,2,2,"ng-container",4)(3,Bt,10,16,"button",5),C()}if(i&2){let t=s();a("formGroup",t.addToCartForm),o(),a("ngIf",t.showQuantity),o(),a("ngIf",t.hasStock),o(),a("ngIf",t.hasStock)}}var Nt=(()=>{class i{handleKeyboardEvent(t){let e=t.target,n=e.ariaLabel==="Quantity"&&e.tagName==="INPUT";t.key==="Enter"&&n&&t.preventDefault()}constructor(t,e,n,d,u,kt){this.currentProductService=t,this.cd=e,this.activeCartService=n,this.component=d,this.eventService=u,this.productListItemContext=kt,this.showQuantity=!0,this.disabled=!1,this.hasStock=!1,this.inventoryThreshold=!1,this.showInventory$=this.component?.data$.pipe(w(It=>It.inventoryDisplay)),this.quantity=1,this.subscription=new O,this.addToCartForm=new st({quantity:new pt(1,{updateOn:"blur"})}),this.CartOutlets=bt,this.iconTypes=Ct,this.featureConfigService=y(X),this.featureToggles=y(tt),this.productAvailabilityService=y(at),it("a11yQTY2Quantity")}ngOnInit(){if(this.product)this.productCode=this.product.code??"",this.setStockInfo(this.product);else if(this.productCode)this.quantity=1,this.hasStock=!0,this.cd.markForCheck();else{let t;this.productListItemContext?t=this.productListItemContext.product$:this.featureToggles.showRealTimeStockInPDP?t=this.currentProductService.getProduct([A.UNIT,A.DETAILS]):t=this.currentProductService.getProduct(),this.subscription.add(t.pipe(D(z)).subscribe(e=>{this.productCode=e.code??"",this.product=e,this.setStockInfo(e)}))}}setStockInfo(t){this.quantity=1,this.addToCartForm.controls.quantity.setValue(1),this.inventoryThreshold=t.stock?.isValueRounded??!1,this.productListItemContext&&(this.showQuantity=!1),this.featureToggles.showRealTimeStockInPDP&&t.sapUnit?.sapCode?this.productAvailabilityService.getRealTimeStock(this.productCode,t.sapUnit?.sapCode).pipe(_(1)).subscribe(({quantity:e,status:n})=>{this.maxQuantity=Number(e),this.hasStock=!!(n&&n!=="OUT_OF_STOCK"),this.cd.markForCheck()}):(this.hasStock=t.stock?.stockLevelStatus!=="outOfStock",this.hasStock&&t.stock?.stockLevel&&(this.maxQuantity=t.stock.stockLevel),this.cd.markForCheck())}getInventory(){if(this.hasStock){let t=this.maxQuantity?this.maxQuantity.toString():"";return this.inventoryThreshold?t+"+":t}else return""}updateCount(t){this.quantity=t}addToCart(){let t=0;this.savedCart?t=this.getQuantityFromSavedCart(this.productCode):t=this.addToCartForm.get("quantity")?.value,!(!this.productCode||t<=0)&&(this.pickupOptionCompRef instanceof S&&this.pickupOptionCompRef.instance.intendedPickupLocation$.pipe(_(1)).subscribe(e=>{this.pickupStore=e?.pickupOption==="pickup"?e.name:void 0}),this.activeCartService.getEntries().pipe(_(1)).subscribe(e=>{this.activeCartService.addEntry(this.productCode,t,this.pickupStore),this.eventService.dispatch(this.createCartUiEventAddToCart(this.productCode,t,e.length,this.pickupStore))}))}createCartUiEventAddToCart(t,e,n,d){let u=new xt;return u.productCode=t,u.quantity=e,u.numberOfEntriesBeforeAdd=n,u.pickupStoreName=d,this.featureConfigService.isEnabled("a11yDialogTriggerRefocus")&&(u.triggerElementRef=this.addToCartDialogTriggerEl),u}onPickupOptionsCompLoaded(){this.featureConfigService.isEnabled("a11yPickupOptionsTabs")&&this.pickupOptionCompRef instanceof S&&this.subscription.add(this.pickupOptionCompRef.instance.intendedPickupChange.subscribe(t=>{this.disabled=t?.pickupOption==="pickup"&&!t.displayName}))}getQuantityFromSavedCart(t){return this.savedCart?.entries?.find(e=>e?.product?.code===t)?.quantity??0}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(e){return new(e||i)(f(yt),f(G),f(St),f(_t),f(J),f(vt,8))}}static{this.\u0275cmp=P({type:i,selectors:[["cx-add-to-cart"]],viewQuery:function(e,n){if(e&1&&N(At,5),e&2){let d;L(d=M())&&(n.addToCartDialogTriggerEl=d.first)}},hostBindings:function(e,n){e&1&&v("keydown",function(u){return n.handleKeyboardEvent(u)},!1,F)},inputs:{productCode:"productCode",showQuantity:"showQuantity",options:"options",pickupStore:"pickupStore",savedCart:"savedCart",product:"product"},standalone:!1,decls:1,vars:1,consts:[["addToCartDialogTriggerEl",""],[3,"formGroup","submit",4,"ngIf"],[3,"submit","formGroup"],["class","quantity",4,"ngIf"],[4,"ngIf"],["type","submit",3,"ngClass","disabled",4,"ngIf"],[1,"quantity"],[4,"cxFeature"],[1,"cx-counter-stock"],[3,"max","control","ariaDescribedById",4,"ngIf"],["id","add-to-card-stock-info",1,"info"],[3,"max","control","ariaDescribedById"],[3,"cxComponentRefChange","cxOutlet","cxComponentRef"],["type","submit",3,"ngClass","disabled"],["class","repeat-icon",4,"ngIf"],[3,"ngClass"],[1,"repeat-icon"],[3,"type"]],template:function(e,n){e&1&&m(0,qt,4,4,"form",1),e&2&&a("ngIf",n.productCode)},dependencies:[H,K,ct,rt,dt,ft,gt,lt,Z,Y,nt],encapsulation:2,changeDetection:0})}}return i})(),re=(()=>{class i{static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275mod=R({type:i})}static{this.\u0275inj=E({providers:[W({cmsComponents:{ProductAddToCartComponent:{component:Nt,data:{inventoryDisplay:!1}}}})],imports:[$,ut,ot,ht,Tt,mt,et]})}}return i})();export{Nt as a,re as b};
