import './polyfills.server.mjs';
import{d as K}from"./chunk-D2CXG3O3.mjs";import{c as _,d as B,h as G,k as Z,l as q,m as J,n as w,o as W,p as Y,q as z}from"./chunk-PEKFRSF3.mjs";import"./chunk-QILLSGGT.mjs";import{V as E,W as V,X as S,Y as Q}from"./chunk-HCL456IH.mjs";import"./chunk-M3PBDWUL.mjs";import{$f as N,Bf as p,Bg as k,Ce as M,Cf as I,Ee as F,Hf as U,I as m,Re as P,Wf as R,fb as T,hd as j,if as g,lf as y,ma as d,na as D,of as v,pa as a,q as O,qa as c,re as L,sd as u,tg as H,ud as A,vg as x,yd as h}from"./chunk-JI3YDV22.mjs";import{a as C,b as $}from"./chunk-H4UZCO6D.mjs";var te=(()=>{class r{constructor(t){this.converter=t}convert(t,e){return e===void 0&&(e=C({},t)),this.removeDuplicatePromotions(t,e),this.handleQuoteCode(t,e),t.entries&&(e.entries=t.entries.map(i=>$(C({},i),{product:this.converter.convert(i.product,k),promotions:this.converter.convert({item:i,promotions:e?.appliedProductPromotions},V)}))),e}handleQuoteCode(t,e){t.sapQuote&&(e.quoteCode=t.sapQuote.code)}removeDuplicatePromotions(t,e){t&&t.potentialOrderPromotions&&(e.potentialOrderPromotions=this.removeDuplicateItems(t.potentialOrderPromotions)),t&&t.potentialProductPromotions&&(e.potentialProductPromotions=this.removeDuplicateItems(t.potentialProductPromotions)),t&&t.appliedOrderPromotions&&(e.appliedOrderPromotions=this.removeDuplicateItems(t.appliedOrderPromotions)),t&&t.appliedProductPromotions&&(e.appliedProductPromotions=this.removeDuplicateItems(t.appliedProductPromotions))}removeDuplicateItems(t){return t.filter((e,i,o)=>{let s=o.map(n=>JSON.stringify(n));return i===s.indexOf(JSON.stringify(e))})}static{this.\u0275fac=function(e){return new(e||r)(a(p))}}static{this.\u0275prov=d({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),re=(()=>{class r{convert(t,e){return e=this.getProductPromotion(t.item,t.promotions),e}getProductPromotion(t,e){let i=[];return e?.forEach(o=>{if(o.description&&o.consumedEntries)for(let s of o.consumedEntries)this.isConsumedByEntry(s,t)&&i.push(o)}),i}isConsumedByEntry(t,e){let i=t.orderEntryNumber;if(e&&e.entries&&e.entries.length>0){for(let o of e.entries)if(o.entryNumber===i)return!0;return!1}else return i===e?.entryNumber}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275prov=d({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),ie=(()=>{class r{constructor(){this.logger=c(P),this.http=c(h),this.occEndpointsService=c(v),this.converterService=c(p)}getCartAccessCode(t,e){return this.http.post(this.getCartAccessCodeEndpoint(t,e),null).pipe(m(i=>{throw I(i,this.logger)}),R({shouldRetry:U,maxTries:2}),this.converterService.pipeable(q))}getCartAccessCodeEndpoint(t,e){return this.occEndpointsService.buildUrl("cartAccessCode",{urlParams:{userId:t,cartId:e}})}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275prov=d({token:r,factory:r.\u0275fac})}}return r})(),oe=(()=>{class r{constructor(t,e,i){this.http=t,this.occEndpointsService=e,this.converterService=i}add(t,e,i,o=1,s){let n=this.occEndpointsService.buildUrl("addEntries",{urlParams:{userId:t,cartId:e,quantity:o}});if(n.includes(`quantity=${o}`)){let b=new u({"Content-Type":"application/x-www-form-urlencoded"});return this.http.post(n,{},{headers:b,params:{code:i}}).pipe(this.converterService.pipeable(S))}let l=C({quantity:o,product:{code:i}},s&&{deliveryPointOfService:{name:s}}),f=new u({"Content-Type":"application/json"});return this.http.post(n,l,{headers:f}).pipe(this.converterService.pipeable(S))}update(t,e,i,o,s,n=!1){let l=new u({"Content-Type":"application/json"}),f=this.occEndpointsService.buildUrl("updateEntries",{urlParams:{userId:t,cartId:e,entryNumber:i}});if(s===void 0&&n)return this.http.put(f,{quantity:o},{headers:l}).pipe(this.converterService.pipeable(S));let b={};return s&&(b={deliveryPointOfService:{name:s}}),this.http.patch(f,C({quantity:o},b),{headers:l}).pipe(this.converterService.pipeable(S))}remove(t,e,i){let o=new u({"Content-Type":"application/x-www-form-urlencoded"}),s=this.occEndpointsService.buildUrl("removeEntries",{urlParams:{userId:t,cartId:e,entryNumber:i}});return this.http.delete(s,{headers:o})}static{this.\u0275fac=function(e){return new(e||r)(a(h),a(v),a(p))}}static{this.\u0275prov=d({token:r,factory:r.\u0275fac})}}return r})(),se={"Content-Type":"application/json"},ne=(()=>{class r{constructor(){this.logger=c(P),this.http=c(h),this.occEndpointsService=c(v),this.converterService=c(p)}getRequestHeaders(){return y.createHeader(g,!0,new u(C({},se)))}createCartGuestUser(t,e,i){return this.http.post(this.getCartGuestUserEndpoint(t,e),i,{headers:this.getRequestHeaders()}).pipe(m(o=>{throw N(o,this.logger)}),R({shouldRetry:U,maxTries:2}),this.converterService.pipeable(w))}updateCartGuestUser(t,e,i){return this.http.patch(this.getCartGuestUserEndpoint(t,e),i,{headers:this.getRequestHeaders()}).pipe(m(o=>{throw N(o,this.logger)}),R({shouldRetry:U,maxTries:2}),this.converterService.pipeable(w))}getCartGuestUserEndpoint(t,e){return this.occEndpointsService.buildUrl("cartGuestUser",{urlParams:{userId:t,cartId:e}})}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275prov=d({token:r,factory:r.\u0275fac})}}return r})(),ae=(()=>{class r{constructor(t,e,i){this.http=t,this.occEndpoints=e,this.converter=i,this.logger=c(P)}validate(t,e){let i=this.occEndpoints.buildUrl("validate",{urlParams:{cartId:t,userId:e}});return this.http.post(i,null).pipe(m(o=>{throw I(o,this.logger)}),this.converter.pipeable(W))}static{this.\u0275fac=function(e){return new(e||r)(a(h),a(v),a(p))}}static{this.\u0275prov=d({token:r,factory:r.\u0275fac})}}return r})(),ce=(()=>{class r{constructor(t,e,i){this.http=t,this.occEndpoints=e,this.converter=i,this.logger=c(P)}getCartVoucherEndpoint(t,e){return this.occEndpoints.buildUrl("cartVoucher",{urlParams:{userId:t,cartId:e}})}getHeaders(t){let e=new u({"Content-Type":"application/json"});return t===M&&(e=y.createHeader(g,!0,e)),e}add(t,e,i){let o=this.getCartVoucherEndpoint(t,e),s=JSON.stringify({}),n=new A().set("voucherId",i),l=this.getHeaders(t);return this.http.post(o,s,{headers:l,params:n}).pipe(m(f=>{throw I(f,this.logger)}),this.converter.pipeable(Q))}remove(t,e,i){let o=this.getCartVoucherEndpoint(t,e)+"/"+encodeURIComponent(i),s=this.getHeaders(t);return this.http.delete(o,{headers:s}).pipe(m(n=>{throw I(n,this.logger)}))}static{this.\u0275fac=function(e){return new(e||r)(a(h),a(v),a(p))}}static{this.\u0275prov=d({token:r,factory:r.\u0275fac})}}return r})(),de=(()=>{class r{constructor(t,e,i){this.http=t,this.occEndpointsService=e,this.converterService=i,this.featureConfigService=c(H)}loadAll(t){return this.http.get(this.occEndpointsService.buildUrl("carts",{urlParams:{userId:t}})).pipe(O(e=>e.carts??[]),this.converterService.pipeableMany(E))}load(t,e){return e===F?this.loadAll(t).pipe(O(i=>i.find(o=>o.saveTime===void 0))):this.http.get(this.occEndpointsService.buildUrl("cart",{urlParams:{userId:t,cartId:e}})).pipe(this.converterService.pipeable(E))}create(t,e,i){let o=JSON.stringify({}),s={};return e&&(s.oldCartId=e),i&&(s.toMergeCartGuid=i),this.http.post(this.occEndpointsService.buildUrl("createCart",{urlParams:{userId:t},queryParams:s}),o).pipe(this.converterService.pipeable(E))}delete(t,e){let i=new u;return t===M&&(i=y.createHeader(g,!0,i)),this.http.delete(this.occEndpointsService.buildUrl("deleteCart",{urlParams:{userId:t,cartId:e}}),{headers:i})}save(t,e,i,o){let s=this.occEndpointsService.buildUrl("saveCart",{urlParams:{userId:t,cartId:e,saveCartName:i,saveCartDescription:o}}),n=new A;return this.featureConfigService?.isEnabled("occCartNameAndDescriptionInHttpRequestBody")&&(n=n.set("saveCartName",i).set("saveCartDescription",o)),this.http.patch(s,n).pipe(O(l=>l.savedCartData),this.converterService.pipeable(E))}addEmail(t,e,i){let o=new u({"Content-Type":"application/x-www-form-urlencoded"});o=y.createHeader(g,!0,o);let s=new A().set("email",i),n=this.occEndpointsService.buildUrl("addEmail",{urlParams:{userId:t,cartId:e}});return this.http.put(n,s,{headers:o})}static{this.\u0275fac=function(e){return new(e||r)(a(h),a(v),a(p))}}static{this.\u0275prov=d({token:r,factory:r.\u0275fac})}}return r})();function ue(){return{backend:{occ:{endpoints:{carts:"users/${userId}/carts?fields=carts(DEFAULT,potentialProductPromotions,appliedProductPromotions,potentialOrderPromotions,appliedOrderPromotions,entries(totalPrice(formattedValue),product(images(FULL),stock(FULL)),basePrice(formattedValue,value),updateable),totalPrice(formattedValue),totalItems,totalPriceWithTax(formattedValue),totalDiscounts(value,formattedValue),subTotal(formattedValue),totalUnitCount,deliveryItemsQuantity,deliveryCost(formattedValue),totalTax(formattedValue, value),pickupItemsQuantity,net,appliedVouchers,productDiscounts(formattedValue),user,saveTime,name,description)",cart:"users/${userId}/carts/${cartId}?fields=DEFAULT,potentialProductPromotions,appliedProductPromotions,potentialOrderPromotions,appliedOrderPromotions,entries(totalPrice(formattedValue),product(images(FULL),stock(FULL)),basePrice(formattedValue,value),updateable),totalPrice(formattedValue),totalItems,totalPriceWithTax(formattedValue),totalDiscounts(value,formattedValue),subTotal(formattedValue),totalUnitCount,deliveryItemsQuantity,deliveryCost(formattedValue),totalTax(formattedValue, value),pickupItemsQuantity,net,appliedVouchers,productDiscounts(formattedValue),user,saveTime,name,description",createCart:"users/${userId}/carts?fields=DEFAULT,potentialProductPromotions,appliedProductPromotions,potentialOrderPromotions,appliedOrderPromotions,entries(totalPrice(formattedValue),product(images(FULL),stock(FULL)),basePrice(formattedValue,value),updateable),totalPrice(formattedValue),totalItems,totalPriceWithTax(formattedValue),totalDiscounts(value,formattedValue),subTotal(formattedValue),totalUnitCount,deliveryItemsQuantity,deliveryCost(formattedValue),totalTax(formattedValue, value),pickupItemsQuantity,net,appliedVouchers,productDiscounts(formattedValue),user",addEntries:"users/${userId}/carts/${cartId}/entries",updateEntries:"users/${userId}/carts/${cartId}/entries/${entryNumber}",removeEntries:"users/${userId}/carts/${cartId}/entries/${entryNumber}",addEmail:"users/${userId}/carts/${cartId}/email",deleteCart:"users/${userId}/carts/${cartId}",cartVoucher:"users/${userId}/carts/${cartId}/vouchers",saveCart:c(x).occCartNameAndDescriptionInHttpRequestBody?"/users/${userId}/carts/${cartId}/save":"/users/${userId}/carts/${cartId}/save?saveCartName=${saveCartName}&saveCartDescription=${saveCartDescription}",validate:"users/${userId}/carts/${cartId}/validate?fields=DEFAULT",cartAccessCode:"users/${userId}/carts/${cartId}/accessCode",cartGuestUser:"users/${userId}/carts/${cartId}/guestuser"}}}}}var X=(()=>{class r{static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275mod=T({type:r})}static{this.\u0275inj=D({providers:[L(ue),{provide:G,useClass:de},{provide:E,useExisting:te,multi:!0},{provide:V,useExisting:re,multi:!0},{provide:_,useClass:oe},{provide:B,useClass:ce},{provide:Y,useClass:ae},{provide:Z,useClass:ie},{provide:J,useClass:ne}],imports:[j]})}}return r})();var Ae=(()=>{class r{static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275mod=T({type:r})}static{this.\u0275inj=D({imports:[z,X,K]})}}return r})();export{Ae as CartBaseModule};
