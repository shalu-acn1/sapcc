import './polyfills.server.mjs';
import{a as We,b as gi,c as Ci,d as Ti,e as ft,f as fi,h as hi,i as et,j as ki,k as vi,l as _i,m as xi,n as yi,o as Ei,p as Si,q as bi,r as Ii,s as Ri,t as Di,v as I,w as Re,x as E,y as ht}from"./chunk-FHR7SBPO.mjs";import{H as ui}from"./chunk-HCL456IH.mjs";import{$ as le,$a as li,Aa as ri,B as ti,C as ae,Ca as Ct,D as ii,F as ni,G as oi,Ha as Ze,Ia as Ie,J as Ge,K as Qe,Ka as Tt,L as qe,La as ze,M as He,Oa as me,P as Se,Pa as Ye,X as gt,Xa as ci,Ya as si,Z as Ke,Za as ai,_ as be,b as je,bb as pi,c as H,d as Be,e as $e,f as mt,i as J,l as Pe,o as dt,p as Ve,pb as mi,qb as Xe,rb as di,s as Ue,t as Jt,tc as Je,u as Wt,ua as pe,v as ei,w as ut}from"./chunk-M3PBDWUL.mjs";import{$g as lt,Bf as Qt,Cf as Q,D as St,Db as a,Eb as s,Ef as qt,Fb as g,Ff as Ht,Ga as Dt,Gb as N,Ge as wt,Hb as w,I as F,J as bt,Jb as te,La as Mt,Lb as _,M as K,Mb as k,Pb as Te,Q as It,Rd as rt,Re as jt,Sb as fe,Tb as he,Td as ct,Ub as ke,Ue as Bt,V as Rt,Vb as ce,Vc as At,Wb as m,We as ie,Wg as at,Xa as o,Xb as V,Xc as Le,Xg as Y,Yb as d,Yc as U,Yg as Yt,Zb as nt,a as oe,ah as Ee,bd as G,cb as T,cc as ve,d as yt,da as Z,db as Ae,dc as x,eb as O,fb as b,ga as L,gb as Ft,hd as j,hg as ye,hh as Xt,ib as Oe,ig as Ne,ih as pt,jb as f,kc as c,kh as we,lc as l,lg as ne,ma as A,mc as M,n as Me,na as S,nh as q,o as Et,oa as z,of as $t,oh as X,pa as v,pc as se,q as h,qa as D,qe as B,qf as Pt,r as re,sb as R,sd as ot,se as Lt,sf as _e,tb as p,tf as Vt,tg as Kt,ug as Zt,wa as W,we as Nt,wf as xe,xa as ee,xf as Ut,ya as Fe,yd as Ot,yf as Gt,yg as st,zg as zt}from"./chunk-JI3YDV22.mjs";import{a as tt,b as it}from"./chunk-H4UZCO6D.mjs";var vt=["element"];function Xi(t,u){if(t&1){let e=te();a(0,"div",2)(1,"button",3,0),_("click",function(){W(e);let n=k();return ee(n.openDialog())}),m(3),c(4,"cxTranslate"),s()()}t&2&&(o(3),d(" ",l(4,1,"customerTicketingDetails.closeRequest")," "))}var ge=t=>({count:t});function Ji(t,u){t&1&&g(0,"cx-spinner",17)}var Wi=()=>({required:"true"}),Ai=()=>({});function en(t,u){if(t&1&&(a(0,"option",28),m(1),s()),t&2){let e=u.$implicit,i=k(3);p("ngValue",e)("selected",e.id===(i.selectedCategory==null?null:i.selectedCategory.id)),o(),d(" ",e.name," ")}}function tn(t,u){if(t&1&&(a(0,"select",25)(1,"option",26),m(2),c(3,"cxTranslate"),s(),f(4,en,2,3,"option",27),s()),t&2){let e=k().ngIf;o(2),d(" ",l(3,2,"createCustomerTicket.selectCategory")," "),o(2),p("ngForOf",e)}}function nn(t,u){if(t&1&&(g(0,"ng-select",29),c(1,"cxTranslate")),t&2){let e,i=k().ngIf,n=k();p("inputAttrs",ve(10,Wi))("searchable",!1)("clearable",!1)("items",i)("placeholder",l(1,8,"createCustomerTicket.selectCategory"))("cxNgSelectA11y",ve(11,Ai)),R("aria-invalid",((e=n.form.get("ticketCategory"))==null?null:e.touched)&&((e=n.form.get("ticketCategory"))==null?null:e.invalid))("aria-errormessage","ticketCategoryError")}}function on(t,u){if(t&1&&(a(0,"label")(1,"span",9),m(2),c(3,"cxTranslate"),g(4,"cx-form-required-asterisks"),s(),f(5,tn,5,4,"select",22)(6,nn,2,12,"ng-select",23),g(7,"cx-form-errors",24),s()),t&2){let e=k();o(2),d(" ",l(3,4,"createCustomerTicket.category")," "),o(3),p("cxFeature","!a11ySelectImprovementsCustomerTicketingCreateSelectbox"),o(),p("cxFeature","a11ySelectImprovementsCustomerTicketingCreateSelectbox"),o(),p("control",e.form.get("ticketCategory"))}}function rn(t,u){if(t&1&&(a(0,"option",28),m(1),s()),t&2){let e=u.$implicit,i=k(4);p("ngValue",e)("selected",e.code===(i.selectedAssociatedObject==null?null:i.selectedAssociatedObject.code)),o(),nt(" ",e.type," ",e.code," ")}}function cn(t,u){if(t&1&&(a(0,"select",32)(1,"option",26),m(2),c(3,"cxTranslate"),s(),f(4,rn,2,4,"option",27),s()),t&2){let e=k(2).ngIf;o(2),d(" ",l(3,2,"createCustomerTicket.optionallySelectAssociatedObject")," "),o(2),p("ngForOf",e)}}function sn(t,u){if(t&1&&(a(0,"span"),m(1),s()),t&2){let e=u.item;o(),V(e.type+" "+e.code)}}function an(t,u){if(t&1&&(a(0,"ng-select",33),c(1,"cxTranslate"),f(2,sn,2,1,"ng-template",34),s()),t&2){let e=k(2).ngIf;p("clearable",!1)("items",e)("placeholder",l(1,5,"createCustomerTicket.optionallySelectAssociatedObject"))("searchable",!1)("cxNgSelectA11y",ve(7,Ai))}}function ln(t,u){t&1&&(a(0,"label")(1,"span",9),m(2),c(3,"cxTranslate"),s(),f(4,cn,5,4,"select",30)(5,an,3,8,"ng-select",31),s()),t&2&&(o(2),d(" ",l(3,3,"createCustomerTicket.associateTo")," "),o(2),p("cxFeature","!a11ySelectImprovementsCustomerTicketingCreateSelectbox"),o(),p("cxFeature","a11ySelectImprovementsCustomerTicketingCreateSelectbox"))}function pn(t,u){if(t&1&&(N(0),f(1,ln,6,5,"label",13),w()),t&2){let e=u.ngIf;o(),p("ngIf",e.length>0)}}function mn(t,u){if(t&1&&(g(0,"cx-icon",6),a(1,"span",35),m(2),c(3,"cxTranslate"),s()),t&2){let e=k();p("type",e.iconTypes.UPLOAD),o(2),V(l(3,2,"customerTicketing.uploadFile"))}}function dn(t,u){if(t&1&&(g(0,"cx-icon",6),a(1,"span",20),m(2),c(3,"cxTranslate"),s()),t&2){let e=k();p("type",e.iconTypes.UPLOAD),o(2),V(l(3,2,"customerTicketing.uploadFile"))}}function un(t,u){t&1&&g(0,"cx-spinner",21)}var de=t=>({ticketCode:t}),ue=t=>({cxRoute:"supportTicketDetails",params:t});function gn(t,u){if(t&1){let e=te();a(0,"tr",14),_("click",function(){let n=W(e).$implicit,r=k(3);return ee(r.goToTicketDetail(n.id))}),a(1,"td",15)(2,"div",16),m(3),c(4,"cxTranslate"),s(),a(5,"a",17),c(6,"cxUrl"),m(7),s()(),a(8,"td",18)(9,"div",16),m(10),c(11,"cxTranslate"),s(),a(12,"a",17),c(13,"cxUrl"),m(14),s()(),a(15,"td",18)(16,"div",16),m(17),c(18,"cxTranslate"),s(),a(19,"a",17),c(20,"cxUrl"),m(21),s()(),a(22,"td",18)(23,"div",16),m(24),c(25,"cxTranslate"),s(),a(26,"a",17),c(27,"cxUrl"),m(28),c(29,"cxDate"),s()(),a(30,"td",18)(31,"div",16),m(32),c(33,"cxTranslate"),s(),a(34,"a",17),c(35,"cxUrl"),m(36),c(37,"cxDate"),s()(),a(38,"td",18)(39,"div",16),m(40),c(41,"cxTranslate"),s(),a(42,"a",19),c(43,"cxUrl"),m(44),s()()()}if(t&2){let e=u.$implicit,i=k(3);o(3),d(" ",l(4,19,"customerTicketingList.mobile.ticketIdFull")," "),o(2),p("routerLink",l(6,21,x(49,ue,x(47,de,e.id)))),o(2),d(" ",e.id," "),o(3),d(" ",l(11,23,"customerTicketingList.subject")," "),o(2),p("routerLink",l(13,25,x(53,ue,x(51,de,e.id)))),o(2),d(" ",e.subject," "),o(3),d(" ",l(18,27,"customerTicketingList.ticketCategory")," "),o(2),p("routerLink",l(20,29,x(57,ue,x(55,de,e.id)))),o(2),d(" ",e.ticketCategory==null?null:e.ticketCategory.name," "),o(3),d(" ",l(25,31,"customerTicketing.createdOn")," "),o(2),p("routerLink",l(27,33,x(61,ue,x(59,de,e.id)))),o(2),d(" ",l(29,35,e.createdAt)," "),o(4),d(" ",l(33,37,"customerTicketing.changedOn")," "),o(2),p("routerLink",l(35,39,x(65,ue,x(63,de,e.id)))),o(2),d(" ",l(37,41,e.modifiedAt)," "),o(4),d(" ",l(41,43,"customerTicketing.status")," "),o(2),p("routerLink",l(43,45,x(69,ue,x(67,de,e.id))))("ngClass",i.getStatusClass(e.status.id)),o(2),d(" ",e.status==null?null:e.status.name," ")}}function Cn(t,u){if(t&1){let e=te();a(0,"div",20)(1,"cx-pagination",21),_("viewPageEvent",function(n){W(e);let r=k(3);return ee(r.pageChange(n))}),s()()}if(t&2){let e=k(2).ngIf;o(),p("pagination",e.pagination)}}function Tn(t,u){if(t&1){let e=te();N(0),a(1,"div",5)(2,"label",6)(3,"span"),m(4),c(5,"cxTranslate"),s(),a(6,"cx-sorting",7),c(7,"cxTranslate"),c(8,"async"),c(9,"cxTranslate"),_("sortListEvent",function(n){W(e);let r=k(2);return ee(r.changeSortCode(n))}),s()(),g(10,"cx-customer-ticketing-create"),s(),a(11,"table",8)(12,"thead",9)(13,"tr")(14,"th",10),m(15),c(16,"cxTranslate"),s(),a(17,"th",10),m(18),c(19,"cxTranslate"),s(),a(20,"th",10),m(21),c(22,"cxTranslate"),s(),a(23,"th",10),m(24),c(25,"cxTranslate"),s(),a(26,"th",10),m(27),c(28,"cxTranslate"),s(),a(29,"th",10),m(30),c(31,"cxTranslate"),s()()(),a(32,"tbody"),f(33,gn,45,71,"tr",11),s()(),a(34,"div",12),f(35,Cn,2,1,"div",13),s(),w()}if(t&2){let e=k().ngIf,i=k();o(4),d(" ",l(5,14,"customerTicketingList.sortSubtitle")," "),o(2),Te("placeholder",l(7,16,"customerTicketingList.sortSubtitle")),p("sortOptions",e.sorts)("sortLabels",l(8,18,i.getSortLabels()))("selectedOption",e.pagination==null?null:e.pagination.sort)("ariaLabel",l(9,20,"customerTicketingList.sortOrders")),o(9),V(l(16,22,"customerTicketing.ticketId")),o(3),d(" ",l(19,24,"customerTicketingList.subject")," "),o(3),d(" ",l(22,26,"customerTicketingList.ticketCategory")," "),o(3),V(l(25,28,"customerTicketing.createdOn")),o(3),V(l(28,30,"customerTicketing.changedOn")),o(3),V(l(31,32,"customerTicketing.status")),o(3),p("ngForOf",e.tickets),o(2),p("ngIf",(e.pagination==null?null:e.pagination.totalPages)>1)}}function fn(t,u){t&1&&(g(0,"cx-customer-ticketing-create"),N(1),a(2,"div",22)(3,"h3"),m(4),c(5,"cxTranslate"),s()(),w()),t&2&&(o(4),V(l(5,1,"customerTicketingList.noTickets")))}function hn(t,u){if(t&1&&(N(0),a(1,"span",3)(2,"h2",4),m(3),c(4,"cxTranslate"),s()(),f(5,Tn,36,34,"ng-container",2)(6,fn,6,3,"ng-template",null,1,se),w()),t&2){let e=u.ngIf,i=ce(7);o(3),nt(" ",l(4,4,"customerTicketingList.requestTitle")," (",(e.pagination==null?null:e.pagination.totalResults)||0,") "),o(2),p("ngIf",e.tickets.length>0)("ngIfElse",i)}}function kn(t,u){t&1&&g(0,"cx-spinner")}function vn(t,u){if(t&1&&(N(0),a(1,"div",2)(2,"div",3)(3,"div",4),g(4,"cx-card",5),c(5,"async"),s(),a(6,"div",4),g(7,"cx-card",5),c(8,"cxDate"),c(9,"async"),s(),a(10,"div",4),g(11,"cx-card",5),c(12,"cxDate"),c(13,"async"),s(),a(14,"div",4),g(15,"cx-card",5),c(16,"async"),s()()(),w()),t&2){let e,i,n=u.ngIf,r=k();o(4),p("content",l(5,4,r.prepareCardContent(n.id,"customerTicketing.ticketId"))),o(3),p("content",l(9,9,r.prepareCardContent((e=M(8,6,n.createdAt,r.dateFormat))!==null&&e!==void 0?e:r.dateFormat,"customerTicketing.createdOn"))),o(4),p("content",l(13,14,r.prepareCardContent((i=M(12,11,n.modifiedAt,r.dateFormat))!==null&&i!==void 0?i:r.dateFormat,"customerTicketing.changedOn"))),o(4),p("content",l(16,16,r.prepareCardContent(n.status?n.status.name:void 0,"customerTicketing.status",n.status?n.status.id:void 0)))}}function _n(t,u){t&1&&g(0,"cx-spinner")}function xn(t,u){if(t&1){let e=te();a(0,"div",2)(1,"button",3,0),_("click",function(){W(e);let n=k();return ee(n.openDialog())}),m(3),c(4,"cxTranslate"),s()()}t&2&&(o(3),d(" ",l(4,1,"customerTicketingDetails.reopenRequest")," "))}var yn=()=>({cxRoute:"supportTickets"}),Mi=t=>({value:t});function En(t,u){if(t&1&&(N(0),a(1,"div",9)(2,"span",10),c(3,"cxTranslate"),m(4),s(),a(5,"span",11),m(6),s(),a(7,"span",11),c(8,"cxTranslate"),m(9),c(10,"cxTranslate"),s()(),a(11,"div",11),m(12),c(13,"cxDate"),c(14,"cxTranslate"),s(),w()),t&2){let e=u.$implicit;o(2),R("aria-label",l(3,6,"myAccountV2CustomerTicketing.subjectLabel")),o(2),d(" ",e.subject," "),o(2),d(" | ",e.ticketCategory==null?null:e.ticketCategory.name," "),o(),R("aria-label",l(8,8,"myAccountV2CustomerTicketing.idLabel")),o(2),d(" | ",M(10,10,"myAccountV2CustomerTicketing.ticketId",x(19,Mi,e.id))," "),o(3),d(" ",M(14,16,"myAccountV2CustomerTicketing.changedOn",x(21,Mi,M(13,13,e.modifiedAt,"d, MMMM, yyyy")))," ")}}function Sn(t,u){if(t&1&&(N(0),a(1,"div",7),f(2,En,15,23,"ng-container",8),s(),w()),t&2){let e=k().ngIf;o(2),p("ngForOf",e.tickets)}}function bn(t,u){if(t&1&&(N(0),f(1,Sn,3,1,"ng-container",6),w()),t&2){let e=u.ngIf;k();let i=ce(15);o(),p("ngIf",e.tickets.length>0)("ngIfElse",i)}}function In(t,u){t&1&&(a(0,"div",12),c(1,"cxTranslate"),m(2),c(3,"cxTranslate"),s()),t&2&&(R("aria-label",l(1,2,"customerTicketingList.noTickets")),o(2),d(" ",l(3,4,"customerTicketingList.noTickets")," "))}function Rn(t,u){t&1&&g(0,"cx-spinner")}var Oi=(()=>{class t{constructor(){this.customerTicketingFacade=D(I)}enableCloseButton(){return this.customerTicketingFacade.getTicket().pipe(h(e=>(e?.status?.id===E.OPEN||e?.status?.id===E.INPROCESS)&&e.availableStatusTransitions?.some(i=>i.id.toUpperCase()===E.CLOSED)))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=A({token:t,factory:t.\u0275fac})}}return t})(),Dn=(()=>{class t{constructor(e,i,n){this.customerTicketingFacade=e,this.launchDialogService=i,this.vcr=n,this.subscription=new oe,this.customerTicketingCloseComponentService=D(Oi),this.enableCloseButton$=this.customerTicketingCloseComponentService.enableCloseButton()}openDialog(){let e=this.launchDialogService.openDialog(He.CUSTOMER_TICKETING_CLOSE,this.element,this.vcr);e&&this.subscription.add(e.pipe(K(1)).subscribe())}ngOnDestroy(){this.subscription?.unsubscribe()}static{this.\u0275fac=function(i){return new(i||t)(T(I),T(Se),T(Ae))}}static{this.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-close"]],viewQuery:function(i,n){if(i&1&&fe(vt,5),i&2){let r;he(r=ke())&&(n.element=r.first)}},standalone:!1,decls:2,vars:3,consts:[["element",""],["class","col-xs-12 col-md-5 col-lg-4",4,"ngIf"],[1,"col-xs-12","col-md-5","col-lg-4"],[1,"btn","btn-block","btn-secondary",3,"click"]],template:function(i,n){i&1&&(f(0,Xi,5,3,"div",1),c(1,"async")),i&2&&p("ngIf",l(1,1,n.enableCloseButton$))},dependencies:[U,G,q],encapsulation:2})}}return t})(),_t=(()=>{class t{get messagesCharacterLeft(){return this.inputCharactersLimit-(this.form.get("message")?.value?.length||0)}get subjectCharacterLeft(){return this.inputCharactersForSubject-(this.form.get("subject")?.value?.length||0)}get allowedTypes(){return this.customerTicketingConfig.customerTicketing?.attachmentRestrictions?.allowedTypes}get getInputCharactersLimit(){return this.customerTicketingConfig.customerTicketing?.inputCharactersLimit??gi}get getInputCharactersForSubject(){return this.customerTicketingConfig.customerTicketing?.inputCharactersLimitForSubject??Ci}get maxSize(){return this.customerTicketingConfig.customerTicketing?.attachmentRestrictions?.maxSize??Ti}handleClick(e){e.target.tagName===this.el.nativeElement.tagName&&this.close("Click outside of the window")}constructor(e,i,n,r,C,$){this.launchDialogService=e,this.el=i,this.customerTicketingConfig=n,this.filesFormValidators=r,this.customerTicketingFacade=C,this.routingService=$,this.iconTypes=gt,this.inputCharactersLimit=this.getInputCharactersLimit,this.inputCharactersForSubject=this.getInputCharactersForSubject,this.isDataLoading$=new yt(!1),this.focusConfig={trap:!0,block:!0,autofocus:"button",focusOnEscape:!0}}buildForm(){let e=new mt({});e.setControl("message",new J("",[H.required,H.maxLength(this.inputCharactersLimit)])),e.setControl("file",new J("",[this.filesFormValidators.maxSize(this.maxSize),this.filesFormValidators.maxEntries(ft),this.filesFormValidators.allowedTypes(this.allowedTypes)])),this.form=e}close(e){this.launchDialogService.closeDialog(e)}static{this.\u0275fac=function(i){return new(i||t)(T(Se),T(Dt),T(We),T(mi),T(I),T(ie))}}static{this.\u0275dir=Ft({type:t,hostBindings:function(i,n){i&1&&_("click",function(C){return n.handleClick(C)})}})}}return t})(),Mn=(()=>{class t extends _t{ngOnInit(){this.buildForm()}closeRequest(){this.form.invalid?(this.form.markAllAsTouched(),Je.deepUpdateValueAndValidity(this.form)):(this.isDataLoading$.next(!0),this.subscription=this.customerTicketingFacade.createTicketEvent(this.prepareTicketEvent()).subscribe({complete:()=>{this.onComplete()},error:()=>{this.onError()}}))}prepareTicketEvent(){return{message:this.form?.get("message")?.value,toStatus:{id:E.CLOSED,name:ht.CLOSED}}}onComplete(){this.isDataLoading$.next(!1),this.close("Ticket closed successfully"),this.routingService.go({cxRoute:"supportTickets"})}onError(){this.close("Something went wrong while closing the ticket"),this.isDataLoading$.next(!1)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=Fe(t)))(n||t)}})()}static{this.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-close-dialog"]],standalone:!1,features:[Oe],decls:32,vars:34,consts:[["role","dialog","aria-labelledby","dialogTitle",1,"modal-dialog","modal-dialog-centered","cx-customer-ticket-form-dialog",3,"esc","cxFocus"],[1,"modal-content","cx-customer-ticket-form-container",3,"formGroup"],[1,"modal-header","cx-customer-ticket-form-header"],["id","dialogTitle",1,"cx-customer-ticket-form-title","modal-title"],[1,"cx-customer-ticket-form-close","close",3,"click","title"],["aria-hidden","true"],[3,"type"],[1,"modal-body","cx-customer-ticket-form-body"],[1,"cx-customer-ticket-form-row"],[1,"cx-customer-ticket-label","label-content"],["required","true","formControlName","message","rows","5",1,"form-control",3,"maxLength"],["id","messageError",3,"control"],[1,"cx-customer-ticket-input-hint"],[1,"cx-customer-ticket-form-footer"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",3,"click"],["class","overlay",4,"ngIf"],[1,"overlay"]],template:function(i,n){if(i&1&&(a(0,"div",0),_("esc",function(){return n.close("Escape clicked")}),a(1,"form",1)(2,"div",2)(3,"div",3),m(4),c(5,"cxTranslate"),s(),a(6,"button",4),c(7,"cxTranslate"),c(8,"cxTranslate"),_("click",function(){return n.close("Close Request Dialog")}),a(9,"span",5),g(10,"cx-icon",6),s()()(),a(11,"div",7)(12,"div",8)(13,"label")(14,"span",9),m(15),c(16,"cxTranslate"),g(17,"cx-form-required-asterisks"),s(),g(18,"textarea",10)(19,"cx-form-errors",11),a(20,"p",12),m(21),c(22,"cxTranslate"),s()()(),a(23,"div",13)(24,"button",14),_("click",function(){return n.close("Close Request Dialog")}),m(25),c(26,"cxTranslate"),s(),a(27,"button",15),_("click",function(){return n.closeRequest()}),m(28),c(29,"cxTranslate"),s()()(),f(30,Ji,1,0,"cx-spinner",16),c(31,"async"),s()()),i&2){let r;p("cxFocus",n.focusConfig),o(),p("formGroup",n.form),o(3),d(" ",l(5,15,"customerTicketingDetails.closeRequest")," "),o(2),Te("title",l(7,17,"common.close")),R("aria-label",l(8,19,"common.close")),o(4),p("type",n.iconTypes.CLOSE),o(5),d(" ",l(16,21,"customerTicketing.message")," "),o(3),p("maxLength",n.inputCharactersLimit),R("aria-invalid",((r=n.form.get("message"))==null?null:r.touched)&&((r=n.form.get("message"))==null?null:r.invalid))("aria-errormessage","messageError"),o(),p("control",n.form.get("message")),o(2),d(" ",M(22,23,"customerTicketing.charactersLeft",x(32,ge,n.messagesCharacterLeft))," "),o(4),d(" ",l(26,26,"customerTicketing.cancel")," "),o(3),d(" ",l(29,28,"customerTicketing.submit")," "),o(2),p("ngIf",l(31,30,n.isDataLoading$))}},dependencies:[U,Ke,Ge,Pe,je,Be,$e,ut,Ve,Ue,Ze,le,me,G,q],encapsulation:2})}}return t})(),Fn=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=b({type:t})}static{this.\u0275inj=S({providers:[Oi,B({cmsComponents:{SupportTicketCloseComponent:{component:Dn,guards:[ne]}}})],imports:[j,X,be,Qe,ae,Ie,ze,pe,st,me]})}}return t})(),An=(()=>{class t extends _t{constructor(){super(...arguments),this.ticketCategories$=this.customerTicketingFacade.getTicketCategories().pipe(L(e=>{this.manageCategoryValidation(e)})),this.ticketAssociatedObjects$=this.customerTicketingFacade.getTicketAssociatedObjects().pipe(h(e=>e.map(i=>it(tt({},i),{label:`${i.type} ${i.code}`}))),F(e=>(this.handleError(e),Me([])))),this.globalMessage=D(Ne),this.translationService=D(Y),this.featureService=D(Kt,{optional:!0})}getCreateTicketPayload(e){return{message:e?.get("message")?.value,subject:e?.get("subject")?.value,associatedTo:e?.get("associatedTo")?.value||void 0,ticketCategory:e?.get("ticketCategory")?.value}}ngOnInit(){this.buildForm(),this.featureService?.isEnabled("a11ySelectImprovementsCustomerTicketingCreateSelectbox")&&(this.focusConfig.trap=!1,this.focusConfig.trapTabOnly=!0)}buildForm(){let e=new mt({});e.setControl("subject",new J("",[H.required,H.maxLength(this.inputCharactersForSubject)])),e.setControl("ticketCategory",new J("",[H.required])),e.setControl("associatedTo",new J("")),e.setControl("message",new J("",[H.required,H.maxLength(this.inputCharactersLimit)])),e.setControl("file",new J("",[this.filesFormValidators.maxSize(this.maxSize),this.filesFormValidators.maxEntries(ft),this.filesFormValidators.allowedTypes(this.allowedTypes)])),this.form=e}createTicketRequest(){this.attachment=this.form.get("file")?.value?.[0],this.form.invalid?(this.form.markAllAsTouched(),Je.deepUpdateValueAndValidity(this.form)):this.subscription=this.customerTicketingFacade.createTicket(this.getCreateTicketPayload(this.form)).subscribe({next:e=>{e.id&&this.attachment&&e.ticketEvents?.[0].code&&this.customerTicketingFacade.uploadAttachment(this.attachment,e.ticketEvents?.[0].code,e.id)},complete:()=>{this.onComplete()},error:e=>{this.handleError(e)}})}handleError(e){e instanceof Nt?(e.details??[]).forEach(i=>{i.message&&this.globalMessage.add({raw:i.message},ye.MSG_TYPE_ERROR)}):this.translationService.translate("httpHandlers.unknownError").pipe(Rt()).subscribe(i=>{this.globalMessage.add({raw:i},ye.MSG_TYPE_ERROR)}),this.onError()}manageCategoryValidation(e){let i=this.form.get("ticketCategory");i&&(e?.length?(i.setValidators(H.required),i.updateValueAndValidity()):(i.clearValidators(),i.updateValueAndValidity()))}onComplete(){this.close("Ticket created successfully")}onError(){this.close("Something went wrong")}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=Fe(t)))(n||t)}})()}static{this.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-create-dialog"]],inputs:{selectedCategory:"selectedCategory",selectedAssociatedObject:"selectedAssociatedObject"},standalone:!1,features:[Oe],decls:55,vars:62,consts:[["role","dialog","aria-labelledby","dialogTitle",1,"modal-dialog","modal-dialog-centered","cx-customer-ticket-form-dialog",3,"esc","cxFocus"],[1,"modal-content","cx-customer-ticket-form-container",3,"formGroup"],[1,"modal-header","cx-customer-ticket-form-header"],["id","dialogTitle",1,"cx-customer-ticket-form-title","modal-title"],["type","button",1,"cx-customer-ticket-form-close","close",3,"click","title"],["aria-hidden","true"],[3,"type"],[1,"modal-body","cx-customer-ticket-form-body"],[1,"cx-customer-ticket-form-row"],[1,"cx-customer-ticket-label","label-content"],["required","true","formControlName","subject","rows","1",1,"form-control",3,"maxLength"],["id","subjectError",3,"control"],[1,"cx-customer-ticket-input-hint"],[4,"ngIf"],["required","true","formControlName","message","rows","5",1,"form-control",3,"maxLength"],["id","messageError",3,"control"],[3,"formControl","accept"],[1,"cx-customer-ticket-file-upload-hint"],["prefix","formErrors.file",3,"control"],[1,"cx-customer-ticket-form-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["class","form-control","formControlName","ticketCategory",4,"cxFeature"],["class","ticket-category-select","id","ticket-category-select","bindLabel","name","formControlName","ticketCategory",3,"inputAttrs","searchable","clearable","items","placeholder","cxNgSelectA11y",4,"cxFeature"],["id","ticketCategoryError",3,"control"],["formControlName","ticketCategory",1,"form-control"],["value","","disabled","","selected",""],[3,"ngValue","selected",4,"ngFor","ngForOf"],[3,"ngValue","selected"],["id","ticket-category-select","bindLabel","name","formControlName","ticketCategory",1,"ticket-category-select",3,"inputAttrs","searchable","clearable","items","placeholder","cxNgSelectA11y"],["class","form-control","formControlName","associatedTo",4,"cxFeature"],["formControlName","associatedTo","id","associated-to-select",3,"clearable","items","placeholder","searchable","cxNgSelectA11y",4,"cxFeature"],["formControlName","associatedTo",1,"form-control"],["formControlName","associatedTo","id","associated-to-select",3,"clearable","items","placeholder","searchable","cxNgSelectA11y"],["ng-option-tmp",""],[1,"cx-message-footer-text"]],template:function(i,n){if(i&1&&(a(0,"div",0),_("esc",function(){return n.close("Escape clicked")}),a(1,"form",1)(2,"div",2)(3,"div",3),m(4),c(5,"cxTranslate"),s(),a(6,"button",4),c(7,"cxTranslate"),c(8,"cxTranslate"),_("click",function(){return n.close("Close Create Request Dialog")}),a(9,"span",5),g(10,"cx-icon",6),s()()(),a(11,"div",7)(12,"div",8),g(13,"cx-form-required-legend"),a(14,"label")(15,"span",9),m(16),c(17,"cxTranslate"),g(18,"cx-form-required-asterisks"),s(),g(19,"textarea",10)(20,"cx-form-errors",11),a(21,"p",12),m(22),c(23,"cxTranslate"),s()(),f(24,on,8,6,"label",13),c(25,"async"),f(26,pn,2,1,"ng-container",13),c(27,"async"),a(28,"label")(29,"span",9),m(30),c(31,"cxTranslate"),g(32,"cx-form-required-asterisks"),s(),g(33,"textarea",14)(34,"cx-form-errors",15),a(35,"p",12),m(36),c(37,"cxTranslate"),s()(),a(38,"div")(39,"cx-file-upload",16),f(40,mn,4,4,"ng-template"),s(),a(41,"p",17),m(42),c(43,"cxTranslate"),s(),a(44,"p",17),m(45),c(46,"cxTranslate"),s(),g(47,"cx-form-errors",18),s()(),a(48,"div",19)(49,"button",20),_("click",function(){return n.close("Close Create Request Dialog")}),m(50),c(51,"cxTranslate"),s(),a(52,"button",21),_("click",function(){return n.createTicketRequest()}),m(53),c(54,"cxTranslate"),s()()()()()),i&2){let r,C;p("cxFocus",n.focusConfig),o(),p("formGroup",n.form),o(3),d(" ",l(5,27,"createCustomerTicket.addNewRequest")," "),o(2),Te("title",l(7,29,"common.close")),R("aria-label",l(8,31,"common.close")),o(4),p("type",n.iconTypes.CLOSE),o(6),d(" ",l(17,33,"createCustomerTicket.subject")," "),o(3),p("maxLength",n.inputCharactersForSubject),R("aria-invalid",((r=n.form.get("subject"))==null?null:r.touched)&&((r=n.form.get("subject"))==null?null:r.invalid))("aria-errormessage","subjectError"),o(),p("control",n.form.get("subject")),o(2),d(" ",M(23,35,"customerTicketing.charactersLeft",x(56,ge,n.subjectCharacterLeft))," "),o(2),p("ngIf",l(25,38,n.ticketCategories$)),o(2),p("ngIf",l(27,40,n.ticketAssociatedObjects$)),o(4),d(" ",l(31,42,"customerTicketing.message")," "),o(3),p("maxLength",n.inputCharactersLimit),R("aria-invalid",((C=n.form.get("message"))==null?null:C.touched)&&((C=n.form.get("message"))==null?null:C.invalid))("aria-errormessage","messageError"),o(),p("control",n.form.get("message")),o(2),d(" ",M(37,44,"customerTicketing.charactersLeft",x(58,ge,n.messagesCharacterLeft))," "),o(3),p("formControl",n.form.get("file"))("accept",n.allowedTypes),o(3),d(" ",M(43,47,"customerTicketing.fileSizeLimit",x(60,ge,n.maxSize))," "),o(3),d(" ",l(46,50,"customerTicketing.maximumAttachment")," "),o(2),p("control",n.form.get("file")),o(3),d(" ",l(51,52,"customerTicketing.cancel")," "),o(3),d(" ",l(54,54,"customerTicketing.submit")," ")}},dependencies:[Le,U,Ke,Ge,Pe,Wt,ei,je,Jt,Be,$e,ut,dt,Ve,Ue,Ze,Tt,Zt,ni,ii,ci,me,Ye,G,q],encapsulation:2})}}return t})(),On=(()=>{class t{constructor(e,i){this.launchDialogService=e,this.vcr=i,this.subscription=new oe}openCreateNewTicketDialog(){let e=this.launchDialogService.openDialog(He.CUSTOMER_TICKETING_CREATE,this.element,this.vcr);e&&this.subscription.add(e.pipe(K(1)).subscribe())}ngOnDestroy(){this.subscription?.unsubscribe()}static{this.\u0275fac=function(i){return new(i||t)(T(Se),T(Ae))}}static{this.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-create"]],viewQuery:function(i,n){if(i&1&&fe(vt,5),i&2){let r;he(r=ke())&&(n.element=r.first)}},standalone:!1,decls:4,vars:3,consts:[["element",""],[1,"btn","btn-primary","cx-customer-ticketing-create",3,"click"]],template:function(i,n){if(i&1){let r=te();a(0,"button",1,0),_("click",function(){return W(r),ee(n.openCreateNewTicketDialog())}),m(2),c(3,"cxTranslate"),s()}i&2&&(o(2),d(" ",l(3,1,"createCustomerTicket.addRequest"),`
`))},dependencies:[q],encapsulation:2})}}return t})(),Li=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=b({type:t})}static{this.\u0275inj=S({imports:[j,X,be,Qe,ae,Ie,ze,st,oi,ai,me,Ye]})}}return t})(),Ln=(()=>{class t extends _t{ngOnInit(){this.buildForm()}reopenRequest(){if(this.form.invalid)this.form.markAllAsTouched(),Je.deepUpdateValueAndValidity(this.form);else{let e=this.form.get("file")?.value?.length>0;this.isDataLoading$.next(!0),this.subscription=this.customerTicketingFacade.createTicketEvent(this.prepareTicketEvent(),e).subscribe({next:i=>{this.form.get("file")?.value?.length&&i.code&&this.customerTicketingFacade.uploadAttachment(this.form.get("file")?.value?.item(0),i.code)},complete:()=>{this.onComplete()},error:()=>{this.onError()}})}}onComplete(){this.isDataLoading$.next(!1),this.close("Ticket reopened successfully")}onError(){this.isDataLoading$.next(!1),this.close("Something went wrong while reopening ticket")}prepareTicketEvent(){return{message:this.form?.get("message")?.value,toStatus:{id:E.INPROCESS,name:ht.INPROCESS}}}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=Fe(t)))(n||t)}})()}static{this.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-reopen-dialog"]],standalone:!1,features:[Oe],decls:41,vars:46,consts:[["role","dialog","aria-labelledby","dialogTitle",1,"modal-dialog","modal-dialog-centered","cx-customer-ticket-form-dialog",3,"esc","cxFocus"],[1,"modal-content","cx-customer-ticket-form-container",3,"formGroup"],[1,"modal-header","cx-customer-ticket-form-header"],["id","dialogTitle",1,"cx-customer-ticket-form-title","modal-title"],["type","button",1,"cx-customer-ticket-form-close","close",3,"click","title"],["aria-hidden","true"],[3,"type"],[1,"modal-body","cx-customer-ticket-form-body"],[1,"cx-customer-ticket-form-row"],[1,"cx-customer-ticket-label","label-content"],["formControlName","message","rows","5",1,"form-control",3,"maxLength"],["id","messageError",3,"control"],[1,"cx-customer-ticket-input-hint"],[3,"formControl","accept"],[1,"cx-customer-ticket-file-upload-hint"],["prefix","formErrors.file",3,"control"],[1,"cx-customer-ticket-form-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["class","overlay",4,"ngIf"],[1,"cx-message-footer-text"],[1,"overlay"]],template:function(i,n){if(i&1&&(a(0,"div",0),_("esc",function(){return n.close("Escape clicked")}),a(1,"form",1)(2,"div",2)(3,"div",3),m(4),c(5,"cxTranslate"),s(),a(6,"button",4),c(7,"cxTranslate"),c(8,"cxTranslate"),_("click",function(){return n.close("Close Reopen Request Dialog")}),a(9,"span",5),g(10,"cx-icon",6),s()()(),a(11,"div",7)(12,"div",8)(13,"label")(14,"span",9),m(15),c(16,"cxTranslate"),s(),g(17,"textarea",10)(18,"cx-form-errors",11),a(19,"p",12),m(20),c(21,"cxTranslate"),s()()(),a(22,"div")(23,"cx-file-upload",13),f(24,dn,4,4,"ng-template"),s(),a(25,"p",14),m(26),c(27,"cxTranslate"),s(),a(28,"p",14),m(29),c(30,"cxTranslate"),s(),g(31,"cx-form-errors",15),s(),a(32,"div",16)(33,"button",17),_("click",function(){return n.close("Close Reopen Request Dialog")}),m(34),c(35,"cxTranslate"),s(),a(36,"button",18),_("click",function(){return n.reopenRequest()}),m(37),c(38,"cxTranslate"),s()()(),f(39,un,1,0,"cx-spinner",19),c(40,"async"),s()()),i&2){let r;p("cxFocus",n.focusConfig),o(),p("formGroup",n.form),o(3),d(" ",l(5,20,"customerTicketingDetails.reopenRequest")," "),o(2),Te("title",l(7,22,"common.close")),R("aria-label",l(8,24,"common.close")),o(4),p("type",n.iconTypes.CLOSE),o(5),d(" ",l(16,26,"customerTicketing.message")," "),o(2),p("maxLength",n.inputCharactersLimit),R("aria-invalid",((r=n.form.get("message"))==null?null:r.touched)&&((r=n.form.get("message"))==null?null:r.invalid))("aria-errormessage","messageError"),o(),p("control",n.form.get("message")),o(2),d(" ",M(21,28,"customerTicketing.charactersLeft",x(42,ge,n.messagesCharacterLeft))," "),o(3),p("formControl",n.form.get("file"))("accept",n.allowedTypes),o(3),d(" ",M(27,31,"customerTicketing.fileSizeLimit",x(44,ge,n.maxSize))," "),o(3),d(" ",l(30,34,"customerTicketing.maximumAttachment")," "),o(2),p("control",n.form.get("file")),o(3),d(" ",l(35,36,"customerTicketing.cancel")," "),o(3),d(" ",l(38,38,"customerTicketing.submit")," "),o(2),p("ngIf",l(40,40,n.isDataLoading$))}},dependencies:[U,Ke,Ge,Pe,je,Be,$e,dt,Ve,Ue,Ze,Tt,le,G,q],encapsulation:2})}}return t})(),Nn={launch:{CUSTOMER_TICKETING_REOPEN:{inline:!0,component:Ln,dialogType:qe.DIALOG},CUSTOMER_TICKETING_CLOSE:{inline:!0,component:Mn,dialogType:qe.DIALOG},CUSTOMER_TICKETING_CREATE:{inline:!0,component:An,dialogType:qe.DIALOG}}},wn=(()=>{class t{constructor(e,i,n,r){this.customerTicketingFacade=e,this.routingService=i,this.translationService=n,this.customerTicketingConfig=r,this.PAGE_SIZE=this.customerTicketingConfig.customerTicketing?.listViewPageSize||5,this.iconTypes=gt,this.tickets$=this.customerTicketingFacade.getTickets(this.PAGE_SIZE).pipe(L(C=>this.sortType=C?.pagination?.sort||"")),this.getStatusClass=C=>{switch(C){case E.OPEN:case E.INPROCESS:return Re.GREEN;case E.CLOSED:return Re.GREY;default:return""}},zt("a11yHighContrastBorders")}goToTicketDetail(e){this.routingService.go({cxRoute:"supportTicketDetails",params:{ticketCode:e}})}getSortLabels(){return re([this.translationService.translate("customerTicketing.ticketId"),this.translationService.translate("customerTicketing.changedOn")]).pipe(h(([e,i])=>({byTicketId:e,byDate:i})))}changeSortCode(e){this.sortType=e,this.pageChange(0)}pageChange(e){let i=this.createTicketListEvent(this.sortType,e);this.fetchTicketList(i)}createTicketListEvent(e,i){return{currentPage:i,sortCode:e}}fetchTicketList(e){this.tickets$=this.customerTicketingFacade.getTickets(this.PAGE_SIZE,e.currentPage,e.sortCode)}static{this.\u0275fac=function(i){return new(i||t)(T(I),T(ie),T(Y),T(We))}}static{this.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-list"]],standalone:!1,decls:4,vars:4,consts:[["spinner",""],["noCustomerTickets",""],[4,"ngIf","ngIfElse"],[1,"cx-ticketing-list-title"],[1,"cx-ticketing-list-title-text"],[1,"cx-ticketing-list-sort","top"],[1,"cx-ticketing-list-form-group","form-group"],["ariaControls","ticketing-list-table",3,"sortListEvent","sortOptions","sortLabels","selectedOption","placeholder","ariaLabel"],["id","ticketing-list-table","aria-hidden","true",1,"table","cx-ticketing-list-table"],[1,"cx-ticketing-list-thead-mobile"],["scope","col"],[3,"click",4,"ngFor","ngForOf"],[1,"cx-ticketing-list-sort","bottom"],["class","cx-ticketing-list-pagination",4,"ngIf"],[3,"click"],[1,"cx-ticketing-list-data","cx-ticketing-list-id"],[1,"cx-ticketing-list-label"],[1,"cx-ticketing-list-value",3,"routerLink"],[1,"cx-ticketing-list-data"],[1,"cx-ticketing-list-value",3,"routerLink","ngClass"],[1,"cx-ticketing-list-pagination"],[3,"viewPageEvent","pagination"],[1,"text-center"]],template:function(i,n){if(i&1&&(f(0,hn,8,6,"ng-container",2),c(1,"async"),f(2,kn,1,0,"ng-template",null,0,se)),i&2){let r=ce(3);p("ngIf",l(1,2,n.tickets$))("ngIfElse",r)}},dependencies:[On,At,Le,U,si,li,rt,le,G,q,we,lt],encapsulation:2})}}return t})(),jn=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=b({type:t})}static{this.\u0275inj=S({providers:[B({cmsComponents:{SupportTicketHistoryComponent:{component:wn,guards:[ne]}}})],imports:[Li,j,X,Ee,Ct,be,pi,ct,pe]})}}return t})(),Bn=(()=>{class t{constructor(e,i,n,r){this.translation=e,this.customerTicketingFacade=i,this.routingService=n,this.eventService=r,this.dateFormat=fi,this.subscription=new oe,this.ticketDetails$=this.customerTicketingFacade.getTicket(),this.reloadOnRedirection()}prepareCardContent(e,i,n){return this.translation.translate(i).pipe(St(()=>!!e),h(r=>({title:r,text:[e||""],customClass:this.getStatusClass(n?.toUpperCase())})))}getStatusClass(e){return e===E.OPEN||e===E.INPROCESS?Re.GREEN:e===E.CLOSED?Re.GREY:""}reloadOnRedirection(){this.subscription=re([this.ticketDetails$,this.routingService.getParams().pipe(h(e=>e.ticketCode))]).pipe(K(1),L(([e,i])=>{e&&i!==e?.id&&this.eventService.dispatch({},et)})).subscribe()}ngOnDestroy(){this.subscription?.unsubscribe()}static{this.\u0275fac=function(i){return new(i||t)(T(Y),T(I),T(ie),T(xe))}}static{this.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-details"]],standalone:!1,decls:4,vars:4,consts:[["spinner",""],[4,"ngIf","ngIfElse"],[1,"cx-ticket-details"],[1,"container"],[1,"cx-details-card"],[3,"content"]],template:function(i,n){if(i&1&&(f(0,vn,17,18,"ng-container",1),c(1,"async"),f(2,_n,1,0,"ng-template",null,0,se)),i&2){let r=ce(3);p("ngIf",l(1,2,n.ticketDetails$))("ngIfElse",r)}},dependencies:[U,ri,le,G,we],encapsulation:2,changeDetection:0})}}return t})(),$n=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=b({type:t})}static{this.\u0275inj=S({providers:[B({cmsComponents:{SupportTicketDetailsComponent:{component:Bn,guards:[ne]}}})],imports:[j,X,Ee,Ct,pe]})}}return t})(),Ni=(()=>{class t{constructor(){this.customerTicketingFacade=D(I)}enableReopenButton(){return this.customerTicketingFacade.getTicket().pipe(h(e=>e?.status?.id===E.CLOSED&&e.availableStatusTransitions?.some(i=>i.id.toUpperCase()===E.INPROCESS||i.id.toUpperCase()===E.OPEN)))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=A({token:t,factory:t.\u0275fac})}}return t})(),Pn=(()=>{class t{constructor(e,i,n){this.customerTicketingFacade=e,this.launchDialogService=i,this.vcr=n,this.subscription=new oe,this.CustomerTicketingReopenComponentService=D(Ni),this.enableReopenButton$=this.CustomerTicketingReopenComponentService.enableReopenButton()}openDialog(){let e=this.launchDialogService.openDialog(He.CUSTOMER_TICKETING_REOPEN,this.element,this.vcr);e&&this.subscription.add(e.pipe(K(1)).subscribe())}ngOnDestroy(){this.subscription?.unsubscribe()}static{this.\u0275fac=function(i){return new(i||t)(T(I),T(Se),T(Ae))}}static{this.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-reopen"]],viewQuery:function(i,n){if(i&1&&fe(vt,5),i&2){let r;he(r=ke())&&(n.element=r.first)}},standalone:!1,decls:2,vars:3,consts:[["element",""],["class","col-xs-12 col-md-5 col-lg-4",4,"ngIf"],[1,"col-xs-12","col-md-5","col-lg-4"],[1,"btn","btn-block","btn-secondary",3,"click"]],template:function(i,n){i&1&&(f(0,xn,5,3,"div",1),c(1,"async")),i&2&&p("ngIf",l(1,1,n.enableReopenButton$))},dependencies:[U,G,q],encapsulation:2})}}return t})(),Vn=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=b({type:t})}static{this.\u0275inj=S({providers:[Ni,B({cmsComponents:{SupportTicketReopenComponent:{component:Pn,guards:[ne]}}})],imports:[j,X,be,Qe,ae,Ie,ze,pe]})}}return t})(),wi=(()=>{class t{displayAddMessageSection(e){return e?.status?.id!==E.CLOSED}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=A({token:t,factory:t.\u0275fac})}}return t})(),Un=(()=>{class t{constructor(e,i,n){this.customerTicketingConfig=e,this.customerTicketingFacade=i,this.eventService=n,this.customerTicketingMessagesComponentService=D(wi),this.ticketDetails$=this.customerTicketingFacade.getTicket(),this.subscription=new oe,this.messageEvents$=this.prepareMessageEvents(),this.messagingConfigs=this.prepareMessagingConfigs()}onSend(e){let i=(e.files instanceof FileList&&e.files?.length>0)??!1;this.subscription.add(this.customerTicketingFacade.createTicketEvent(this.prepareTicketEvent(e.message),i).subscribe(n=>{e.files&&e.files?.length&&n.code&&this.customerTicketingFacade.uploadAttachment(e.files.item(0),n.code),this.messagingComponent?.resetForm()}))}downloadAttachment(e){this.subscription.add(this.customerTicketingFacade.downloadAttachment(e.messageCode,e.attachmentId).subscribe(i=>{let n=window.URL.createObjectURL(i),r=document.createElement("a");r.href=n,r.download=e.fileName??"",r.click()}))}prepareMessageEvents(){return this.ticketDetails$.pipe(h(e=>e?.ticketEvents?.map(i=>it(tt({},i),{text:i.message??"",rightAlign:i.addedByAgent||!1,attachments:i.ticketEventAttachments??[]}))??[]))}prepareMessagingConfigs(){return{attachmentRestrictions:this.customerTicketingConfig.customerTicketing?.attachmentRestrictions,charactersLimit:this.customerTicketingConfig.customerTicketing?.inputCharactersLimit,enableFileUploadOption:!0,displayAddMessageSection:this.ticketDetails$.pipe(h(e=>this.customerTicketingMessagesComponentService.displayAddMessageSection(e)))}}prepareTicketEvent(e){return{message:e}}ngOnDestroy(){this.subscription?.unsubscribe()}static{this.\u0275fac=function(i){return new(i||t)(T(We),T(I),T(xe))}}static{this.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-messages"]],viewQuery:function(i,n){if(i&1&&fe(Xe,5),i&2){let r;he(r=ke())&&(n.messagingComponent=r.first)}},standalone:!1,decls:1,vars:2,consts:[[3,"send","downloadAttachment","messageEvents$","messagingConfigs"]],template:function(i,n){i&1&&(a(0,"cx-messaging",0),_("send",function(C){return n.onSend(C)})("downloadAttachment",function(C){return n.downloadAttachment(C)}),s()),i&2&&p("messageEvents$",n.messageEvents$)("messagingConfigs",n.messagingConfigs)},dependencies:[Xe],encapsulation:2})}}return t})(),Gn=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=b({type:t})}static{this.\u0275inj=S({providers:[wi,B({cmsComponents:{SupportTicketUpdateComponent:{component:Un,guards:[ne]}}})],imports:[j,X,Ee,di,ae,ti]})}}return t})(),Qn=(()=>{class t{constructor(){this.PAGE_SIZE=1,this.customerTicketingFacade=D(I),this.tickets$=this.customerTicketingFacade.getTickets(this.PAGE_SIZE)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["cx-my-account-v2-customer-ticketing"]],standalone:!1,decls:18,vars:20,consts:[["noCustomerTickets",""],["spinner",""],[1,"cx-my-account-customer-ticket-header"],["role","heading","aria-level","4",1,"cx-my-account-customer-ticket-heading"],[1,"cx-my-account-customer-ticket-show-more"],["id","show-more-requests",1,"btn-link","cx-action-link",3,"routerLink"],[4,"ngIf","ngIfElse"],[1,"cx-my-account-customer-ticket-body"],[4,"ngFor","ngForOf"],[1,"cx-my-account-customer-ticket-details"],[1,"cx-my-account-customer-ticket-subject"],[1,"cx-my-account-customer-ticket-details-light"],[1,"cx-my-account-no-ticket"]],template:function(i,n){if(i&1&&(N(0),a(1,"div",2)(2,"div",3),c(3,"cxTranslate"),m(4),c(5,"cxTranslate"),s(),a(6,"div",4)(7,"a",5),c(8,"cxUrl"),c(9,"cxTranslate"),m(10),c(11,"cxTranslate"),s()()(),f(12,bn,2,2,"ng-container",6),c(13,"async"),w(),f(14,In,4,6,"ng-template",null,0,se)(16,Rn,1,0,"ng-template",null,1,se)),i&2){let r=ce(17);o(2),R("aria-label",l(3,7,"myAccountV2CustomerTicketing.heading")),o(2),d(" ",l(5,9,"myAccountV2CustomerTicketing.heading")," "),o(3),p("routerLink",l(8,11,ve(19,yn))),R("aria-label",l(9,13,"myAccountV2CustomerTicketing.showMoreLabel")),o(3),d(" ",l(11,15,"myAccountV2CustomerTicketing.showMore")," "),o(2),p("ngIf",l(13,17,n.tickets$))("ngIfElse",r)}},dependencies:[Le,U,le,rt,G,q,we,lt],encapsulation:2})}}return t})(),qn=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=b({type:t})}static{this.\u0275inj=S({providers:[B({cmsComponents:{MyAccountViewRequestsComponent:{component:Qn,guards:[ne]}}})],imports:[j,X,Ee,pe,ct]})}}return t})(),ji=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=b({type:t})}static{this.\u0275inj=S({providers:[B(Nn)],imports:[ae,Ie,$n,Fn,Vn,jn,Gn,Li,qn]})}}return t})();var De=class{},Vi=(()=>{class t{constructor(e){this.adapter=e}getTicket(e,i){return this.adapter.getTicket(e,i)}getTickets(e,i,n,r){return this.adapter.getTickets(e,i,n,r)}getTicketCategories(){return this.adapter.getTicketCategories()}getTicketAssociatedObjects(e){return this.adapter.getTicketAssociatedObjects(e)}createTicket(e,i){return this.adapter.createTicket(e,i)}createTicketEvent(e,i,n){return this.adapter.createTicketEvent(e,i,n)}uploadAttachment(e,i,n,r){return this.adapter.uploadAttachment(e,i,n,r)}downloadAttachment(e,i,n,r){return this.adapter.downloadAttachment(e,i,n,r)}static{this.\u0275fac=function(i){return new(i||t)(v(De))}}static{this.\u0275prov=A({token:t,factory:t.\u0275fac})}}return t})(),Ui=new z("CustomerTicketingDetailsNormalizer"),Gi=new z("CustomerTicketingEventNormalizer"),xt=new z("CustomerTicketingFileNormalizer"),Qi=new z("CustomerTicketingListNormalizer"),qi=new z("CustomerTicketingCategoryNormalizer"),Hi=new z("CustomerTicketingAssociatedObjectsNormalizer"),Ki=new z("CustomerTicketingCreateNormalizer"),Bi=(()=>{class t{getTicketCategoriesQueryReloadEvents(){return[Si]}getTicketCategoriesQueryResetEvents(){return[Ei]}getTicketAssociatedObjectsQueryReloadEvents(){return[Ii]}getTicketAssociatedObjectsQueryResetEvents(){return[bi]}getTicketQueryReloadEvents(){return[et]}getTicketQueryResetEvents(){return[hi]}getTicketsQueryReloadEvents(){return[vi]}getTicketsQueryResetEvents(){return[ki]}getTicketsQuery$(e,i,n){return this.queryService.create(()=>this.customerTicketingListPreConditions().pipe(Z(r=>this.customerTicketingConnector.getTickets(r,e,i,n))),{reloadOn:this.getTicketsQueryReloadEvents(),resetOn:this.getTicketsQueryResetEvents()})}customerTicketingPreConditions(){return re([this.userIdService.getUserId(),this.routingService.getParams().pipe(h(e=>e.ticketCode),It())]).pipe(K(1),h(([e,i])=>{if(!e)throw new Error("Customer ticketing pre conditions not met");return[e,i]}))}customerTicketingListPreConditions(){return this.userIdService.getUserId().pipe(K(1),h(e=>{if(!e)throw new Error("Customer ticketing list pre conditions not met");return e}))}constructor(e,i,n,r,C,$){this.queryService=e,this.commandService=i,this.userIdService=n,this.customerTicketingConnector=r,this.routingService=C,this.eventService=$,this.createTicketCommand=this.commandService.create(y=>this.customerTicketingPreConditions().pipe(Z(([P])=>this.customerTicketingConnector.createTicket(P,y)),L(()=>{this.eventService.dispatch({},Ri)})),{strategy:_e.Queue}),this.createTicketEventCommand=this.commandService.create(y=>this.customerTicketingPreConditions().pipe(Z(([P,Ce])=>this.customerTicketingConnector.createTicketEvent(P,Ce,y.ticketEvent).pipe(L(()=>{y.ticketEvent.toStatus?.id===E.CLOSED?this.eventService.dispatch({},yi):y.containsAttachment||(y.ticketEvent.toStatus?.id===E.OPEN||y.ticketEvent.toStatus?.id===E.INPROCESS?this.eventService.dispatch({},xi):this.eventService.dispatch({},_i))})))),{strategy:_e.Queue}),this.uploadAttachmentCommand=this.commandService.create(y=>this.customerTicketingPreConditions().pipe(Z(([P,Ce])=>this.customerTicketingConnector.uploadAttachment(P,y.ticketId??Ce,y.eventCode,y.file).pipe(L(()=>this.eventService.dispatch({},Di))))),{strategy:_e.Queue}),this.downloadAttachmentCommand=this.commandService.create(y=>this.customerTicketingPreConditions().pipe(Z(([P,Ce])=>this.customerTicketingConnector.downloadAttachment(P,Ce,y.eventCode,y.attachmentId))),{strategy:_e.Queue}),this.getTicketQuery$=this.queryService.create(()=>this.customerTicketingPreConditions().pipe(Z(([y,P])=>this.customerTicketingConnector.getTicket(y,P))),{reloadOn:this.getTicketQueryReloadEvents(),resetOn:this.getTicketQueryResetEvents()}),this.getTicketCategoriesQuery=this.queryService.create(()=>this.customerTicketingConnector.getTicketCategories(),{reloadOn:this.getTicketCategoriesQueryReloadEvents(),resetOn:this.getTicketCategoriesQueryResetEvents()}),this.getTicketAssociatedObjectsQuery=this.queryService.create(()=>this.customerTicketingPreConditions().pipe(Z(([y])=>this.customerTicketingConnector.getTicketAssociatedObjects(y))),{reloadOn:this.getTicketAssociatedObjectsQueryReloadEvents(),resetOn:this.getTicketAssociatedObjectsQueryResetEvents()})}getTicketAssociatedObjectsState(){return this.getTicketAssociatedObjectsQuery.getState()}getTicketAssociatedObjects(){return this.getTicketAssociatedObjectsState().pipe(bt(e=>e?.error?Et(e.error):Me(e)),h(e=>e.data??[]))}getTicketCategoriesState(){return this.getTicketCategoriesQuery.getState()}getTicketCategories(){return this.getTicketCategoriesState().pipe(h(e=>e.data??[]))}getTicketState(){return this.getTicketQuery$.getState()}getTicket(){return this.getTicketState().pipe(h(e=>e.data))}createTicket(e){return this.createTicketCommand.execute(e)}getTicketsState(e,i,n){return this.getTicketsQuery$(e,i,n).getState()}getTickets(e,i,n){return this.getTicketsState(e,i,n).pipe(h(r=>r.data))}createTicketEvent(e,i=!1){return this.createTicketEventCommand.execute({ticketEvent:e,containsAttachment:i})}uploadAttachment(e,i,n){return this.uploadAttachmentCommand.execute({file:e,eventCode:i,ticketId:n})}downloadAttachment(e,i){return this.downloadAttachmentCommand.execute({eventCode:e,attachmentId:i})}static{this.\u0275fac=function(i){return new(i||t)(v(Ut),v(Vt),v(wt),v(Vi),v(ie),v(xe))}}static{this.\u0275prov=A({token:t,factory:t.\u0275fac})}}return t})(),Hn=[Bi,{provide:I,useExisting:Bi}];function $i(t){return t.reason===Ht.NOT_FOUND_ERROR&&t.type===qt.NOT_FOUND_ERROR}var Kn=(()=>{class t extends pt{constructor(e,i,n){super(e,n),this.globalMessageService=e,this.routingService=i,this.platformId=n,this.responseStatus=Xt.NOT_FOUND}getPriority(){return Pt.NORMAL}hasMatch(e){return super.hasMatch(e)&&this.isCustomerTicketingDetailsRoute()&&this.getErrors(e).some($i)}handleError(e,i){this.handleTicketNotFoundError(e,i)}isCustomerTicketingDetailsRoute(){return Gt(this.routingService.getRouterState())?.state?.semanticRoute==="supportTicketDetails"}handleTicketNotFoundError(e,i){this.getErrors(i).filter(n=>$i(n)).forEach(()=>{this.routingService.go({cxRoute:"supportTickets"}),this.globalMessageService.add({key:"customerTicketingDetails.ticketNotFound"},ye.MSG_TYPE_ERROR)})}getErrors(e){return e.error?.errors||[]}static{this.\u0275fac=function(i){return new(i||t)(v(Ne),v(ie),v(Mt))}}static{this.\u0275prov=A({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),Pi=(()=>{class t extends at{constructor(e,i,n,r,C,$){super(),this.translationService=e,this.activeCartFacade=i,this.basePageMetaResolver=n,this.customerTicketingFacade=r,this.translation=C,this.semanticPath=$,this.CUSTOMER_SERVICE_TRANSLATION_KEY="customerTicketing.customerService",this.CUSTOMER_SERVICE_SEMANTIC_ROUTE="supportTickets",this.customerServiceBreadCrumb$=this.translation.translate(this.CUSTOMER_SERVICE_TRANSLATION_KEY).pipe(h(y=>[{label:y,link:this.semanticPath.get(this.CUSTOMER_SERVICE_SEMANTIC_ROUTE)}])),this.pageType=Lt.CONTENT_PAGE,this.pageUid="support-ticket-details"}resolveTitle(){return this.basePageMetaResolver.resolveTitle()}resolveHeading(){return this.customerTicketingFacade.getTicket().pipe(h(e=>e?.subject||""))}resolveDescription(){return this.basePageMetaResolver.resolveDescription()}resolveRobots(){return this.basePageMetaResolver.resolveRobots()}resolveBreadcrumbs(){return re([this.customerServiceBreadCrumb$,this.basePageMetaResolver.resolveBreadcrumbs()]).pipe(h(([e,i=[]])=>{let[n,...r]=i;return[n,...e,...r]}))}static{this.\u0275fac=function(i){return new(i||t)(v(Y),v(ui),v(Yt),v(I),v(Y),v(Bt))}}static{this.\u0275prov=A({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),Zi=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=b({type:t})}static{this.\u0275inj=S({providers:[...Hn,Vi,Pi,{provide:pt,useExisting:Kn,multi:!0},{provide:at,useExisting:Pi,multi:!0}]})}}return t})();var Zn=(()=>{class t{constructor(e,i,n){this.http=e,this.occEndpoints=i,this.converter=n,this.logger=D(jt)}getTicketAssociatedObjects(e){return this.http.get(this.getTicketAssociatedObjectsEndpoint(e)).pipe(F(i=>{throw Q(i,this.logger)}),h(i=>i.ticketAssociatedObjects??[]),this.converter.pipeableMany(Hi))}getTicketAssociatedObjectsEndpoint(e){return this.occEndpoints.buildUrl("getTicketAssociatedObjects",{urlParams:{customerId:e}})}getTicketCategories(){return this.http.get(this.getTicketCategoriesEndpoint()).pipe(F(e=>{throw Q(e,this.logger)}),h(e=>e.ticketCategories??[]),this.converter.pipeableMany(qi))}getTicketCategoriesEndpoint(){return this.occEndpoints.buildUrl("getTicketCategories")}getTicket(e,i){return this.http.get(this.getTicketEndpoint(e,i)).pipe(F(n=>{throw Q(n,this.logger)}),L(n=>n.ticketEvents?.reverse()),this.converter.pipeable(Ui))}getTicketEndpoint(e,i){return this.occEndpoints.buildUrl("getTicket",{urlParams:{customerId:e,ticketId:i}})}createTicket(e,i){return this.http.post(this.getCreateTicketEndpoint(e),i,{headers:new ot().set("Content-Type","application/json")}).pipe(F(n=>{throw Q(n,this.logger)}),this.converter.pipeable(Ki))}getCreateTicketEndpoint(e){return this.occEndpoints.buildUrl("createTicket",{urlParams:{customerId:e}})}getTickets(e,i,n,r){return this.http.get(this.getTicketsEndpoint(e,i,n,r)).pipe(F(C=>{throw Q(C,this.logger)}),this.converter.pipeable(Qi))}getTicketsEndpoint(e,i,n,r){return this.occEndpoints.buildUrl("getTickets",{urlParams:{customerId:e},queryParams:{pageSize:i,currentPage:n,sort:r}})}createTicketEvent(e,i,n){return this.http.post(this.getCreateTicketEventEndpoint(e,i),n,{headers:new ot().set("Content-Type","application/json")}).pipe(F(r=>{throw Q(r,this.logger)}),this.converter.pipeable(Gi))}getCreateTicketEventEndpoint(e,i){return this.occEndpoints.buildUrl("createTicketEvent",{urlParams:{customerId:e,ticketId:i}})}uploadAttachment(e,i,n,r){let C=new FormData;return C.append("ticketEventAttachment",r),this.http.post(this.getUploadAttachmentEndpoint(e,i,n),C).pipe(F($=>{throw Q($,this.logger)}),this.converter.pipeable(xt))}getUploadAttachmentEndpoint(e,i,n){return this.occEndpoints.buildUrl("uploadAttachment",{urlParams:{customerId:e,ticketId:i,eventCode:n}})}downloadAttachment(e,i,n,r){let C={responseType:"blob"};return this.http.get(this.getDownloadAttachmentEndpoint(e,i,n,r),C).pipe(F($=>{throw Q($,this.logger)}),this.converter.pipeable(xt))}getDownloadAttachmentEndpoint(e,i,n,r){return this.occEndpoints.buildUrl("downloadAttachment",{urlParams:{customerId:e,ticketId:i,eventCode:n,attachmentId:r}})}static{this.\u0275fac=function(i){return new(i||t)(v(Ot),v($t),v(Qt))}}static{this.\u0275prov=A({token:t,factory:t.\u0275fac})}}return t})(),zn={backend:{occ:{endpoints:{getTicket:"users/${customerId}/tickets/${ticketId}",getTickets:"users/${customerId}/tickets",createTicketEvent:"users/${customerId}/tickets/${ticketId}/events",getTicketCategories:"/ticketCategories",getTicketAssociatedObjects:"users/${customerId}/ticketAssociatedObjects",createTicket:"users/${customerId}/tickets",uploadAttachment:"/users/${customerId}/tickets/${ticketId}/events/${eventCode}/attachments",downloadAttachment:"/users/${customerId}/tickets/${ticketId}/events/${eventCode}/attachments/${attachmentId}"}}}},zi=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=b({type:t})}static{this.\u0275inj=S({providers:[B(zn),{provide:De,useClass:Zn}],imports:[j]})}}return t})();var qo=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=b({type:t})}static{this.\u0275inj=S({imports:[ji,Zi,zi]})}}return t})();export{qo as CustomerTicketingModule};
